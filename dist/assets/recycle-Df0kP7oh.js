import{d as I,u as K,L as O,o as Q,q as G,w as h,e,c as u,r as D,F as M,n as x,t as o,x as J,s as W,y as X,g as l,D as Z,b as T,f as y,h as R,B as ee,j as f,i as L,m as i}from"./index-BrVULTij.js";import{u as te,_ as se}from"./MainLayout-CqP2lYmd.js";import{U as ae}from"./UserLayout-CzbGZN-3.js";import{u as oe,D as le}from"./DataTable-D49Hiyp7.js";import{g as V,b as ne,d as re}from"./agent-CyvHOYh8.js";import{d as ie}from"./dayjs.min-BAJkae7J.js";import"./index-CELwjfbr.js";import{o as de,s as ce,u as ue,a as xe,E as pe,t as fe}from"./vee-validate-zod-C7y-IhDo.js";const me={class:"flex flex-col gap-5"},be={class:"flex gap-5 border-b border-[#eee] pb-[15px]"},ge=["onClick"],ve={key:0},ye={class:"flex items-center justify-center py-8"},he={class:"flex items-center w-full max-w-lg"},_e={class:"relative flex flex-col items-center"},we={class:"relative flex flex-col items-center"},ke={class:"flex gap-[30px] py-[15px]"},Ce={class:"flex items-center gap-2.5"},Se={class:"text-base font-bold text-[#ff6600]"},je={class:"flex gap-[1px] flex-col"},De={class:"relative flex items-center"},Me=["disabled"],Te={key:1,class:"flex flex-col gap-6"},Re={class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},Le={class:"space-y-2 text-sm text-gray-600"},Ve={class:"flex justify-between"},$e={class:"font-bold"},Be={class:"flex justify-between text-green-600"},Ee={class:"font-bold"},Fe={class:"flex justify-between text-red-600"},Ne={class:"font-bold"},Ue={class:"border-t border-gray-200 my-2 pt-2 flex justify-between items-center"},Ye={class:"text-xl font-bold text-orange-600"},Pe={class:"border rounded-lg overflow-hidden"},Ae={class:"w-full text-sm text-left"},ze={class:"divide-y divide-gray-100"},He={class:"px-4 py-2"},qe={class:"px-4 py-2"},Ie={class:"px-4 py-2"},Ke={class:"px-4 py-2 text-right font-medium"},Oe={class:"flex gap-4"},Qe=["disabled"],Ge=["disabled"],Je={key:1,class:"min-h-[calc(100vh-120px)] pb-10"},We={class:"max-w-[1400px] mx-auto items-start max-[1200px]:grid-cols-1 max-[1200px]:max-w-[600px]"},Xe={class:"text-gray-400 text-xs"},Ze={class:"text-orange-600 font-bold"},dt=I({__name:"recycle",setup(et){const m=ee(),$=te(),{locale:B}=K(),E=O[B.value]??"USD",_=f(!1),w=f(),k=async(a=!1)=>{_.value=!0;const{code:t,data:c}=await ne();t===200&&(w.value=c,a&&$.setCurrentCustomer({bankpoints:c.bankpoints})),_.value=!1},F=f(1),N=de({cards:ce().min(1,"请输入卡密")}),U=fe(N),{handleSubmit:Y,isSubmitting:r,resetForm:C}=ue({validationSchema:U,initialValues:{cards:""}}),{value:g}=xe("cards"),n=f(1),d=f([]),b=L(()=>d.value.filter(a=>a.state===0)),P=L(()=>b.value.reduce((a,t)=>a+(t.points||0),0)),S=Y(async a=>{r.value=!0;try{const{code:t,message:c,data:s}=await V({type:"check",cards:a.cards});t!==200?m.error(c):(d.value=s,n.value=2)}catch(t){m.error(t.message||"提交失败")}finally{r.value=!1}}),A=async()=>{if(b.value.length!==0){r.value=!0;try{const{code:a,message:t}=await V({type:"submit",cards:g.value});a!==200?m.error(t):(m.success("回收成功"),n.value=1,d.value=[],C(),k(!0))}catch(a){m.error(a.message||"提交失败")}finally{r.value=!1}}},p=oe(re,{defaultSize:10,initQuery:{type:2}}),z=[{key:"addtime",title:"变动时间",width:"15%",align:"center"},{key:"points",title:"金豆",width:"15%",align:"center"},{key:"content",title:"操作内容",width:"20%",align:"center"}],v=f("recycle"),H=[{key:"recycle",name:"回收体验卡"},{key:"record",name:"回收记录"}],q=a=>{v.value=a,a==="record"&&p.loadData(!0),a==="recycle"&&(n.value=1,d.value=[],C())};return Q(()=>{k()}),(a,t)=>(i(),G(ae,null,{default:h(()=>{var c;return[e("div",me,[e("div",be,[(i(),u(M,null,D(H,s=>e("span",{key:s.key,class:x(["w-20 text-center text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 ",{"text-[#ff6600] border-b-[#ff6600]":v.value===s.key}]),onClick:j=>q(s.key)},o(s.name),11,ge)),64))]),v.value==="recycle"?(i(),u("div",ve,[e("div",ye,[e("div",he,[e("div",_e,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-colors",n.value>=1?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"])},"1 ",2),e("span",{class:x(["absolute top-10 w-24 text-center text-xs font-medium",n.value>=1?"text-blue-600":"text-gray-500"])},"检测卡密",2)]),e("div",{class:x(["flex-1 h-[1px] mx-4",n.value>=2?"bg-blue-600":"bg-gray-200"])},null,2),e("div",we,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-colors",n.value>=2?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"])},"2 ",2),e("span",{class:x(["absolute top-10 w-24 text-center text-xs font-medium",n.value>=2?"text-blue-600":"text-gray-500"])},"确认回收",2)])])]),e("div",ke,[e("div",Ce,[t[3]||(t[3]=e("span",{class:"text-[15px] font-medium text-[#333333]"},"收卡折扣:",-1)),e("span",Se,o(a.$n((((c=w.value)==null?void 0:c.reccard_rate)||0)*10)),1),t[4]||(t[4]=e("span",null,"折",-1))])]),n.value===1?(i(),u("form",{onSubmit:t[1]||(t[1]=J((...s)=>l(S)&&l(S)(...s),["prevent"])),class:"flex flex-col gap-6",key:F.value},[e("div",je,[t[5]||(t[5]=e("label",{class:"text-[15px] font-medium text-[#333333] flex",for:"cards"},"卡密",-1)),e("div",De,[W(e("textarea",{id:"cards","onUpdate:modelValue":t[0]||(t[0]=s=>Z(g)?g.value=s:null),placeholder:"请输入卡密",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none min-h-[120px]",autocomplete:"off",spellcheck:"false"},null,512),[[X,l(g)]])]),T(l(pe),{name:"cards",class:"text-[#ff4d4f] text-sm"})]),e("button",{type:"submit",disabled:l(r),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},o(l(r)?"检测中...":"检测卡密"),9,Me)],32)):y("",!0),n.value===2?(i(),u("div",Te,[e("div",Re,[t[10]||(t[10]=e("h3",{class:"font-bold text-gray-800 mb-4"},"卡密检测结果",-1)),e("div",Le,[e("div",Ve,[t[6]||(t[6]=e("span",null,"总提交数量:",-1)),e("span",$e,o(d.value.length)+" 张",1)]),e("div",Be,[t[7]||(t[7]=e("span",null,"有效卡密:",-1)),e("span",Ee,o(b.value.length)+" 张",1)]),e("div",Fe,[t[8]||(t[8]=e("span",null,"无效/重复:",-1)),e("span",Ne,o(d.value.length-b.value.length)+" 张",1)]),e("div",Ue,[t[9]||(t[9]=e("span",{class:"text-base font-medium text-gray-800"},"预计获得金豆:",-1)),e("span",Ye,o(a.$n(P.value)),1)])])]),e("div",Pe,[e("table",Ae,[t[11]||(t[11]=e("thead",{class:"bg-gray-100 text-gray-600"},[e("tr",null,[e("th",{class:"px-4 py-2"},"卡号"),e("th",{class:"px-4 py-2"},"金豆"),e("th",{class:"px-4 py-2"},"状态"),e("th",{class:"px-4 py-2 text-right"},"备注")])],-1)),e("tbody",ze,[(i(!0),u(M,null,D(d.value,(s,j)=>(i(),u("tr",{key:j},[e("td",He,o(s.no),1),e("td",qe,o(s.points),1),e("td",Ie,[e("span",{class:x(s.state===0?"text-green-600":"text-red-500")},o(s.state===0?"有效":"已领取"),3)]),e("td",Ke,[e("div",null,o(s.nickname),1),e("div",null,"("+o(s.uid)+")",1)])]))),128))])])]),e("div",Oe,[e("button",{onClick:t[2]||(t[2]=s=>n.value=1),disabled:l(r),class:"flex-1 p-3 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors"}," 返回修改 ",8,Qe),e("button",{onClick:A,disabled:b.value.length===0||l(r),class:"flex-1 p-3 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl font-bold hover:shadow-lg disabled:opacity-60 disabled:cursor-not-allowed transition-all"},o(l(r)?"提交中...":"确认回收"),9,Ge)])])):y("",!0)])):y("",!0),v.value==="record"?(i(),u("div",Je,[e("div",We,[T(le,{columns:z,data:l(p).dataSource.value,loading:l(p).loading.value,pagination:l(p).pagination.value,onChange:l(p).changePage,hasMore:l(p).hasMore.value},{"column-addtime":h(({row:s})=>[e("span",Xe,o(l(ie).unix(s.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),"column-points":h(({row:s})=>[e("div",Ze,[R(o(a.$n(s.points))+" ",1),t[12]||(t[12]=e("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:se},null,-1))]),R(" "+o(a.$n(((s==null?void 0:s.points)||0)/1e3,{style:"currency",currency:l(E)})),1)]),_:1},8,["data","loading","pagination","onChange","hasMore"])])])):y("",!0)])]}),_:1}))}});export{dt as default};
