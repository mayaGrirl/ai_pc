import{d as I,u as F,L,o as N,c as f,F as B,e as s,g as D,b as p,B as a,w as b,t as _,l as d,A as P,p as Y,D as V,f as E,q as U,y as H,r as O,x as Q,s as q,h as K,i as A}from"./index-BG9QW0k-.js";import{U as z}from"./UserLayout-uEYBNEQ8.js";import"./index-C8shwcnW.js";import{S as J}from"./constants-BNhaYc6M.js";import{o as G,s as $,u as W,a as M,E as T,t as X}from"./vee-validate-zod-CC9-RCrv.js";import{_ as Z}from"./receive-sms.vue_vue_type_script_setup_true_lang-BoPFaH08.js";import{_ as ee,u as te,J as se}from"./MainLayout-Cy8swJD0.js";import{g as R,s as oe}from"./verify-key-CUJrgnew.js";import{u as ae,D as re}from"./DataTable-2Yo32STd.js";import{b as ne}from"./shop-D7n1Din1.js";import{u as le}from"./index-CC-rEMQh.js";import{d as ie}from"./dayjs.min-BAJkae7J.js";const de={class:"text-orange-600 font-bold"},ce={class:"text-xs"},fe={class:"text-gray-400 text-xs"},ue=["onClick"],pe=I({__name:"PropsRecord",setup(j){const{locale:m}=F(),w=L[m.value]??"USD",n=P(),{copy:c,isSupported:v}=le(),{loading:k,dataSource:x,hasMore:S,pagination:u,loadData:g,changePage:y,query:h,reload:C}=ae(ne,{defaultSize:10,initQuery:{t:R()}}),o=[{key:"no",title:"卡号",width:"20%",align:"center"},{key:"pwd",title:"卡密",width:"25%",align:"center"},{key:"points",title:"金豆",width:"15%",align:"center"},{key:"addtime",title:"获得时间",width:"20%",align:"center"},{key:"operation",title:"操作",width:"15%",align:"center"}],t=async()=>{if(!x.value.length){n.warning("暂无数据可复制");return}const r=x.value.filter(e=>e.state===0).map(e=>`${e.no} ${e.pwd}`).join(`
`);if(!r){n.warning("没有待使用的卡密可复制");return}v.value?(await c(r),n.success("已复制所有可用卡密")):n.error("您的浏览器不支持自动复制")},l=async(r,e)=>{const i=`${r} ${e}`;v.value?(await c(i),n.success("已复制")):n.error("您的浏览器不支持自动复制")};return N(()=>{g()}),(r,e)=>(d(),f(B,null,[s("div",{class:"flex justify-between items-center mb-4 px-1"},[e[1]||(e[1]=s("h3",{class:"text-lg font-bold text-gray-800"},"兑换记录",-1)),s("div",{class:"flex items-center gap-2"},[s("button",{onClick:t,class:"text-sm font-medium text-orange-600 hover:text-orange-700 hover:bg-orange-50 px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1"},[...e[0]||(e[0]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})],-1),D(" 复制可用卡密 ",-1)])])])]),p(re,{columns:o,data:a(x),loading:a(k),pagination:a(u),onChange:a(y),hasMore:a(S)},{"column-points":b(({row:i})=>[s("div",de,[D(_(r.$n(i.points))+" ",1),e[2]||(e[2]=s("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:ee},null,-1))]),s("div",ce,_(r.$n((i.points||0)/1e3,{style:"currency",currency:a(w)})),1)]),"column-addtime":b(({row:i})=>[s("span",fe,_(a(ie).unix(i.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),"column-operation":b(({row:i})=>[s("span",{class:"cursor-pointer text-orange-600 hover:text-orange-700 hover:bg-orange-50",onClick:Ce=>l(i.no,i.pwd)},"复制",8,ue)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),me={class:"flex flex-col gap-5"},xe={key:0,class:"flex gap-[1px] flex-col"},ge={class:"relative flex items-center gap-1"},ye={key:1},_e={class:"flex gap-[1px] flex-col"},ve={class:"relative flex items-center gap-1"},he=["value"],be={class:"flex gap-[1px] flex-col"},we={class:"relative flex items-center gap-1"},ke=["disabled"],Se={key:1},Re=I({__name:"Props",setup(j){const m=P(),w=te(),n=K(()=>w.currentCustomer),c=A(!1),v=A(1),k=G({safe_ask:$().optional(),answer:$().optional(),verify_code:$().optional()}).superRefine((o,t)=>{var l,r;((l=n.value)==null?void 0:l.selectcardVerifyType)=="safeQuestion"&&((!o.safe_ask||o.safe_ask.length<1)&&t.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!o.answer||o.answer.length<1)&&t.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),o.answer&&o.answer.length>50&&t.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((r=n==null?void 0:n.value)==null?void 0:r.selectcardVerifyType)=="smsVerify"&&(!o.verify_code||o.verify_code.length<1)&&t.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),x=X(k),{handleSubmit:S,isSubmitting:u}=W({validationSchema:x,initialValues:{safe_ask:""}}),{value:g}=M("safe_ask"),{value:y}=M("answer"),{value:h}=M("verify_code"),C=S(async(o,{setErrors:t})=>{u.value=!0;try{const{code:l,message:r,data:e}=await se({safe_ask:o==null?void 0:o.safe_ask,answer:o==null?void 0:o.answer,verify_code:o==null?void 0:o.verify_code});l!==200?m.error(r):(m.success("验证成功"),c.value=!0,oe(e.key,480))}catch(l){m.error(l.message||"提交失败")}finally{u.value=!1}});return N(()=>{(async()=>{try{c.value=!!R()}catch{c.value=!1}})()}),(o,t)=>(d(),Y(z,null,{default:b(()=>{var l,r;return[s("div",me,[t[8]||(t[8]=s("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[s("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"我的道具")],-1)),c.value?(d(),f("div",Se,[p(pe)])):(d(),f("form",{onSubmit:t[3]||(t[3]=q((...e)=>a(C)&&a(C)(...e),["prevent"])),class:"flex flex-col gap-6",key:v.value},[((l=n.value)==null?void 0:l.selectcardVerifyType)=="smsVerify"?(d(),f("div",xe,[t[4]||(t[4]=s("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),s("div",ge,[p(Z,{scene:"exchange_card",modelValue:a(h),"onUpdate:modelValue":t[0]||(t[0]=e=>V(h)?h.value=e:null)},null,8,["modelValue"])]),p(a(T),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):E("",!0),((r=n.value)==null?void 0:r.selectcardVerifyType)=="safeQuestion"?(d(),f("div",ye,[s("div",_e,[t[6]||(t[6]=s("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),s("div",ve,[U(s("select",{id:"safe_ask","onUpdate:modelValue":t[1]||(t[1]=e=>V(g)?g.value=e:null),class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[t[5]||(t[5]=s("option",{key:"option-default",value:""},"请选择问题",-1)),(d(!0),f(B,null,O(a(J),e=>(d(),f("option",{key:`option-${e.value}`,value:String(e.value)},_(o.$t(e.i18nKey)),9,he))),128))],512),[[H,a(g)]])]),p(a(T),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),s("div",be,[t[7]||(t[7]=s("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),s("div",we,[U(s("input",{id:"answer",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>V(y)?y.value=e:null),placeholder:"请输入答案",class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[Q,a(y)]])]),p(a(T),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):E("",!0),s("button",{type:"submit",disabled:a(u),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},_(a(u)?"提交中...":"提交"),9,ke)],32))])]}),_:1}))}});export{Re as default};
