import{d as I,o as j,x as $,w as A,e as t,i as h,t as c,c as k,h as d,I as C,C as o,E as u,v as V,b as S,f as K,g as L,B as q,k as b,p as y}from"./index-B3amumuV.js";import{_ as B}from"./coin-BjeO1Yvx.js";import{U as z}from"./UserLayout-BfXv4yVh.js";import{u as G}from"./MainLayout-Cp4yWRnA.js";import{m as H,j as J}from"./customer-QUF3XMsB.js";import{o as O,s as M,n as P,u as Q,a as v,E as T,t as W}from"./vee-validate-zod-C1u-QrAl.js";const X={class:"flex flex-col gap-5"},Y={class:"flex gap-[30px] py-[15px]"},Z={class:"flex items-center gap-2.5"},ee={class:"text-base font-bold text-[#ff6600]"},te={class:"flex items-center gap-2.5"},se={class:"text-base font-bold text-[#ff6600]"},ae={class:"flex gap-[1px] flex-col"},oe={class:"flex gap-[30px] py-[15px]"},le={class:"flex items-center gap-[6px] cursor-pointer text-[14px] text-[#333]"},ne={class:"flex items-center gap-[6px] cursor-pointer text-[14px] text-[#333]"},re={class:"flex gap-[1px] flex-col"},pe={class:"relative flex items-center"},ie={key:0,class:"flex gap-[1px] flex-col"},de={class:"relative flex items-center gap-1"},ue=["disabled"],ge=I({__name:"Bank",setup(me){const m=q(),U=G(),E=b(1),g=b(!1),r=b(),_=async a=>{g.value=!0;const{data:e,code:l}=await J();l==200&&(r.value=e),g.value=!1},N=O({type:M(),amount:P("请输入正整数").int("必须是整数").positive("金额必须大于 0"),pay_password:M().optional()}).superRefine((a,e)=>{a.type==="out"&&!a.pay_password&&e.addIssue({path:["pay_password"],message:"取款时必须输入二级密码",code:"custom"})}).superRefine((a,e)=>{var n,s;const l=a.type==="out"?(n=r.value)==null?void 0:n.bankpoints:(s=r.value)==null?void 0:s.points;l!==void 0&&a.amount>l&&e.addIssue({path:["amount"],message:"金额超出限制",code:"custom"})}),R=W(N),{handleSubmit:D,isSubmitting:i,resetForm:F}=Q({validationSchema:R,initialValues:{type:"in"}}),{value:p}=v("type"),{value:f}=v("amount"),{value:x}=v("pay_password"),w=D(async a=>{var e,l;i.value=!0;try{const{code:n,message:s}=await H({type:a.type,amount:a.amount,pay_password:a.pay_password});n!==200?m.error(s):(m.success("兑换成功"),await _(!1),U.setCurrentCustomer({points:(e=r.value)==null?void 0:e.points,bankpoints:(l=r.value)==null?void 0:l.bankpoints}),F())}catch(n){m.error(n.message||"提交失败")}finally{i.value=!1}});return j(()=>{_()}),(a,e)=>(y(),$(z,null,{default:A(()=>{var l,n;return[t("div",X,[e[13]||(e[13]=t("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[t("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"银行服务")],-1)),t("div",Y,[t("div",Z,[e[6]||(e[6]=t("span",{class:"text-sm text-[#666]"},"流动资金:",-1)),t("span",ee,[h(c(a.$n(((l=r.value)==null?void 0:l.points)||0))+" ",1),e[5]||(e[5]=t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:B},null,-1))])]),t("div",te,[e[8]||(e[8]=t("span",{class:"text-sm text-[#666]"},"银行存款:",-1)),t("span",se,[h(c(a.$n(((n=r.value)==null?void 0:n.bankpoints)||0))+" ",1),e[7]||(e[7]=t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:B},null,-1))])])]),(y(),k("form",{onSubmit:e[4]||(e[4]=L((...s)=>o(w)&&o(w)(...s),["prevent"])),class:"flex flex-col gap-6",key:E.value},[t("div",ae,[t("div",oe,[t("label",le,[d(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>u(p)?p.value=s:null),value:"in",class:"accent-[#ee5a6f]"},null,512),[[C,o(p)]]),e[9]||(e[9]=t("span",null,"存款",-1))]),t("label",ne,[d(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>u(p)?p.value=s:null),value:"out",class:"accent-[#ee5a6f]"},null,512),[[C,o(p)]]),e[10]||(e[10]=t("span",null,"取款",-1))])])]),t("div",re,[e[11]||(e[11]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"amount"},"金豆",-1)),t("div",pe,[d(t("input",{type:"number",id:"amount",inputmode:"numeric",pattern:"[0-9]*",step:"100",min:"0","onUpdate:modelValue":e[2]||(e[2]=s=>u(f)?f.value=s:null),placeholder:"请输入100的整数倍",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[V,o(f),void 0,{number:!0}]])]),S(o(T),{name:"amount",class:"text-[#ff4d4f] text-sm"})]),o(p)=="out"?(y(),k("div",ie,[e[12]||(e[12]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"pay_password"},"二级密码",-1)),t("div",de,[d(t("input",{id:"pay_password",type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>u(x)?x.value=s:null),placeholder:"请输入答案",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[V,o(x)]])]),S(o(T),{name:"pay_password",class:"text-[#ff4d4f] text-sm"})])):K("",!0),t("button",{type:"submit",disabled:o(i),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},c(o(i)?"提交中...":"提交"),9,ue)],32))])]}),_:1}))}});export{ge as default};
