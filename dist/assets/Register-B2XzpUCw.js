import{d as P,u as T,o as A,x as B,w as F,e as s,i as I,c as m,t as b,f as x,h as f,v,C as w,n as _,k as d,H as U,j as h,m as N,A as z,p as c,s as D}from"./index-ayPqTr_Y.js";import{u as K,M as Z,s as j,r as q}from"./MainLayout-DH6Yef2Z.js";import{h as H}from"./common-DORkPaAs.js";import{S as k}from"./sodium-jzn3nznW.js";const L={class:"register-page"},$={class:"register-container"},G={class:"register-form"},J={key:0,class:"error-message"},O={class:"form-row"},Q={class:"form-control"},W=["placeholder"],X={class:"form-row"},Y={class:"form-control with-btn"},ee=["disabled"],se={class:"form-row"},oe={class:"form-control"},te=["placeholder"],re={key:1,class:"form-row"},ae={class:"form-control"},le={class:"password-strength"},ne={class:"strength-bars"},ie={class:"strength-text"},de={class:"form-row"},ce={class:"form-control"},ue=["placeholder"],pe={class:"form-row"},me={class:"form-control"},fe=["disabled"],ve={key:0,class:"loading-spinner"},_e={key:1},ge=P({__name:"Register",setup(be){const{t:l}=T(),C=N(),S=z(),y=K(),u=d(!1),g=d(!1),n=d(0),a=d(""),p=d(""),M=h(()=>S.query.t||""),o=U({mobile:"",verify_code:"",password:"",confirm_password:""});A(async()=>{try{const t=await H();t.code===200&&t.data&&(p.value=t.data.key)}catch(t){console.error("Failed to get public key:",t)}});const i=h(()=>{const t=o.password;if(!t)return 0;let e=0;return t.length>=6&&e++,t.length>=8&&e++,/[A-Z]/.test(t)&&e++,/[0-9]/.test(t)&&e++,/[^A-Za-z0-9]/.test(t)&&e++,Math.min(e,4)}),R=h(()=>["","弱","中","强","很强"][i.value]),V=async()=>{if(!o.mobile||o.mobile.length!==11){a.value=l("login.mobileError");return}g.value=!0;try{const t=await j(o.mobile);if(t.code===200){n.value=60;const e=setInterval(()=>{n.value--,n.value<=0&&clearInterval(e)},1e3)}else a.value=t.message||"Failed to send code"}catch(t){console.error("Send code error:",t)}finally{g.value=!1}},E=async()=>{if(a.value="",!o.mobile||o.mobile.length!==11){a.value=l("login.mobileError");return}if(!o.verify_code){a.value=l("register.verifyCode");return}if(!o.password||o.password.length<6){a.value=l("login.passwordError");return}if(o.password!==o.confirm_password){a.value=l("register.confirmPassword");return}u.value=!0;try{let t=o.password,e=o.confirm_password;p.value&&(t=await k.encrypt(o.password,p.value),e=await k.encrypt(o.confirm_password,p.value));const r=await q({mobile:o.mobile,verify_code:o.verify_code,password:t,confirm_password:e,recommend:M.value||void 0});r.code===200&&r.data?(y.setToken(r.data.access_token,r.data.token_type,r.data.expires_at),await y.fetchCurrentCustomer(),C.push("/")):a.value=r.message||l("register.registerFailed")}catch(t){console.error("Register error:",t),a.value=l("register.registerFailed")}finally{u.value=!1}};return(t,e)=>(c(),B(Z,null,{default:F(()=>[s("div",L,[s("div",$,[e[11]||(e[11]=s("h1",{class:"page-title"},[s("span",{class:"highlight"},"免费注册"),I("鼎丰28-幸运28领头羊,打造28行业信誉平台. ")],-1)),s("div",G,[a.value?(c(),m("div",J,b(a.value),1)):x("",!0),s("div",O,[e[4]||(e[4]=s("label",{class:"form-label"},"手机号码",-1)),s("div",Q,[f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.mobile=r),type:"text",placeholder:w(l)("login.inputMobile"),maxlength:"11"},null,8,W),[[v,o.mobile]])])]),s("div",X,[e[5]||(e[5]=s("label",{class:"form-label"},null,-1)),s("div",Y,[f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.verify_code=r),type:"text",placeholder:"验证码",maxlength:"6"},null,512),[[v,o.verify_code]]),s("button",{type:"button",class:"btn-code",disabled:n.value>0||g.value,onClick:V},b(n.value>0?`${n.value}s`:"获取验证码"),9,ee)])]),s("div",se,[e[6]||(e[6]=s("label",{class:"form-label"},"登录密码",-1)),s("div",oe,[f(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.password=r),type:"password",placeholder:w(l)("login.inputPassword")},null,8,te),[[v,o.password]])])]),o.password?(c(),m("div",re,[e[8]||(e[8]=s("label",{class:"form-label"},null,-1)),s("div",ae,[s("div",le,[e[7]||(e[7]=s("span",{class:"strength-label"},"密码强度",-1)),s("div",ne,[s("span",{class:_(["bar",{active:i.value>=1}])},null,2),s("span",{class:_(["bar",{active:i.value>=2}])},null,2),s("span",{class:_(["bar",{active:i.value>=3}])},null,2),s("span",{class:_(["bar",{active:i.value>=4}])},null,2)]),s("span",ie,b(R.value),1)])])])):x("",!0),s("div",de,[e[9]||(e[9]=s("label",{class:"form-label"},"确认密码",-1)),s("div",ce,[f(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.confirm_password=r),type:"password",placeholder:w(l)("register.confirmPassword")},null,8,ue),[[v,o.confirm_password]])])]),s("div",pe,[e[10]||(e[10]=s("label",{class:"form-label"},null,-1)),s("div",me,[s("button",{type:"button",class:"btn-submit",disabled:u.value,onClick:E},[u.value?(c(),m("span",ve)):(c(),m("span",_e,"注册"))],8,fe)])])])])])]),_:1}))}}),ke=D(ge,[["__scopeId","data-v-762a8055"]]);export{ke as default};
