import{d as $,o as D,a as E,c as u,n as a,e as t,b,B as w,q as p,x as v,f as h,t as I,E as K,v as R,p as q,w as S,g as M,k as A,z as P,i as g,G as F,j as G,l as c,A as H}from"./index-BG9QW0k-.js";import{u as J,S as O,n as Q,o as W}from"./MainLayout-Cy8swJD0.js";import{h as X}from"./common-jqfb3mzs.js";import{L as Y,S as Z,a as _}from"./sodium-U3nOFz3g.js";const ee={class:"space-y-2"},te={class:"relative group"},oe={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},se={key:0,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},re={class:"relative group"},ae={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ne={key:1,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},le={class:"relative group flex gap-3"},ie={class:"relative flex-1"},de={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ce=["disabled"],ue={class:"flex items-center gap-2 cursor-pointer group"},pe={class:"w-2.5 h-2.5 bg-white rounded-[1px]"},fe=["disabled"],me={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},ye={key:1},ve=$({__name:"LoginBox",props:{redirect:{type:String,default:"/"},compact:{type:Boolean,default:!1}},emits:["success"],setup(r,{emit:V}){const B=r,T=V,j=A(),U=P(),k=J(),n=H(),l=g("password"),f=g(!1),x=g(""),d=g(0);let m=null;const o=F({mobile:"",password:"",code:"",rememberMe:!0}),C=async()=>{try{const{data:s,code:e}=await X();e===200&&s&&(x.value=s.key)}catch(s){console.error("Failed to get public key:",s)}};D(()=>{C()}),E(()=>{m&&clearInterval(m)});const z=()=>{d.value=60,m=setInterval(()=>{d.value--,d.value<=0&&clearInterval(m)},1e3)},L=async()=>{if(!o.mobile){n.error("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(o.mobile)){n.error("请输入正确的手机号");return}try{const{code:s,message:e}=await Q(o.mobile);s===200?(n.success("验证码已发送"),z()):n.error(e||"发送失败")}catch(s){n.error(s.message||"发送失败")}},N=async()=>{if(!o.mobile){n.error("请输入手机号");return}if(l.value==="password"){if(!o.password){n.error("请输入密码");return}if(!x.value){n.error("系统初始化中，请稍后"),await C();return}}else if(!o.code){n.error("请输入验证码");return}f.value=!0;try{let s={mobile:o.mobile,type:l.value==="password"?1:2};l.value==="password"?s.password=await _.encrypt(o.password,x.value):s.code=o.code;const e=await W(s);if(e.code===200&&e.data){k.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await k.fetchCurrentCustomer(),n.success("登录成功"),T("success");const y=U.query.redirect||B.redirect;j.push(y)}else n.error(e.message||"登录失败")}catch(s){n.error(s.message||"登录失败")}finally{f.value=!1}};return(s,e)=>{const y=G("router-link");return c(),u("div",{class:a(["w-full bg-white rounded-3xl animate-in fade-in zoom-in duration-500",[r.compact?"max-w-[340px]":"p-8 max-w-[420px] shadow-xl shadow-gray-200/50 border border-gray-100"]])},[t("div",{class:a(["flex items-center justify-center p-1 bg-gray-50 rounded-2xl",r.compact?"mb-1":"mb-8"])},[t("button",{onClick:e[0]||(e[0]=i=>l.value="password"),class:a(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="password"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",r.compact?"py-1.5":"py-3"]])}," 账号密码登录 ",2),t("button",{onClick:e[1]||(e[1]=i=>l.value="sms"),class:a(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="sms"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",r.compact?"py-1.5":"py-3"]])}," 短信动态登录 ",2)],2),t("div",{class:a(r.compact?"space-y-2":"space-y-5")},[t("div",ee,[e[6]||(e[6]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"手机号码",-1)),t("div",te,[t("div",oe,[b(w(O),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.mobile=i),type:"text",maxlength:"11",placeholder:"请输入11位手机号",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.mobile]])])]),l.value==="password"?(c(),u("div",se,[e[7]||(e[7]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"登录密码",-1)),t("div",re,[t("div",ae,[b(w(Y),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>o.password=i),type:"password",placeholder:"请输入您的登录密码",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.password]])])])):h("",!0),l.value==="sms"?(c(),u("div",ne,[e[8]||(e[8]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"动态验证码",-1)),t("div",le,[t("div",ie,[t("div",de,[b(w(Z),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.code=i),type:"text",maxlength:"6",placeholder:"6位验证码",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.code]])]),t("button",{onClick:L,disabled:d.value>0,class:a([r.compact?"px-4 py-1":"px-6 py-4","bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap min-w-[100px]"])},I(d.value>0?`${d.value}s`:"获取验证码"),11,ce)])])):h("",!0),t("div",{class:a(["flex items-center justify-between px-1",r.compact?"":"pt-2"])},[t("label",ue,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=i=>o.rememberMe=i),class:"hidden"},null,512),[[K,o.rememberMe]]),t("div",{class:a(["w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all",o.rememberMe?"bg-[#ff4757] border-[#ff4757]":"border-gray-200 group-hover:border-gray-300"])},[p(t("div",pe,null,512),[[R,o.rememberMe]])],2),e[9]||(e[9]=t("span",{class:"text-sm text-gray-500 font-medium"},"记住登录状态",-1))]),l.value==="password"?(c(),q(y,{key:0,to:"/forgot-password",class:"text-sm text-gray-400 hover:text-[#ff4757] transition-colors font-medium"},{default:S(()=>[...e[10]||(e[10]=[M(" 忘记密码? ",-1)])]),_:1})):h("",!0)],2),t("button",{onClick:N,disabled:f.value,class:a([r.compact?"py-1 mt-2":"py-4 mt-4","w-full bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:translate-y-0"])},[f.value?(c(),u("span",me)):(c(),u("span",ye,"立即登录"))],10,fe),t("div",{class:a(["text-center z-[101]",r.compact?"pt-1":"pt-6 pb-2"])},[e[12]||(e[12]=t("span",{class:"text-gray-400 text-sm font-medium"},"还没有账号?",-1)),b(y,{to:"/register",class:"ml-2 text-[#ff4757] text-sm font-black hover:underline underline-offset-4"},{default:S(()=>[...e[11]||(e[11]=[M(" 免费注册 ",-1)])]),_:1})],2)],2)],2)}}});export{ve as _};
