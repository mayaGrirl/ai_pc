import{d as ee,u as te,L as se,o as oe,x as z,w as ae,e as t,C as o,b as r,t as d,i as le,c as u,h as M,v as j,E as v,f as A,z as ne,F as ie,r as re,g as de,B as xe,m as pe,k as m,j as V,p as x}from"./index-Cu650ddO.js";import{_ as g}from"./coin-BjeO1Yvx.js";import{M as ue}from"./MainLayout-jx_4kQtN.js";import{T as me}from"./TextSkeleton-B2HS4_9j.js";import{_ as fe}from"./receive-sms.vue_vue_type_script_setup_true_lang-DNSHc2gp.js";import{c as ce,a as _e}from"./shop-CfZUFQwH.js";import{o as ve,s as E,n as O,u as ge,a as b,E as h,t as be}from"./vee-validate-zod-wmdbUCix.js";import{D as he}from"./decimal-CaUHonIL.js";import{S as ye}from"./constants-BNhaYc6M.js";import{C as T}from"./chevron-right-CazcJ3wa.js";import"./customer-Csfvyssn.js";import"./createLucideIcon-CLILTjWr.js";const we={class:"min-h-[calc(100vh-120px)] px-5 py-10"},ke={class:"max-w-[1400px] mx-auto grid grid-cols-[1fr_500px] gap-[30px] items-start max-[1200px]:grid-cols-1 max-[1200px]:max-w-[600px]"},Se={class:"flex flex-col gap-6"},Ce={class:"grid grid-cols-2 gap-4 max-md:grid-cols-1"},Me={class:"text-[24px] text-[#667eea] not-italic"},Ve={class:"text-[24px] text-[#667eea] not-italic"},Ee={class:"grid grid-cols-2 gap-4 max-md:grid-cols-1"},Te={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Ne={class:"flex items-center gap-1.5 mb-1"},$e={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},De={href:"/user/bank",class:"mt-1 text-[13px] text-[#667eea] no-underline hover:underline flex items-center"},Ie={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Be={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},Fe={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Le={class:"flex items-center gap-1.5 mb-1"},Re={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},Ue={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},ze={class:"flex items-center gap-1.5 mb-1"},je={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},Ae={class:"bg-white rounded-xl p-6 shadow-[0_2px_8px_rgba(0,0,0,0.1)]"},Oe=["innerHTML"],Pe={class:"sticky top-10 max-[1200px]:static"},Qe={class:"bg-white rounded-2xl p-10 shadow-[0_8px_24px_rgba(0,0,0,0.12)] max-md:p-6"},He={class:"flex gap-[1px] flex-col"},Ke={class:"relative flex items-center"},Ye={class:"flex gap-[1px] flex-col"},qe={class:"flex items-center gap-2 px-4 py-3 bg-gray-50 rounded-lg border-2 border-gray-200"},Ge={class:"text-lg font-bold text-[#333]"},Je={class:"flex gap-[1px] flex-col"},We={class:"relative flex items-center gap-2 px-4 py-3 bg-gray-50 rounded-lg border-2 border-gray-200"},Xe={class:"text-lg font-bold text-[#333]"},Ze={key:0,class:"flex gap-[1px] flex-col"},et={class:"relative flex items-center gap-1"},tt={key:1},st={class:"flex gap-[1px] flex-col"},ot={class:"relative flex items-center gap-1"},at=["value"],lt={class:"flex gap-[1px] flex-col"},nt={class:"relative flex items-center gap-1"},it=["disabled"],P=1e3,wt=ee({__name:"Shop",setup(rt){const y=xe(),{locale:Q}=te(),N=pe(),H=se[Q.value]??"USD",K=m(1),w=m(!1),$=m(!1),D=m(0),n=m(),I=m(""),B=async s=>{w.value=!0;const{data:e,code:l}=await _e();if(l==200){s&&(I.value=(e==null?void 0:e.block_content)||""),n.value=e,D.value=e.exempt_commission_bank_points||0;const i=e.bank_points||0;e.is_allowed_exchange&&i>=100&&($.value=!1)}w.value=!1},Y=ve({amount:O({message:"请输入金额"}).int("必须是整数").positive("金额必须大于 0").refine(s=>s%100===0,{message:"请输入100的整数倍"}),commission:O().optional(),safe_ask:E().optional(),answer:E().optional(),verify_code:E().optional()}).superRefine((s,e)=>{var i,c,_;const l=(i=n.value)==null?void 0:i.bank_points;l!==void 0&&s.amount>l&&e.addIssue({path:["amount"],message:"兑换金额不能超过银行余额",code:"custom"}),((c=n.value)==null?void 0:c.prize_verify_type)=="safeQuestion"&&((!s.safe_ask||s.safe_ask.length<1)&&e.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!s.answer||s.answer.length<1)&&e.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),s.answer&&s.answer.length>50&&e.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((_=n.value)==null?void 0:_.prize_verify_type)=="smsVerify"&&(!s.verify_code||s.verify_code.length<1)&&e.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),q=be(Y),{handleSubmit:G,isSubmitting:f,resetForm:J}=ge({validationSchema:q,initialValues:{safe_ask:""}}),{value:p,errorMessage:dt,meta:W}=b("amount"),{value:k}=b("safe_ask"),{value:S}=b("answer"),{value:C}=b("verify_code"),F=V(()=>Math.floor((p.value||0)*P)),X=V(()=>{if(p.value>0){const s=p.value*P,e=Math.max(0,s-D.value);return new he(e).mul(.02).div(1e3).ceil().toNumber()}return 0}),L=G(async(s,{setErrors:e})=>{f.value=!0;try{const{code:l,message:i}=await ce({amount:F.value,commission:0,safe_ask:s.safe_ask,answer:s.answer,verify_code:s.verify_code});l!==200?y.error(i):(y.success("兑换成功"),await B(!1),J())}catch(l){y.error(l.message||"提交失败")}finally{f.value=!1}}),Z=V(()=>W.valid&&!!p.value&&!f.value);return oe(()=>{B(!0)}),(s,e)=>(x(),z(ue,null,{default:ae(()=>{var l,i,c,_,R,U;return[t("div",we,[t("div",ke,[t("div",Se,[t("div",Ce,[t("button",{class:"bg-white rounded-xl px-6 py-[18px] flex justify-between items-center text-base font-medium text-[#333] transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]",onClick:e[0]||(e[0]=a=>o(N).push("/user/exchange"))},[e[7]||(e[7]=t("span",null,"兑换记录",-1)),t("i",Me,[r(o(T),{class:"h-4 w-4"})])]),t("button",{class:"bg-white rounded-xl px-6 py-[18px] flex justify-between items-center text-base font-medium text-[#333] transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]",onClick:e[1]||(e[1]=a=>o(N).push("/user/props"))},[e[8]||(e[8]=t("span",null,"我的卡密",-1)),t("i",Ve,[r(o(T),{class:"h-4 w-4"})])])]),t("div",Ee,[t("div",Te,[e[11]||(e[11]=t("div",{class:"text-sm text-gray-600 mb-2"},"银行余额",-1)),t("div",Ne,[t("span",$e,d(s.$n(((l=n.value)==null?void 0:l.bank_points)||0)),1),e[9]||(e[9]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))]),t("a",De,[e[10]||(e[10]=le(" 去存入 ",-1)),r(o(T),{class:"h-4 w-4"})])]),t("div",Ie,[e[12]||(e[12]=t("div",{class:"text-sm text-gray-600 mb-2"},"折合",-1)),t("div",Be,d(s.$n(((i=n.value)==null?void 0:i.bank_points_convert)||0,{style:"currency",currency:o(H)})),1)]),t("div",Fe,[e[14]||(e[14]=t("div",{class:"text-sm text-gray-600 mb-2"},"我的金豆",-1)),t("div",Le,[t("span",Re,d(s.$n(((c=n.value)==null?void 0:c.points)||0)),1),e[13]||(e[13]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])]),t("div",Ue,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-600 mb-2"},"近7日流水",-1)),t("div",ze,[t("span",je,d(s.$n(Number(((_=n.value)==null?void 0:_.week_water)||0))),1),e[15]||(e[15]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])])]),t("div",Ae,[e[17]||(e[17]=t("div",{class:"text-base font-bold text-[#ff4757] mb-4 pl-3 border-l-4 border-[#ff4757]"},"温馨提示",-1)),w.value?(x(),z(me,{key:0,lines:5,height:"14px",animation:"wave"})):(x(),u("div",{key:1,class:"list-none p-0 m-0",innerHTML:I.value},null,8,Oe))])]),t("div",Pe,[t("div",Qe,[e[28]||(e[28]=t("h2",{class:"text-[28px] font-bold text-[#333] mb-8 text-center max-md:text-2xl"},"金豆兑换",-1)),(x(),u("form",{onSubmit:e[6]||(e[6]=de((...a)=>o(L)&&o(L)(...a),["prevent"])),class:"flex flex-col gap-6",key:K.value},[t("div",He,[e[19]||(e[19]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"amount"},"兑换金额",-1)),t("div",Ke,[M(t("input",{type:"number",id:"amount",inputmode:"numeric",pattern:"[0-9]*",step:"100",min:"0","onUpdate:modelValue":e[2]||(e[2]=a=>v(p)?p.value=a:null),placeholder:"请输入100的整数倍",class:"px-4 py-3 pr-20 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[j,o(p),void 0,{number:!0}]]),e[18]||(e[18]=t("span",{class:"absolute right-4 text-[#666] text-sm"},"元",-1))]),r(o(h),{name:"amount",class:"text-[#ff4d4f] text-sm"})]),t("div",Ye,[e[21]||(e[21]=t("label",{class:"text-[15px] font-medium text-[#333333]"},"折合金豆",-1)),t("div",qe,[t("span",Ge,d(F.value),1),e[20]||(e[20]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])]),t("div",Je,[e[23]||(e[23]=t("label",{class:"text-[15px] font-medium text-[#333333]"},"手续费",-1)),t("div",We,[t("span",Xe,d(X.value),1),e[22]||(e[22]=t("span",{class:"absolute right-4 text-[#666] text-sm"},"元",-1))])]),((R=n.value)==null?void 0:R.prize_verify_type)=="smsVerify"?(x(),u("div",Ze,[e[24]||(e[24]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),t("div",et,[r(fe,{scene:"exchange_card",modelValue:o(C),"onUpdate:modelValue":e[3]||(e[3]=a=>v(C)?C.value=a:null),disabled:!Z.value},null,8,["modelValue","disabled"])]),r(o(h),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):A("",!0),((U=n.value)==null?void 0:U.prize_verify_type)=="safeQuestion"?(x(),u("div",tt,[t("div",st,[e[26]||(e[26]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),t("div",ot,[M(t("select",{id:"safe_ask","onUpdate:modelValue":e[4]||(e[4]=a=>v(k)?k.value=a:null),class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[e[25]||(e[25]=t("option",{key:"option-default",value:""},"请选择问题",-1)),(x(!0),u(ie,null,re(o(ye),a=>(x(),u("option",{key:`option-${a.value}`,value:String(a.value)},d(s.$t(a.i18nKey)),9,at))),128))],512),[[ne,o(k)]])]),r(o(h),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),t("div",lt,[e[27]||(e[27]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),t("div",nt,[M(t("input",{id:"answer",type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>v(S)?S.value=a:null),placeholder:"请输入答案",class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[j,o(S)]])]),r(o(h),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):A("",!0),t("button",{type:"submit",disabled:o(f)||$.value,class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},d(o(f)?"提交中...":"提交"),9,it)],32))])])])])]}),_:1}))}});export{wt as default};
