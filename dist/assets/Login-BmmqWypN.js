import{d as x,u as C,o as M,x as V,w as b,e as o,c as m,t as i,f as L,h as g,v as h,C as r,G as S,b as B,i as N,k as _,H as R,l as T,m as E,A as F,p as c,s as P}from"./index-5CuYqb8n.js";import{u as U,M as A,n as D}from"./MainLayout-DqBK_RG1.js";import{h as I}from"./common-Ch9gD02D.js";import{S as K}from"./sodium-jzn3nznW.js";const q={class:"login-page"},G={class:"login-container"},H={class:"login-form"},j={key:0,class:"error-message"},z={class:"form-group"},J={class:"input-wrapper"},O=["placeholder"],Q={class:"form-group"},W={class:"input-wrapper"},X=["placeholder"],Y={class:"form-options"},Z={class:"checkbox-label"},$={class:"button-group"},ee=["disabled"],oe={key:0,class:"loading-spinner"},se={key:1},te=x({__name:"Login",setup(ae){const{t:s}=C(),f=E(),y=F(),v=U(),d=_(!1),a=_(""),u=_(""),t=R({mobile:"",password:"",rememberMe:!1});M(()=>{I().then(({data:n,code:e})=>{e===200&&n&&(u.value=n.key)}).catch(n=>{console.error("Failed to get public key:",n)})});const w=async()=>{if(a.value="",!t.mobile){a.value=s("login.inputMobile");return}if(!t.password){a.value=s("login.inputPassword");return}if(t.password.length<6){a.value=s("login.passwordError");return}if(!u.value){a.value="ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åŽé‡è¯•";return}d.value=!0;try{const n=await K.encrypt(t.password,u.value),e=await D({mobile:t.mobile,password:n,type:1});if(e.code===200&&e.data){v.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await v.fetchCurrentCustomer();const p=y.query.redirect||"/";f.push(p)}else a.value=e.message||s("login.loginFailed")}catch(n){console.error("Login error:",n),a.value=s("login.loginFailed")}finally{d.value=!1}},k=()=>{f.push("/register")};return(n,e)=>{const p=T("router-link");return c(),V(A,null,{default:b(()=>[o("div",q,[o("div",G,[e[5]||(e[5]=o("h1",{class:"page-title"},"ç™» å½•",-1)),o("div",H,[a.value?(c(),m("div",j,i(a.value),1)):L("",!0),o("div",z,[o("div",J,[e[3]||(e[3]=o("span",{class:"input-icon"},"ðŸ“±",-1)),g(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.mobile=l),type:"text",placeholder:r(s)("login.mobile"),maxlength:"11"},null,8,O),[[h,t.mobile]])])]),o("div",Q,[o("div",W,[e[4]||(e[4]=o("span",{class:"input-icon"},"ðŸ”’",-1)),g(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.password=l),type:"password",placeholder:r(s)("login.password")},null,8,X),[[h,t.password]])])]),o("div",Y,[o("label",Z,[g(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.rememberMe=l),type:"checkbox"},null,512),[[S,t.rememberMe]]),o("span",null,i(r(s)("login.rememberMe"))+"ï¼ˆä¸æ˜¯è‡ªå·±çš„ç”µè„‘ä¸è¦å‹¾é€‰ï¼‰",1)]),B(p,{to:"/forgot-password",class:"forgot-link"},{default:b(()=>[N(i(r(s)("login.forgotPassword"))+"? ",1)]),_:1})]),o("div",$,[o("button",{type:"button",class:"btn-submit",disabled:d.value,onClick:w},[d.value?(c(),m("span",oe)):(c(),m("span",se,i(r(s)("common.login")),1))],8,ee),o("button",{type:"button",class:"btn-register",onClick:k},i(r(s)("common.register")),1)])])])])]),_:1})}}}),de=P(te,[["__scopeId","data-v-88ec2742"]]);export{de as default};
