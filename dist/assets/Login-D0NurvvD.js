import{d as x,u as C,o as M,r as m,y as V,w as f,f as o,c as g,e as E,t as i,j as _,v as h,E as L,C as r,b as S,G as B,k as N,l as P,x as R,m as T,p as c,s as F}from"./index-DjiKld-4.js";import{u as U,M as D,l as I}from"./MainLayout-DjqzOFKu.js";import{h as K,S as j}from"./sodium-DfwT-dNQ.js";const q={class:"login-page"},A={class:"login-container"},G={class:"login-form"},z={key:0,class:"error-message"},H={class:"form-group"},J={class:"input-wrapper"},O=["placeholder"],Q={class:"form-group"},W={class:"input-wrapper"},X=["placeholder"],Y={class:"form-options"},Z={class:"checkbox-label"},$={class:"button-group"},ee=["disabled"],oe={key:0,class:"loading-spinner"},se={key:1},te=x({__name:"Login",setup(ne){const{t:s}=C(),v=T(),y=R(),b=U(),d=m(!1),a=m(""),u=m(""),t=L({mobile:"",password:"",rememberMe:!1});M(()=>{K().then(({data:n,code:e})=>{e===200&&n&&(u.value=n.key,console.log("Public key loaded:",n.key))}).catch(n=>{console.error("Failed to get public key:",n)})});const w=async()=>{if(a.value="",!t.mobile){a.value=s("login.inputMobile");return}if(!t.password){a.value=s("login.inputPassword");return}if(t.password.length<6){a.value=s("login.passwordError");return}if(!u.value){a.value="ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åŽé‡è¯•";return}d.value=!0;try{const n=await j.encrypt(t.password,u.value);console.log("Encrypted password:",n);const e=await I({mobile:t.mobile,password:n,type:1});if(e.code===200&&e.data){b.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await b.fetchCurrentCustomer();const p=y.query.redirect||"/";v.push(p)}else a.value=e.message||s("login.loginFailed")}catch(n){console.error("Login error:",n),a.value=s("login.loginFailed")}finally{d.value=!1}},k=()=>{v.push("/register")};return(n,e)=>{const p=P("router-link");return c(),V(D,null,{default:f(()=>[o("div",q,[o("div",A,[e[5]||(e[5]=o("h1",{class:"page-title"},"ç™» å½•",-1)),o("div",G,[a.value?(c(),g("div",z,i(a.value),1)):E("",!0),o("div",H,[o("div",J,[e[3]||(e[3]=o("span",{class:"input-icon"},"ðŸ“±",-1)),_(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.mobile=l),type:"text",placeholder:r(s)("login.mobile"),maxlength:"11"},null,8,O),[[h,t.mobile]])])]),o("div",Q,[o("div",W,[e[4]||(e[4]=o("span",{class:"input-icon"},"ðŸ”’",-1)),_(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.password=l),type:"password",placeholder:r(s)("login.password")},null,8,X),[[h,t.password]])])]),o("div",Y,[o("label",Z,[_(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.rememberMe=l),type:"checkbox"},null,512),[[B,t.rememberMe]]),o("span",null,i(r(s)("login.rememberMe"))+"ï¼ˆä¸æ˜¯è‡ªå·±çš„ç”µè„‘ä¸è¦å‹¾é€‰ï¼‰",1)]),S(p,{to:"/forgot-password",class:"forgot-link"},{default:f(()=>[N(i(r(s)("login.forgotPassword"))+"? ",1)]),_:1})]),o("div",$,[o("button",{type:"button",class:"btn-submit",disabled:d.value,onClick:w},[d.value?(c(),g("span",oe)):(c(),g("span",se,i(r(s)("common.login")),1))],8,ee),o("button",{type:"button",class:"btn-register",onClick:k},i(r(s)("common.register")),1)])])])])]),_:1})}}}),ie=F(te,[["__scopeId","data-v-59b71a76"]]);export{ie as default};
