import{d as te,C as re,o as oe,p as P,w as ae,e,n as i,b as n,B as a,c as m,f as E,t as v,q as _,x as T,D,s as le,y as ne,F as R,r as F,k as ie,A as de,i as k,h as A,l as u,_ as ue}from"./index-BxAaS0d6.js";import{U as ce}from"./UserLayout-DW5wNeMm.js";import{f as Y,u as pe,Z as fe,$ as me,a0 as ye,a1 as ve,a2 as be}from"./MainLayout-snc9tKFv.js";import"./index-dfCaL9zS.js";import{S as ge}from"./constants-BNhaYc6M.js";import{i as xe}from"./utils-KYcPjVjn.js";import{o as he,s as G,u as we,a as L,E as U,t as _e}from"./vee-validate-zod-DqviLTpk.js";import{a as O,L as M,S as $}from"./sodium-Dde3Ep4D.js";import{h as ke}from"./common-CU63zpe6.js";import{_ as Ce}from"./receive-sms.vue_vue_type_script_setup_true_lang-D2_hDdia.js";import{C as h}from"./chevron-right-CIAvzCBC.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=Y("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=Y("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=Y("GiftIcon",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Ve={class:"flex flex-col gap-5"},Ie={class:"flex gap-6 items-start"},Se={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm min-h-[600px]"},Pe={class:"mb-6"},Ee={class:"space-y-3"},Te={class:"flex items-center gap-3"},De={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Re={class:"mb-6"},Fe={class:"space-y-3"},Ge={class:"flex items-center gap-3"},Le={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ue={class:"flex items-center gap-3"},Ye={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},We={class:"mb-6"},Ne={class:"space-y-3"},je={class:"flex items-center gap-3"},Ae={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Oe={class:"flex items-center gap-3"},Me={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},$e={class:"w-[420px] shrink-0"},Qe={class:"bg-white rounded-xl border border-gray-100 p-8 shadow-md sticky top-5 min-h-[400px]"},qe={class:"flex items-center gap-3 mb-2"},ze={class:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center"},Be={class:"text-base font-bold text-gray-800"},He={class:"space-y-4"},Ke={class:"space-y-1.5"},Ze={class:"space-y-1.5"},Je={class:"space-y-1.5"},Xe={class:"flex items-center gap-2"},es=["disabled"],ss={key:1,class:"space-y-6"},ts={class:"flex items-center gap-3 mb-2"},rs={class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"},os={class:"space-y-4"},as={class:"space-y-1.5"},ls=["value"],ns={class:"space-y-1.5"},is=["disabled"],ds={key:2,class:"space-y-6"},us={class:"flex items-center gap-3 mb-2"},cs={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},ps={class:"space-y-3 pt-2"},fs=["onClick"],ms={class:"text-sm text-gray-700 font-medium"},ys={key:3,class:"space-y-6"},vs={class:"flex items-center gap-3 mb-2"},bs={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},gs={class:"space-y-3 pt-2"},xs=["onClick"],hs={class:"text-sm text-gray-700 font-medium"},ws=te({__name:"Security",setup(_s){const B=ie(),d=de(),b=pe(),y=A(()=>b.currentCustomer),r=k("LOGIN_PWD"),c=k(!1),W=A(()=>y.value?xe(y.value.securitypass):!1),p=k({question:"",answer:""}),H=async()=>{if(!c.value){if(!p.value.question||!p.value.answer){d.error("请填写完整密保信息");return}c.value=!0;try{const{code:o,message:s}=await ye({safe_ask:p.value.question,answer:p.value.answer});o===200?(d.success("密保设置成功"),p.value={question:"",answer:""},r.value="LOGIN_PWD",b.setCurrentCustomer({securitypass:"1"})):d.error(s)}catch(o){const s=o instanceof Error?o.message:"保存失败，刷新页面请重试";d.error(s)}finally{c.value=!1}}},K=async o=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await ve({prize_verify_type:o});s===200?(d.success("兑奖验证方式已更新"),b.setCurrentCustomer({prizeVerifyType:o})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},Z=async o=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await be({select_card_verify_type:o});s===200?(d.success("查看卡密验证方式已更新"),b.setCurrentCustomer({selectcardVerifyType:o})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},C=k(""),J=he({verify_code:G().min(1,"请输入验证码"),password:G().min(8,"请输入密码"),confirm_password:G()}).refine(o=>o.password===o.confirm_password,{path:["confirm_password"],message:"两次输入的密码不一致"}),X=_e(J),{handleSubmit:ee,isSubmitting:w,resetForm:N}=we({validationSchema:X,initialValues:{password:"",confirm_password:"",verify_code:""}}),{value:V}=L("password"),{value:I}=L("confirm_password"),{value:S}=L("verify_code"),j=ee(async o=>{console.log("submitExchange",o),w.value=!0;const s=await O.encrypt(o.password,C.value),t=await O.encrypt(o.confirm_password,C.value);try{if(r.value==="LOGIN_PWD"){const{code:l,message:f}=await fe({verify_code:o.verify_code,password:s,confirm_password:t});l!==200?d.error(f):(d.success("更新成功"),N(),b.logout(),await B.push("/login"))}else{const{code:l,message:f}=await me({verify_code:o.verify_code,password:s,confirm_password:t});l!==200?d.error(f):d.success("更新成功")}}catch(l){d.error(l.message||"提交失败")}finally{w.value=!1}});return re(r,o=>{(o==="LOGIN_PWD"||o==="PAY_PWD")&&N()}),oe(()=>{ke().then(({data:o,code:s})=>{s==200&&(C.value=o.key)})}),(o,s)=>(u(),P(ce,null,{default:ae(()=>[e("div",Ve,[s[29]||(s[29]=e("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[e("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"安全中心")],-1)),e("div",Ie,[e("div",Se,[s[19]||(s[19]=e("div",{class:"mb-6 pb-4 border-b border-gray-100"},[e("h3",{class:"text-lg font-bold text-gray-800"},"安全设置"),e("p",{class:"text-sm text-gray-500 mt-1"},"定期更新您的设置，以便保护账号安全")],-1)),e("section",Pe,[s[12]||(s[12]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-[#ff6600] pl-3"}," 账户安全 ",-1)),e("div",Ee,[e("div",{onClick:s[0]||(s[0]=t=>r.value="LOGIN_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="LOGIN_PWD"?"bg-orange-50 border-orange-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Te,[e("div",De,[n(a(M),{class:"w-4 h-4 text-orange-500"})]),s[11]||(s[11]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"登录密码"),e("div",{class:"text-[11px] text-gray-400"},"用于登录账户，建议定期更换")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="LOGIN_PWD"?"text-orange-500":"text-gray-300"])},null,8,["class"])],2)])]),e("section",Re,[s[15]||(s[15]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-blue-500 pl-3"}," 支付安全 ",-1)),e("div",Fe,[e("div",{onClick:s[1]||(s[1]=t=>r.value="PAY_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="PAY_PWD"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ge,[e("div",Le,[n(a($),{class:"w-4 h-4 text-blue-500"})]),s[13]||(s[13]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"二级密码"),e("div",{class:"text-[11px] text-gray-400"},"用于资金变动、兑换等高危操作验证")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="PAY_PWD"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2),W.value?(u(),m("div",{key:0,onClick:s[2]||(s[2]=t=>r.value="SECURITY_QUEST"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="SECURITY_QUEST"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ue,[e("div",Ye,[n(a(Q),{class:"w-4 h-4 text-blue-500"})]),s[14]||(s[14]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"密保设置"),e("div",{class:"text-[11px] text-gray-400"},"找回密码、修改重要信息的最后一道防线")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="SECURITY_QUEST"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2)):E("",!0)])]),e("section",We,[s[18]||(s[18]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-purple-500 pl-3"}," 其他权限验证 ",-1)),e("div",Ne,[e("div",{onClick:s[3]||(s[3]=t=>r.value="GIFT_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="GIFT_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",je,[e("div",Ae,[n(a(z),{class:"w-4 h-4 text-purple-500"})]),s[16]||(s[16]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"兑奖验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置兑换红包或奖品时的二次验证")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="GIFT_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2),e("div",{onClick:s[4]||(s[4]=t=>r.value="CARD_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="CARD_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Oe,[e("div",Me,[n(a(q),{class:"w-4 h-4 text-purple-500"})]),s[17]||(s[17]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"查看卡密验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置查看已购卡密时的验证方式")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="CARD_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2)])])]),e("div",$e,[e("div",Qe,[r.value==="LOGIN_PWD"||r.value==="PAY_PWD"?(u(),m("form",{onSubmit:s[8]||(s[8]=le((...t)=>a(j)&&a(j)(...t),["prevent"])),key:"login-password",class:"space-y-6"},[e("div",qe,[e("div",ze,[r.value==="LOGIN_PWD"?(u(),P(a(M),{key:0,class:"w-5 h-5 text-orange-500"})):r.value==="PAY_PWD"?(u(),P(a($),{key:1,class:"w-4 h-4 text-blue-500"})):E("",!0)]),e("h4",Be,v(r.value==="LOGIN_PWD"?"修改登录密码":"修改二级密码"),1)]),e("div",He,[e("div",Ke,[s[20]||(s[20]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"password"},"新密码",-1)),_(e("input",{id:"password","onUpdate:modelValue":s[5]||(s[5]=t=>D(V)?V.value=t:null),type:"password",placeholder:"请输入新密码",class:"security-input",autocomplete:"off",spellcheck:"false"},null,512),[[T,a(V)]])]),n(a(U),{name:"password",class:"text-[#ff4d4f] text-sm"}),e("div",Ze,[s[21]||(s[21]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"confirm_password"},"确认新密码",-1)),_(e("input",{id:"confirm_password","onUpdate:modelValue":s[6]||(s[6]=t=>D(I)?I.value=t:null),type:"password",placeholder:"请再次输入新密码",autocomplete:"off",spellcheck:"false",class:"security-input"},null,512),[[T,a(I)]])]),n(a(U),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"}),e("div",Je,[s[22]||(s[22]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"verify_code"},"验证码",-1)),e("div",Xe,[n(Ce,{scene:r.value==="LOGIN_PWD"?"update_password":"update_pay_password",modelValue:a(S),"onUpdate:modelValue":s[7]||(s[7]=t=>D(S)?S.value=t:null)},null,8,["scene","modelValue"])])]),n(a(U),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"})]),e("button",{type:"submit",disabled:a(w),class:"security-btn bg-[#ff6b6b]"},v(a(w)?"提交中...":"提交修改"),9,es)],32)):r.value==="SECURITY_QUEST"&&W.value?(u(),m("div",ss,[e("div",ts,[e("div",rs,[n(a(Q),{class:"w-5 h-5 text-blue-500"})]),s[23]||(s[23]=e("h4",{class:"text-base font-bold text-gray-800"},"设置密保问题",-1))]),e("div",os,[e("div",as,[s[25]||(s[25]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保问题",-1)),_(e("select",{"onUpdate:modelValue":s[9]||(s[9]=t=>p.value.question=t),class:"security-input appearance-none"},[s[24]||(s[24]=e("option",{value:"",disabled:""},"选择您的密保问题",-1)),(u(!0),m(R,null,F(a(ge),t=>(u(),m("option",{key:`option-${t.value}`,value:String(t.value)},v(o.$t(t.i18nKey)),9,ls))),128))],512),[[ne,p.value.question]])]),e("div",ns,[s[26]||(s[26]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保答案",-1)),_(e("input",{"onUpdate:modelValue":s[10]||(s[10]=t=>p.value.answer=t),type:"text",placeholder:"请输入答案",class:"security-input"},null,512),[[T,p.value.answer]])]),e("button",{onClick:H,disabled:c.value,class:"security-btn bg-blue-500"},v(c.value?"提交中...":"提交设置"),9,is)])])):r.value==="GIFT_VERIFY"?(u(),m("div",ds,[e("div",us,[e("div",cs,[n(a(z),{class:"w-5 h-5 text-purple-500"})]),s[27]||(s[27]=e("h4",{class:"text-base font-bold text-gray-800"},"兑奖验证方式",-1))]),e("div",ps,[(u(),m(R,null,F({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,g,x;return e("div",{key:l,onClick:se=>K(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=y.value)==null?void 0:f.prizeVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",ms,v(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((g=y.value)==null?void 0:g.prizeVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((x=y.value)==null?void 0:x.prizeVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,fs)}),64))])])):r.value==="CARD_VERIFY"?(u(),m("div",ys,[e("div",vs,[e("div",bs,[n(a(q),{class:"w-5 h-5 text-purple-500"})]),s[28]||(s[28]=e("h4",{class:"text-base font-bold text-gray-800"},"查看卡密验证方式",-1))]),e("div",gs,[(u(),m(R,null,F({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,g,x;return e("div",{key:l,onClick:se=>Z(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=y.value)==null?void 0:f.selectcardVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",hs,v(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((g=y.value)==null?void 0:g.selectcardVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((x=y.value)==null?void 0:x.selectcardVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,xs)}),64))])])):E("",!0)])])])])]),_:1}))}}),Gs=ue(ws,[["__scopeId","data-v-2d2c786e"]]);export{Gs as default};
