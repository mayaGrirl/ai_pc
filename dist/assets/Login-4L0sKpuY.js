import{d as x,u as C,o as M,r as m,c as V,w as b,a as c,f as o,g,l as L,t as i,m as _,v as h,C as S,A as r,p as B,D as E,q as N,e as P,z as R,b as T}from"./index-cwfplW64.js";import{u as D,M as F,l as U}from"./MainLayout-DWWz-nA_.js";import{h as q,S as A}from"./sodium-Bmi0eeNi.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"login-page"},z={class:"login-container"},j={class:"login-form"},G={key:0,class:"error-message"},H={class:"form-group"},J={class:"input-wrapper"},O=["placeholder"],Q={class:"form-group"},W={class:"input-wrapper"},X=["placeholder"],Y={class:"form-options"},Z={class:"checkbox-label"},$={class:"button-group"},ee=["disabled"],oe={key:0,class:"loading-spinner"},se={key:1},te=x({__name:"Login",setup(ae){const{t:s}=C(),f=T(),y=R(),v=D(),d=m(!1),n=m(""),u=m(""),t=S({mobile:"",password:"",rememberMe:!1});M(()=>{q().then(({data:a,code:e})=>{e===200&&a&&(u.value=a.key,console.log("Public key loaded:",a.key))}).catch(a=>{console.error("Failed to get public key:",a)})});const w=async()=>{if(n.value="",!t.mobile){n.value=s("login.inputMobile");return}if(!t.password){n.value=s("login.inputPassword");return}if(t.password.length<6){n.value=s("login.passwordError");return}if(!u.value){n.value="ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åŽé‡è¯•";return}d.value=!0;try{const a=await A.encrypt(t.password,u.value);console.log("Encrypted password:",a);const e=await U({mobile:t.mobile,password:a,type:1});if(e.code===200&&e.data){v.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await v.fetchCurrentCustomer();const p=y.query.redirect||"/";f.push(p)}else n.value=e.message||s("login.loginFailed")}catch(a){console.error("Login error:",a),n.value=s("login.loginFailed")}finally{d.value=!1}},k=()=>{f.push("/register")};return(a,e)=>{const p=P("router-link");return c(),V(F,null,{default:b(()=>[o("div",K,[o("div",z,[e[5]||(e[5]=o("h1",{class:"page-title"},"ç™» å½•",-1)),o("div",j,[n.value?(c(),g("div",G,i(n.value),1)):L("",!0),o("div",H,[o("div",J,[e[3]||(e[3]=o("span",{class:"input-icon"},"ðŸ“±",-1)),_(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.mobile=l),type:"text",placeholder:r(s)("login.mobile"),maxlength:"11"},null,8,O),[[h,t.mobile]])])]),o("div",Q,[o("div",W,[e[4]||(e[4]=o("span",{class:"input-icon"},"ðŸ”’",-1)),_(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.password=l),type:"password",placeholder:r(s)("login.password")},null,8,X),[[h,t.password]])])]),o("div",Y,[o("label",Z,[_(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.rememberMe=l),type:"checkbox"},null,512),[[E,t.rememberMe]]),o("span",null,i(r(s)("login.rememberMe"))+"ï¼ˆä¸æ˜¯è‡ªå·±çš„ç”µè„‘ä¸è¦å‹¾é€‰ï¼‰",1)]),B(p,{to:"/forgot-password",class:"forgot-link"},{default:b(()=>[N(i(r(s)("login.forgotPassword"))+"? ",1)]),_:1})]),o("div",$,[o("button",{type:"button",class:"btn-submit",disabled:d.value,onClick:w},[d.value?(c(),g("span",oe)):(c(),g("span",se,i(r(s)("common.login")),1))],8,ee),o("button",{type:"button",class:"btn-register",onClick:k},i(r(s)("common.register")),1)])])])])]),_:1})}}}),de=I(te,[["__scopeId","data-v-59b71a76"]]);export{de as default};
