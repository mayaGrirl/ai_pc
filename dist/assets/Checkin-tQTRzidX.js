import{U as Z}from"./UserLayout-_TvTq9NM.js";import{i as tt,j as et,e as Q,k as st,l as nt}from"./customer-CEo_dkBH.js";import{u as V,D as H}from"./DataTable-Kru8sG0X.js";import{T as at}from"./TextSkeleton-BnSL7egb.js";import{g as ot,a as it}from"./common-5kmoTVJ7.js";import{d as Y,o as U,c as y,F as N,e as t,C as i,x as j,b as F,w,t as r,k as D,p as g,i as b,D as rt,r as G,n as L,f as J,j as P,B as lt,s as ct}from"./index-e_J8t8Nx.js";import{d as K}from"./dayjs.min-BAJkae7J.js";import{g as dt}from"./verify-key-CUJrgnew.js";import"./MainLayout-DhlqgofP.js";import"./createLucideIcon-B3uh1WYA.js";const ut={class:"bg-white p-1"},pt=["innerHTML"],ft={class:"flex justify-center items-center gap-1"},gt=["src"],xt=Y({__name:"SignIntro",setup(B){const x=D(""),o=async()=>{a.value=!0;const{data:d,code:n}=await ot("customer_sign_in_tips");n==200&&(x.value=(d==null?void 0:d.content)||""),a.value=!1},{loading:a,dataSource:l,hasMore:c,pagination:p,loadData:h,changePage:k}=V(it),m=[{key:"level",title:"生态值等级",width:"20%",align:"center"},{key:"remark",title:"签到奖励",width:"25%",align:"center"}];return U(()=>{o(),h()}),(d,n)=>(g(),y(N,null,[t("div",ut,[i(a)?(g(),j(at,{key:0,lines:5,height:"14px",animation:"wave"})):(g(),y("div",{key:1,class:"list-none p-0 m-0",innerHTML:x.value},null,8,pt))]),F(H,{columns:m,data:i(l),loading:i(a),pagination:i(p),onChange:i(k),showPagination:!1,hasMore:i(c)},{"column-level":w(({row:_})=>[t("div",ft,[t("img",{alt:"coin",class:"inline-block w-[20px] h-[20px]",src:`/level/${_.level}.png`},null,8,gt)])]),"column-remark":w(({row:_})=>[t("div",null,"签到可获得。开箱积分: "+r(_.sign_in_blessing)+" * 连续签到天数。金豆: "+r(_.sign_in_points)+" * 连续签到天数",1)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),_t=Y({__name:"SignMember",setup(B){const x=m=>{const d=K(),n=K(m);if(d.diff(n,"second")<60)return"刚刚";const C=d.diff(n,"minute");if(C<60)return C+"分钟前";const M=d.diff(n,"hour");if(M<24)return M+"小时前";const S=d.diff(n,"day");return S<30?S+"天前":d.diff(n,"month")+"个月前"},{loading:o,dataSource:a,hasMore:l,pagination:c,loadData:p,changePage:h}=V(tt),k=[{key:"nickname",title:"用户",width:"25%",align:"center"},{key:"reward_points",title:"金豆",width:"25%",align:"center"},{key:"reward_base_coin",title:"积分",width:"25%",align:"center"},{key:"sign_date",title:"签到日期",width:"25%",align:"center"}];return U(()=>{p()}),(m,d)=>(g(),j(H,{columns:k,data:i(a),loading:i(o),pagination:i(c),onChange:i(h),showPagination:!1,hasMore:i(l)},{"column-nickname":w(({row:n})=>{var _;return[t("div",null,r(((_=n==null?void 0:n.member_field)==null?void 0:_.nickname)||(n==null?void 0:n.member_id)),1)]}),"column-sign_date":w(({row:n})=>[t("div",null,r(x(n.created_at)),1)]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),vt=Y({__name:"SignRecord",setup(B){const{loading:x,dataSource:o,hasMore:a,pagination:l,loadData:c,changePage:p}=V(et,{defaultSize:10,initQuery:{t:dt()}}),h=[{key:"reward_points",title:"金豆",width:"25%",align:"center"},{key:"reward_base_coin",title:"积分",width:"25%",align:"center"},{key:"sign_date",title:"签到日期",width:"25%",align:"center"}];return c(),(k,m)=>(g(),j(H,{columns:h,data:i(o),loading:i(x),pagination:i(l),onChange:i(p),hasMore:i(a)},{default:w(()=>[...m[0]||(m[0]=[b(" // 自定义列 ",-1)])]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),mt={class:"flex flex-col gap-5"},ht={class:"flex gap-5 border-b border-[#eee] pb-[15px]"},bt=["onClick"],yt={key:0},kt={class:"flex justify-around items-center gap-[30px]"},wt={class:"text-center text-[13px] text-[#666]"},Dt={class:"font-bold text-[#ff6600]"},Ct={class:"font-bold text-[#ff6600]"},Mt={class:"flex"},St={class:"flex items-center gap-2.5"},Tt={class:"text-base font-bold text-[#ff6600]"},$t={class:"flex items-center gap-2.5"},Ft={class:"text-base font-bold text-[#ff6600]"},Yt={class:"text-base font-bold text-[#ff6600]"},jt={class:"flex justify-between"},Bt={class:"w-5/12"},It={class:"mb-[15px] flex items-center justify-center gap-1"},Lt={class:"text-[16px] font-bold text-[#333]"},Pt={class:"grid grid-cols-7 gap-1"},Nt={class:"my-5 text-center"},Vt=["disabled"],Ht={class:"w-6/12"},Ut={class:"bg-white"},zt={key:1},Et=Y({__name:"Checkin",setup(B){const x=lt(),o=D(),a=D(new Date),l=P(()=>a.value.getMonth()+1),c=P(()=>a.value.getFullYear()),p=D([]),h=new Date().getDate(),k=P(()=>{const s=[],e=new Date(c.value,l.value-1,1).getDay(),v=new Date(c.value,l.value,0).getDate();for(let u=0;u<e;u++)s.push(null);for(let u=1;u<=v;u++)s.push(u);return s}),m=()=>{a.value=new Date(c.value,l.value-2,1)},d=()=>{a.value=new Date(c.value,l.value,1)},n=()=>{const s=new Date(a.value);s.setFullYear(s.getFullYear()-1),a.value=s},_=()=>{const s=new Date(a.value);s.setFullYear(s.getFullYear()+1),a.value=s},C=async()=>{try{const s=await st();if(s.code===200){p.value.push(h),x.success("签到成功");const{data:e,code:v}=await Q();v===200&&e&&(o.value=e)}else x.error(s.message)}catch(s){const e=s instanceof Error?s.message:"签到失败";console.error("Sign in error:",s),x.error(e)}},M=s=>s?p.value.includes(s):!1,S=s=>{if(!s)return!1;const e=new Date;return s===e.getDate()&&l.value===e.getMonth()+1&&c.value===e.getFullYear()},I=async()=>{const s=c.value,e=l.value.toString().padStart(2,"0");try{const{code:v,data:u}=await nt(`${s}-${e}`);v===200&&u?p.value=u.map($=>new Date($).getDate()):p.value=[]}catch(v){console.error("Fetch signed dates error:",v),p.value=[]}};rt(a,()=>{I()}),U(async()=>{try{const{data:s,code:e}=await Q();e===200&&s&&(o.value=s),await I()}catch(s){console.error("Failed to load sign stats:",s)}});const T=D("sign"),W=[{key:"sign",name:"签到"},{key:"record",name:"签到记录"}],X=s=>{T.value=s};return(s,e)=>(g(),j(Z,null,{default:w(()=>{var v,u,$,z,E,R,q,A;return[t("div",mt,[t("div",ht,[(g(),y(N,null,G(W,f=>t("span",{key:f.key,class:L(["w-20 text-center text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 ",{"text-[#ff6600] border-b-[#ff6600]":T.value===f.key}]),onClick:O=>X(f.key)},r(f.name),11,bt)),64))]),T.value==="sign"?(g(),y("div",yt,[t("div",kt,[t("div",wt,[e[0]||(e[0]=b(" 连续签到 ",-1)),t("span",Dt,r(((v=o.value)==null?void 0:v.continue_days)||0),1),e[1]||(e[1]=b(" 天，累计签到 ",-1)),t("span",Ct,r(((u=o.value)==null?void 0:u.total_days)||0),1),e[2]||(e[2]=b(" 天 ",-1))]),t("div",Mt,[t("div",St,[e[3]||(e[3]=t("span",{class:"text-[15px] font-medium text-[#333333]"},"今日签到:",-1)),t("span",Tt,r(($=o.value)==null?void 0:$.total_people),1),e[4]||(e[4]=b(" 人 ",-1))]),t("div",$t,[e[5]||(e[5]=t("span",{class:"text-[15px] font-medium text-[#333333]"},"累计送出:",-1)),t("span",Ft,r((z=o.value)==null?void 0:z.total_points),1),e[6]||(e[6]=b(" 金豆 ",-1)),t("span",Yt,r((E=o.value)==null?void 0:E.total_base_coin),1),e[7]||(e[7]=b(" 积分 ",-1))])])]),t("div",jt,[t("div",Bt,[t("div",It,[t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:n},"<<"),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:m},"<"),t("span",Lt,r(c.value)+"年 "+r(l.value)+"月 ",1),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:d},">"),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:_},">>")]),e[8]||(e[8]=t("div",{class:"mb-[10px] grid grid-cols-7 text-center"},[t("span",{class:"p-2 text-[13px] text-[#999]"},"日"),t("span",{class:"p-2 text-[13px] text-[#999]"},"一"),t("span",{class:"p-2 text-[13px] text-[#999]"},"二"),t("span",{class:"p-2 text-[13px] text-[#999]"},"三"),t("span",{class:"p-2 text-[13px] text-[#999]"},"四"),t("span",{class:"p-2 text-[13px] text-[#999]"},"五"),t("span",{class:"p-2 text-[13px] text-[#999]"},"六")],-1)),t("div",Pt,[(g(!0),y(N,null,G(k.value,(f,O)=>(g(),y("span",{key:O,class:L(["aspect-square flex items-center justify-center rounded text-[14px] text-[#333]",[f?"cursor-pointer":"cursor-default",f&&M(f)?"bg-[#ff6600] text-white":"",f&&S(f)?"border-2 border-[#ff6600]":""]])},r(f||""),3))),128))]),t("div",Nt,[t("button",{disabled:(R=o.value)==null?void 0:R.is_sign,class:L(["cursor-pointer rounded bg-gradient-to-br px-[50px] py-3 text-[16px] text-white hover:opacity-90",[(q=o.value)!=null&&q.is_sign?"from-[#cccccc] to-[#cccccc]":"from-[#ff6600] to-[#ff8533]"]]),onClick:C},r((A=o.value)!=null&&A.is_sign?"已签到":"立即签到"),11,Vt)])]),t("div",Ht,[e[9]||(e[9]=t("div",{class:"text-center text-[16px] font-bold text-[#333] mb-[15px] py-2"},"近期签到用户",-1)),F(_t)])]),t("div",Ut,[F(xt)])])):J("",!0),T.value==="record"?(g(),y("div",zt,[F(vt)])):J("",!0)])]}),_:1}))}}),Zt=ct(Et,[["__scopeId","data-v-260554fd"]]);export{Zt as default};
