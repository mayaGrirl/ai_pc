import{d as F,o as N,g as T,q as _,w as q,a as t,j as a,h as i,n as g,c as d,s as w,y as V,t as j,k as K,i as h,E as M,G as P,F as G,r as O,m as Z,b as p,I as H,e as k,B as J,f as n}from"./index-zIWHOxTS.js";import{c as Q,S as W,M as X,q as Y,t as ee,v as te}from"./MainLayout-COWgiZN-.js";import{h as se}from"./common-C5wKinOu.js";import{L as C,S as oe,E,a as I,b as L}from"./sodium-G9HT2YD1.js";import{A as re}from"./arrow-left-BLxWwIae.js";import{C as R}from"./chevron-right-4Oal6Wdk.js";import{A as ae,M as ne}from"./message-square-C-NMsYF_.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Q("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ie={class:"min-h-[calc(100vh-160px)] bg-gray-50/50 flex items-center justify-center p-6 relative overflow-hidden"},de={class:"w-full max-w-[500px] bg-white rounded-[32px] shadow-2xl shadow-gray-200/50 border border-white p-10 relative z-10 animate-in fade-in zoom-in duration-500"},ue={class:"text-center mb-10"},ce={class:"inline-flex items-center justify-center w-16 h-16 bg-red-50 rounded-2xl mb-6"},fe={class:"flex items-center justify-center gap-4 mb-10"},pe={key:0,class:"space-y-6 animate-in slide-in-from-right-4 duration-500"},ge={class:"space-y-2"},ye={class:"relative group"},me={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},xe={class:"space-y-2"},be={class:"flex gap-3"},ve={class:"relative flex-1 group"},we={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},he=["disabled"],_e=["disabled"],ke={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},Ce={key:1,class:"flex items-center gap-2"},Se={key:1,class:"space-y-6 animate-in slide-in-from-right-4 duration-500"},Ve={class:"space-y-2"},je={class:"relative group"},Me={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},Pe=["type"],Ee={key:0,class:"px-1 pt-1 flex items-center justify-between"},Ie={class:"flex gap-1 flex-1 max-w-[160px]"},Le={class:"space-y-2"},Re={class:"relative group"},$e={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ze=["type"],Ae=["disabled"],Be={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},Ue={key:1},De={key:2,class:"text-center py-6 animate-in zoom-in duration-500"},Fe={class:"inline-flex items-center justify-center w-24 h-24 bg-green-50 rounded-full mb-8"},Ne={class:"mt-12 pt-8 border-t border-gray-50 flex items-center justify-center gap-2 text-sm text-gray-400"},Qe=F({__name:"ForgotPassword",setup(Te){const S=Z(),l=J(),u=p(1),c=p(!1),y=p(!1),m=p(!1),f=p(0),x=p("");let b=null;const o=H({mobile:"",verify_code:"",password:"",confirm_password:""});N(async()=>{try{const s=await se();s.code===200&&s.data&&(x.value=s.data.key)}catch(s){console.error("Failed to get public key:",s)}}),T(()=>{b&&clearInterval(b)});const $=()=>{f.value=60,b=setInterval(()=>{f.value--,f.value<=0&&clearInterval(b)},1e3)},z=async()=>{if(!o.mobile||!/^1[3-9]\d{9}$/.test(o.mobile)){l.error("请输入正确的手机号");return}try{const s=await Y(o.mobile);s.code===200?(l.success("验证码已发送"),$()):l.error(s.message||"发送验证码失败")}catch(s){l.error(s.message||"发送验证码失败")}},A=async()=>{if(!o.mobile||!o.verify_code){l.error("请填写手机号和验证码");return}c.value=!0;try{const s=await ee({mobile:o.mobile,verify_code:o.verify_code,password:"",confirm_password:""});s.code===200?u.value=2:l.error(s.message||"验证码错误")}catch(s){l.error(s.message||"验证失败")}finally{c.value=!1}},v=k(()=>{const s=o.password;if(!s)return 0;let e=0;return s.length>=6&&e++,s.length>=8&&e++,/[A-Z]/.test(s)&&e++,/[0-9]/.test(s)&&e++,Math.min(e,4)}),B=k(()=>["太简单","弱","中","强","极强"][v.value]),U=k(()=>["bg-gray-100","bg-red-400","bg-orange-400","bg-yellow-400","bg-green-500"][v.value]),D=async()=>{if(!o.password||o.password.length<8){l.error("密码长度至少为8位");return}if(o.password!==o.confirm_password){l.error("两次输入的密码不一致");return}c.value=!0;try{let s=o.password,e=o.confirm_password;x.value&&(s=await L.encrypt(o.password,x.value),e=await L.encrypt(o.confirm_password,x.value));const r=await te({mobile:o.mobile,verify_code:o.verify_code,password:s,confirm_password:e});r.code===200?u.value=3:l.error(r.message||"提交失败")}catch(s){l.error(s.message||"提交错误")}finally{c.value=!1}};return(s,e)=>(n(),_(X,null,{default:q(()=>[t("div",ie,[e[22]||(e[22]=t("div",{class:"absolute top-0 right-0 w-[500px] h-[500px] bg-red-50/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"},null,-1)),e[23]||(e[23]=t("div",{class:"absolute bottom-0 left-0 w-[300px] h-[300px] bg-blue-50/50 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none"},null,-1)),t("div",de,[t("button",{onClick:e[0]||(e[0]=r=>a(S).push("/login")),class:"absolute top-8 left-8 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-full transition-all group"},[i(a(re),{class:"w-5 h-5 group-hover:-translate-x-0.5 transition-transform"})]),t("div",ue,[t("div",ce,[i(a(C),{class:"w-8 h-8 text-[#ff4757]"})]),e[8]||(e[8]=t("h1",{class:"text-3xl font-black text-gray-900 tracking-tight mb-2"},"找回密码",-1)),e[9]||(e[9]=t("p",{class:"text-gray-500 font-medium"},"账户安全保护为您提供快速密码重置",-1))]),t("div",fe,[t("div",{class:g(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",u.value>=1?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...e[10]||(e[10]=[t("span",null,"01",-1),t("span",{class:"hidden sm:inline"},"身份验证",-1)])],2),i(a(R),{class:"w-4 h-4 text-gray-200"}),t("div",{class:g(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",u.value>=2?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...e[11]||(e[11]=[t("span",null,"02",-1),t("span",{class:"hidden sm:inline"},"重置密码",-1)])],2),i(a(R),{class:"w-4 h-4 text-gray-200"}),t("div",{class:g(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",u.value>=3?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...e[12]||(e[12]=[t("span",null,"03",-1),t("span",{class:"hidden sm:inline"},"完成",-1)])],2)]),u.value===1?(n(),d("div",pe,[t("div",ge,[e[13]||(e[13]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"注册手机号",-1)),t("div",ye,[t("div",me,[i(a(W),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.mobile=r),type:"text",maxlength:"11",placeholder:"请输入注册时绑定的手机号",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[V,o.mobile]])])]),t("div",xe,[e[14]||(e[14]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"短信验证码",-1)),t("div",be,[t("div",ve,[t("div",we,[i(a(oe),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.verify_code=r),type:"text",maxlength:"6",placeholder:"6位验证码",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[V,o.verify_code]])]),t("button",{onClick:z,disabled:f.value>0,class:"px-6 py-4 bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap min-w-[120px]"},j(f.value>0?`${f.value}s`:"获取验证码"),9,he)])]),t("button",{onClick:A,disabled:c.value,class:"w-full py-4 mt-4 bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70"},[c.value?(n(),d("span",ke)):(n(),d("span",Ce,[e[15]||(e[15]=K("下一步 ",-1)),i(a(ae),{class:"w-4 h-4"})]))],8,_e)])):h("",!0),u.value===2?(n(),d("div",Se,[t("div",Ve,[e[16]||(e[16]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"新登录密码",-1)),t("div",je,[t("div",Me,[i(a(C),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.password=r),type:y.value?"text":"password",placeholder:"建议包含字母和数字",class:"w-full pl-12 pr-12 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,8,Pe),[[M,o.password]]),t("button",{type:"button",onClick:e[4]||(e[4]=r=>y.value=!y.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(n(),_(P(y.value?a(E):a(I)),{class:"w-5 h-5"}))])]),o.password?(n(),d("div",Ee,[t("div",Ie,[(n(),d(G,null,O(4,r=>t("div",{key:r,class:g(["h-1.5 flex-1 rounded-full transition-all duration-500",r<=v.value?U.value:"bg-gray-100"])},null,2)),64))]),t("span",{class:g(["text-[11px] font-bold",v.value>0?"text-gray-500":"text-gray-300"])}," 强度: "+j(B.value),3)])):h("",!0)]),t("div",Le,[e[17]||(e[17]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"确认新密码",-1)),t("div",Re,[t("div",$e,[i(a(C),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),w(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.confirm_password=r),type:m.value?"text":"password",placeholder:"请再次确认您的新密码",class:"w-full pl-12 pr-12 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,8,ze),[[M,o.confirm_password]]),t("button",{type:"button",onClick:e[6]||(e[6]=r=>m.value=!m.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(n(),_(P(m.value?a(E):a(I)),{class:"w-5 h-5"}))])])]),t("button",{onClick:D,disabled:c.value,class:"w-full py-4 mt-4 bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70"},[c.value?(n(),d("span",Be)):(n(),d("span",Ue,"重置并登录"))],8,Ae)])):h("",!0),u.value===3?(n(),d("div",De,[t("div",Fe,[i(a(le),{class:"w-12 h-12 text-green-500"})]),e[18]||(e[18]=t("h2",{class:"text-3xl font-black text-gray-900 mb-2"},"重置成功",-1)),e[19]||(e[19]=t("p",{class:"text-gray-500 font-medium mb-10"},"您的登录密码已更新，请重新登录账号。",-1)),t("button",{onClick:e[7]||(e[7]=r=>a(S).push("/login")),class:"w-full py-4 bg-gray-900 text-white font-black rounded-2xl hover:bg-gray-800 transition-all"}," 去登录 ")])):h("",!0),t("div",Ne,[i(a(ne),{class:"w-4 h-4"}),e[20]||(e[20]=t("span",null,"无法获取验证码? ",-1)),e[21]||(e[21]=t("a",{href:"#",class:"text-[#ff4757] font-bold hover:underline"},"请联系您的代理",-1))])])])]),_:1}))}});export{Qe as default};
