import{j as $,J as C,K as T,o as F,M as J,C as f,N as G,d as O,u as X,L as Z,c as k,F as Y,e as a,i as P,b as S,w as E,t as M,p as _,B as H,x as ee,E as L,f as D,h as U,z as te,r as oe,v as se,g as ae,k as j}from"./index-ayPqTr_Y.js";import{U as ne}from"./UserLayout-CQoWg2MH.js";import"./index-D6sYIBjf.js";import{_ as re,S as le}from"./constants-CiUWXy2C.js";import{o as ie,s as R,u as ce,a as A,E as I,t as ue}from"./vee-validate-zod-sUHDuPJr.js";import{k as de}from"./customer-CEEIrBTs.js";import{g as Q,s as fe}from"./verify-key-CUJrgnew.js";import{_ as pe}from"./coin-BjeO1Yvx.js";import{a as me,i as q,w as ve,t as ge,c as ye,b as xe,d as N,u as he,D as be}from"./DataTable-Cw2HHi1_.js";import{b as _e}from"./shop-CXUHu61z.js";import{d as we}from"./dayjs.min-BAJkae7J.js";import{u as ke}from"./MainLayout-DH6Yef2Z.js";import"./createLucideIcon-Pv_h4nr-.js";const Se=q?window:void 0,K=q?window.navigator:void 0;function Ce(i){var n;const v=C(i);return(n=v==null?void 0:v.$el)!=null?n:v}function W(...i){const n=[],v=()=>{n.forEach(s=>s()),n.length=0},u=(s,c,r,d)=>(s.addEventListener(c,r,d),()=>s.removeEventListener(c,r,d)),m=$(()=>{const s=N(C(i[0])).filter(c=>c!=null);return s.every(c=>typeof c!="string")?s:void 0}),g=ve(()=>{var s,c;return[(c=(s=m.value)==null?void 0:s.map(r=>Ce(r)))!=null?c:[Se].filter(r=>r!=null),N(C(m.value?i[1]:i[0])),N(f(m.value?i[2]:i[1])),C(m.value?i[3]:i[2])]},([s,c,r,d])=>{if(v(),!(s!=null&&s.length)||!(c!=null&&c.length)||!(r!=null&&r.length))return;const y=xe(d)?{...d}:d;n.push(...s.flatMap(b=>c.flatMap(w=>r.map(o=>u(b,w,o,y)))))},{flush:"post"}),h=()=>{g(),v()};return ge(v),h}function Me(){const i=T(!1),n=J();return n&&F(()=>{i.value=!0},n),i}function z(i){const n=Me();return $(()=>(n.value,!!i()))}function B(i,n={}){const{controls:v=!1,navigator:u=K}=n,m=z(()=>u&&"permissions"in u),g=T(),h=typeof i=="string"?{name:i}:i,s=T(),c=()=>{var d,y;s.value=(y=(d=g.value)==null?void 0:d.state)!=null?y:"prompt"};W(g,"change",c,{passive:!0});const r=ye(async()=>{if(m.value){if(!g.value)try{g.value=await u.permissions.query(h)}catch{g.value=void 0}finally{c()}if(v)return G(g.value)}});return r(),v?{state:s,isSupported:m,query:r}:s}function Te(i={}){const{navigator:n=K,read:v=!1,source:u,copiedDuring:m=1500,legacy:g=!1}=i,h=z(()=>n&&"clipboard"in n),s=B("clipboard-read"),c=B("clipboard-write"),r=$(()=>h.value||g),d=T(""),y=T(!1),b=me(()=>y.value=!1,m,{immediate:!1});async function w(){let e=!(h.value&&p(s.value));if(!e)try{d.value=await n.clipboard.readText()}catch{e=!0}e&&(d.value=x())}r.value&&v&&W(["copy","cut"],w,{passive:!0});async function o(e=C(u)){if(r.value&&e!=null){let l=!(h.value&&p(c.value));if(!l)try{await n.clipboard.writeText(e)}catch{l=!0}l&&t(e),d.value=e,y.value=!0,b.start()}}function t(e){const l=document.createElement("textarea");l.value=e??"",l.style.position="absolute",l.style.opacity="0",document.body.appendChild(l),l.select(),document.execCommand("copy"),l.remove()}function x(){var e,l,V;return(V=(l=(e=document==null?void 0:document.getSelection)==null?void 0:e.call(document))==null?void 0:l.toString())!=null?V:""}function p(e){return e==="granted"||e==="prompt"}return{isSupported:r,text:d,copied:y,copy:o}}const Ve={class:"text-orange-600 font-bold"},Ee={class:"text-xs"},$e={class:"text-gray-400 text-xs"},Le=["onClick"],Re=O({__name:"PropsRecord",setup(i){const{locale:n}=X(),v=Z[n.value]??"USD",u=H(),{copy:m,isSupported:g}=Te(),{loading:h,dataSource:s,hasMore:c,pagination:r,loadData:d,changePage:y,query:b,reload:w}=he(_e,{defaultSize:10,initQuery:{t:Q()}}),o=[{key:"no",title:"卡号",width:"20%",align:"center"},{key:"pwd",title:"卡密",width:"25%",align:"center"},{key:"points",title:"金豆",width:"15%",align:"center"},{key:"addtime",title:"获得时间",width:"20%",align:"center"},{key:"operation",title:"操作",width:"15%",align:"center"}],t=async()=>{if(!s.value.length){u.warning("暂无数据可复制");return}const p=s.value.filter(e=>e.state===0).map(e=>`${e.no} ${e.pwd}`).join(`
`);if(!p){u.warning("没有待使用的卡密可复制");return}g.value?(await m(p),u.success("已复制所有可用卡密")):u.error("您的浏览器不支持自动复制")},x=async(p,e)=>{const l=`${p} ${e}`;g.value?(await m(l),u.success("已复制")):u.error("您的浏览器不支持自动复制")};return d(),(p,e)=>(_(),k(Y,null,[a("div",{class:"flex justify-between items-center mb-4 px-1"},[e[1]||(e[1]=a("h3",{class:"text-lg font-bold text-gray-800"},"兑换记录",-1)),a("div",{class:"flex items-center gap-2"},[a("button",{onClick:t,class:"text-sm font-medium text-orange-600 hover:text-orange-700 hover:bg-orange-50 px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1"},[...e[0]||(e[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})],-1),P(" 复制可用卡密 ",-1)])])])]),S(be,{columns:o,data:f(s),loading:f(h),pagination:f(r),onChange:f(y),hasMore:f(c)},{"column-points":E(({row:l})=>[a("div",Ve,[P(M(p.$n(l.points))+" ",1),e[2]||(e[2]=a("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:pe},null,-1))]),a("div",Ee,M(p.$n((l.points||0)/1e3,{style:"currency",currency:f(v)})),1)]),"column-addtime":E(({row:l})=>[a("span",$e,M(f(we).unix(l.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),"column-operation":E(({row:l})=>[a("span",{class:"cursor-pointer text-orange-600 hover:text-orange-700 hover:bg-orange-50",onClick:V=>x(l.no,l.pwd)},"复制",8,Le)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),Ae={class:"flex flex-col gap-5"},Ie={key:0,class:"flex gap-[1px] flex-col"},Ne={class:"relative flex items-center gap-1"},Pe={key:1},De={class:"flex gap-[1px] flex-col"},Ue={class:"relative flex items-center gap-1"},je=["value"],Be={class:"flex gap-[1px] flex-col"},Fe={class:"relative flex items-center gap-1"},Oe=["disabled"],Ye={key:1},st=O({__name:"Props",setup(i){const n=H(),v=ke(),u=$(()=>v.currentCustomer),m=j(!1),g=j(1),h=ie({safe_ask:R().optional(),answer:R().optional(),verify_code:R().optional()}).superRefine((o,t)=>{var x,p;((x=u.value)==null?void 0:x.selectcardVerifyType)=="safeQuestion"&&((!o.safe_ask||o.safe_ask.length<1)&&t.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!o.answer||o.answer.length<1)&&t.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),o.answer&&o.answer.length>50&&t.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((p=u==null?void 0:u.value)==null?void 0:p.selectcardVerifyType)=="smsVerify"&&(!o.verify_code||o.verify_code.length<1)&&t.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),s=ue(h),{handleSubmit:c,isSubmitting:r}=ce({validationSchema:s,initialValues:{safe_ask:""}}),{value:d}=A("safe_ask"),{value:y}=A("answer"),{value:b}=A("verify_code"),w=c(async(o,{setErrors:t})=>{r.value=!0;try{const{code:x,message:p,data:e}=await de({safe_ask:o==null?void 0:o.safe_ask,answer:o==null?void 0:o.answer,verify_code:o==null?void 0:o.verify_code});x!==200?n.error(p):(n.success("验证成功"),m.value=!0,fe(e.key,480))}catch(x){n.error(x.message||"提交失败")}finally{r.value=!1}});return F(()=>{(async()=>{try{m.value=!!Q()}catch{m.value=!1}})()}),(o,t)=>(_(),ee(ne,null,{default:E(()=>{var x,p;return[a("div",Ae,[t[8]||(t[8]=a("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[a("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"我的道具")],-1)),m.value?(_(),k("div",Ye,[S(Re)])):(_(),k("form",{onSubmit:t[3]||(t[3]=ae((...e)=>f(w)&&f(w)(...e),["prevent"])),class:"flex flex-col gap-6",key:g.value},[((x=u.value)==null?void 0:x.selectcardVerifyType)=="smsVerify"?(_(),k("div",Ie,[t[4]||(t[4]=a("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),a("div",Ne,[S(re,{scene:"exchange_card",modelValue:f(b),"onUpdate:modelValue":t[0]||(t[0]=e=>L(b)?b.value=e:null)},null,8,["modelValue"])]),S(f(I),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):D("",!0),((p=u.value)==null?void 0:p.selectcardVerifyType)=="safeQuestion"?(_(),k("div",Pe,[a("div",De,[t[6]||(t[6]=a("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),a("div",Ue,[U(a("select",{id:"safe_ask","onUpdate:modelValue":t[1]||(t[1]=e=>L(d)?d.value=e:null),class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[t[5]||(t[5]=a("option",{key:"option-default",value:""},"请选择问题",-1)),(_(!0),k(Y,null,oe(f(le),e=>(_(),k("option",{key:`option-${e.value}`,value:String(e.value)},M(o.$t(e.i18nKey)),9,je))),128))],512),[[te,f(d)]])]),S(f(I),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),a("div",Be,[t[7]||(t[7]=a("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),a("div",Fe,[U(a("input",{id:"answer",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>L(y)?y.value=e:null),placeholder:"请输入答案",class:"px-4 py-3 border-2 border-gray-200 rounded-lg text-sm transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[se,f(y)]])]),S(f(I),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):D("",!0),a("button",{type:"submit",disabled:f(r),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},M(f(r)?"提交中...":"提交"),9,Oe)],32))])]}),_:1}))}});export{st as default};
