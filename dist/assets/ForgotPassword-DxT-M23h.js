import{d as M,o as P,a as R,p as z,w as B,e,B as r,b as n,n as b,c,q as m,x as y,t as I,g as L,f as w,k as U,i as x,G as A,A as N,l as u}from"./index-Bad7g1j9.js";import{f as $,S as q,M as T,q as D,t as E,v as F}from"./MainLayout-Diwk1wnn.js";import{h as K}from"./common-Dt6TVfMT.js";import{L as v,S as G,a as _}from"./sodium-BDuIr91z.js";import{A as H,a as J,M as O}from"./message-square-vwQVPwoi.js";import{C as k}from"./chevron-right-B5ZPVwFg.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=$("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),W={class:"min-h-[calc(100vh-160px)] bg-gray-50/50 flex items-center justify-center p-6 relative overflow-hidden"},X={class:"w-full max-w-[500px] bg-white rounded-[32px] shadow-2xl shadow-gray-200/50 border border-white p-10 relative z-10 animate-in fade-in zoom-in duration-500"},Y={class:"text-center mb-10"},Z={class:"inline-flex items-center justify-center w-16 h-16 bg-red-50 rounded-2xl mb-6"},ee={class:"flex items-center justify-center gap-4 mb-10"},te={key:0,class:"space-y-6 animate-in slide-in-from-right-4 duration-500"},se={class:"space-y-2"},oe={class:"relative group"},re={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ae={class:"space-y-2"},le={class:"flex gap-3"},ne={class:"relative flex-1 group"},ie={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},de=["disabled"],ue=["disabled"],ce={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},fe={key:1,class:"flex items-center gap-2"},pe={key:1,class:"space-y-6 animate-in slide-in-from-right-4 duration-500"},ge={class:"space-y-2"},me={class:"relative group"},ye={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},xe={class:"space-y-2"},be={class:"relative group"},we={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ve=["disabled"],he={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},_e={key:1},ke={key:2,class:"text-center py-6 animate-in zoom-in duration-500"},Ce={class:"inline-flex items-center justify-center w-24 h-24 bg-green-50 rounded-full mb-8"},Se={class:"mt-12 pt-8 border-t border-gray-50 flex items-center justify-center gap-2 text-sm text-gray-400"},Ie=M({__name:"ForgotPassword",setup(Ve){const h=U(),l=N(),i=x(2),d=x(!1),f=x(0),p=x("");let g=null;const s=A({mobile:"",verify_code:"",password:"",confirm_password:""});P(async()=>{try{const o=await K();o.code===200&&o.data&&(p.value=o.data.key)}catch(o){console.error("Failed to get public key:",o)}}),R(()=>{g&&clearInterval(g)});const C=()=>{f.value=60,g=setInterval(()=>{f.value--,f.value<=0&&clearInterval(g)},1e3)},S=async()=>{if(!s.mobile||!/^1[3-9]\d{9}$/.test(s.mobile)){l.error("请输入正确的手机号");return}try{const o=await D(s.mobile);o.code===200?(l.success("验证码已发送"),C()):l.error(o.message||"发送验证码失败")}catch(o){l.error(o.message||"发送验证码失败")}},V=async()=>{if(!s.mobile||!s.verify_code){l.error("请填写手机号和验证码");return}d.value=!0;try{const o=await E({mobile:s.mobile,verify_code:s.verify_code,password:"",confirm_password:""});o.code===200?i.value=2:l.error(o.message||"验证码错误")}catch(o){l.error(o.message||"验证失败")}finally{d.value=!1}},j=async()=>{if(!s.password||s.password.length<8){l.error("密码长度至少为6位");return}if(s.password!==s.confirm_password){l.error("两次输入的密码不一致");return}d.value=!0;try{let o=s.password,t=s.confirm_password;p.value&&(o=await _.encrypt(s.password,p.value),t=await _.encrypt(s.confirm_password,p.value));const a=await F({mobile:s.mobile,verify_code:s.verify_code,password:o,confirm_password:t});a.code===200?i.value=3:l.error(a.message||"提交失败")}catch(o){l.error(o.message||"提交错误")}finally{d.value=!1}};return(o,t)=>(u(),z(T,null,{default:B(()=>[e("div",W,[t[20]||(t[20]=e("div",{class:"absolute top-0 right-0 w-[500px] h-[500px] bg-red-50/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"},null,-1)),t[21]||(t[21]=e("div",{class:"absolute bottom-0 left-0 w-[300px] h-[300px] bg-blue-50/50 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none"},null,-1)),e("div",X,[e("button",{onClick:t[0]||(t[0]=a=>r(h).push("/login")),class:"absolute top-8 left-8 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-full transition-all group"},[n(r(H),{class:"w-5 h-5 group-hover:-translate-x-0.5 transition-transform"})]),e("div",Y,[e("div",Z,[n(r(v),{class:"w-8 h-8 text-[#ff4757]"})]),t[6]||(t[6]=e("h1",{class:"text-3xl font-black text-gray-900 tracking-tight mb-2"},"找回密码",-1)),t[7]||(t[7]=e("p",{class:"text-gray-500 font-medium"},"账户安全保护为您提供快速密码重置",-1))]),e("div",ee,[e("div",{class:b(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",i.value>=1?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...t[8]||(t[8]=[e("span",null,"01",-1),e("span",{class:"hidden sm:inline"},"身份验证",-1)])],2),n(r(k),{class:"w-4 h-4 text-gray-200"}),e("div",{class:b(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",i.value>=2?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...t[9]||(t[9]=[e("span",null,"02",-1),e("span",{class:"hidden sm:inline"},"重置密码",-1)])],2),n(r(k),{class:"w-4 h-4 text-gray-200"}),e("div",{class:b(["flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all",i.value>=3?"bg-red-50 text-[#ff4757]":"text-gray-300"])},[...t[10]||(t[10]=[e("span",null,"03",-1),e("span",{class:"hidden sm:inline"},"完成",-1)])],2)]),i.value===1?(u(),c("div",te,[e("div",se,[t[11]||(t[11]=e("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"注册手机号",-1)),e("div",oe,[e("div",re,[n(r(q),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.mobile=a),type:"text",maxlength:"11",placeholder:"请输入注册时绑定的手机号",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[y,s.mobile]])])]),e("div",ae,[t[12]||(t[12]=e("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"短信验证码",-1)),e("div",le,[e("div",ne,[e("div",ie,[n(r(G),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>s.verify_code=a),type:"text",maxlength:"6",placeholder:"6位验证码",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[y,s.verify_code]])]),e("button",{onClick:S,disabled:f.value>0,class:"px-6 py-4 bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap min-w-[120px]"},I(f.value>0?`${f.value}s`:"获取验证码"),9,de)])]),e("button",{onClick:V,disabled:d.value,class:"w-full py-4 mt-4 bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70"},[d.value?(u(),c("span",ce)):(u(),c("span",fe,[t[13]||(t[13]=L("下一步 ",-1)),n(r(J),{class:"w-4 h-4"})]))],8,ue)])):w("",!0),i.value===2?(u(),c("div",pe,[e("div",ge,[t[14]||(t[14]=e("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"新登录密码",-1)),e("div",me,[e("div",ye,[n(r(v),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>s.password=a),type:"password",placeholder:"建议包含字母和数字",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[y,s.password]])])]),e("div",xe,[t[15]||(t[15]=e("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"确认新密码",-1)),e("div",be,[e("div",we,[n(r(v),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.confirm_password=a),type:"password",placeholder:"请再次确认您的新密码",class:"w-full pl-12 pr-4 py-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"},null,512),[[y,s.confirm_password]])])]),e("button",{onClick:j,disabled:d.value,class:"w-full py-4 mt-4 bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70"},[d.value?(u(),c("span",he)):(u(),c("span",_e,"重置并登录"))],8,ve)])):w("",!0),i.value===3?(u(),c("div",ke,[e("div",Ce,[n(r(Q),{class:"w-12 h-12 text-green-500"})]),t[16]||(t[16]=e("h2",{class:"text-3xl font-black text-gray-900 mb-2"},"重置成功",-1)),t[17]||(t[17]=e("p",{class:"text-gray-500 font-medium mb-10"},"您的登录密码已更新，请重新登录账号。",-1)),e("button",{onClick:t[5]||(t[5]=a=>r(h).push("/login")),class:"w-full py-4 bg-gray-900 text-white font-black rounded-2xl hover:bg-gray-800 transition-all"}," 去登录 ")])):w("",!0),e("div",Se,[n(r(O),{class:"w-4 h-4"}),t[18]||(t[18]=e("span",null,"无法获取验证码? ",-1)),t[19]||(t[19]=e("a",{href:"#",class:"text-[#ff4757] font-bold hover:underline"},"请联系您的代理",-1))])])])]),_:1}))}});export{Ie as default};
