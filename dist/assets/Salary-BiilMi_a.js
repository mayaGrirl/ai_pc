import{d as Y,o as A,c as m,F as D,e as a,g as S,t as c,p as C,i as v,l as r,B as n,w as p,n as M,f as b,b as w,A as L,r as N,z as V,k as q}from"./index-BG9QW0k-.js";import{U as F}from"./UserLayout-uEYBNEQ8.js";import{_ as T,z as Z,C as I,D as P,E as U,F as j}from"./MainLayout-Cy8swJD0.js";import{T as W}from"./TextSkeleton-eR3Znbih.js";import{g as G}from"./common-jqfb3mzs.js";import{u as z,D as E}from"./DataTable-2Yo32STd.js";import{d as k}from"./dayjs.min-BAJkae7J.js";const J={class:"flex items-center mb-2 p-1"},K={class:"text-red-500 font-semibold mx-1"},O={class:"bg-white p-1"},Q=["innerHTML"],X=Y({__name:"SalaryIntro",setup($){const o=v(""),_=v(0),s=v(!1),y=async()=>{s.value=!0;const{data:d,code:i}=await G("customer_salary_intro_tips");i==200&&(o.value=(d==null?void 0:d.content)||"");const f=await Z();f.code==200&&(_.value=f.data.coin),s.value=!1};return A(()=>{y()}),(d,i)=>(r(),m(D,null,[a("div",J,[i[0]||(i[0]=S(" 本周累计工资 ",-1)),a("span",K,c(_.value),1),i[1]||(i[1]=a("img",{class:"inline-block w-[13px] h-[13px]",src:T,alt:"gold"},null,-1))]),a("div",O,[s.value?(r(),C(W,{key:0,lines:5,height:"14px",animation:"wave"})):(r(),m("div",{key:1,class:"list-none p-0 m-0",innerHTML:o.value},null,8,Q))])],64))}}),ee={class:"text-orange-600 font-bold"},te={class:"text-gray-400 text-xs"},ae=Y({__name:"SalaryRecord",setup($){const{loading:o,dataSource:_,hasMore:s,pagination:y,loadData:d,changePage:i}=z(I,{defaultSize:10}),f=[{key:"typestr",title:"类型",width:"25%",align:"center"},{key:"basecoin",title:"统计金额",width:"25%",align:"center"},{key:"coin",title:"获得工资",width:"25%",align:"center"},{key:"addtime",title:"记录日期",width:"25%",align:"center"}];return d(),(g,u)=>(r(),C(E,{columns:f,data:n(_),loading:n(o),pagination:n(y),onChange:n(i),hasMore:n(s)},{"column-coin":p(({row:x})=>[a("div",ee,[S(c(g.$n(x.coin))+" ",1),u[0]||(u[0]=a("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:T},null,-1))])]),"column-addtime":p(({row:x})=>[a("span",te,c(n(k).unix(x.addtime||0).format("YYYY-MM-DD")),1)]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),se={class:"grid px-3"},ne=["disabled"],oe={class:"text-gray-400 text-xs"},ie={class:"text-orange-600 font-bold"},re={class:"text-gray-400 text-xs"},le={class:"text-gray-400 text-xs"},ce={key:0,class:"text-gray-400 text-xs"},de={key:1,class:"text-gray-400 text-xs"},ue=["onClick"],me=Y({__name:"SalaryReceive",setup($){const o=L(),{loading:_,dataSource:s,hasMore:y,pagination:d,loadData:i,changePage:f}=z(P,{defaultSize:10}),g=[{key:"ctdateA",title:"统计日期",width:"20%",align:"center"},{key:"coin",title:"工资",width:"20%",align:"center"},{key:"addtime",title:"结算时间",width:"20%",align:"center"},{key:"gettime",title:"领取时间",width:"20%",align:"center"},{key:"status",title:"状态",width:"20%",align:"center"}],u=v(!1),x=async()=>{u.value=!0;try{const{code:l,message:t}=await U();l!==200?o.error(t):o.success("领取成功"),u.value=!1}catch(l){const t=l instanceof Error?l.message:"领取失败，刷新页面请重试";o.error(t),u.value=!1}},h=v(new Set),H=async l=>{if(!h.value.has(l)){h.value=new Set(h.value).add(l);try{const{code:t,data:e,message:B}=await j(l);t===200?(o.success("领取成功"),s.value=s.value.map(R=>R.id===l?e:R)):o.error(B)}catch(t){console.error("recelve salary in error:",t);const e=t instanceof Error?t.message:"领取失败，请稍后再试";o.error(e)}finally{const t=new Set(h.value);t.delete(l),h.value=t}}};return A(()=>{i()}),(l,t)=>(r(),m(D,null,[a("div",se,[n(s).length>0?(r(),m("button",{key:0,onClick:t[0]||(t[0]=e=>x()),disabled:u.value,class:M(["mb-1 h-9 w-full rounded-full bg-gradient-to-r from-[#ff6a3a] to-[#ff1020] text-white font-medium transition active:scale-95",u.value?"opacity-60 cursor-not-allowed":"cursor-pointer"])},c(u.value?"领取中...":"一键领取"),11,ne)):b("",!0)]),w(E,{columns:g,data:n(s),loading:n(_),pagination:n(d),onChange:n(f),hasMore:n(y)},{"column-ctdateA":p(({row:e})=>[a("span",oe,c(n(k).unix(e.ctdateA||0).format("YYYY-MM-DD"))+"至"+c(n(k).unix(e.ctdateB||0).format("YYYY-MM-DD")),1)]),"column-coin":p(({row:e})=>[a("div",ie,[S(c(l.$n(e.coin))+" ",1),t[1]||(t[1]=a("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:T},null,-1))])]),"column-addtime":p(({row:e})=>[a("span",re,c(n(k).unix(e.addtime||0).format("YYYY-MM-DD")),1)]),"column-gettime":p(({row:e})=>[a("span",le,c(e.gettime>0?n(k).unix(e.gettime||0).format("YYYY-MM-DD HH:mm"):"-"),1)]),"column-status":p(({row:e})=>[e.status!==0?(r(),m("span",ce,c(e==null?void 0:e.status_label),1)):(r(),m("span",de,[a("button",{onClick:B=>H(e.id),class:M(["px-2 py-1 text-xs rounded",h.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},c(h.value.has(e.id||0)?"领取中...":"领取"),11,ue)]))]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),_e={class:"flex flex-col gap-5"},ge={class:"flex gap-5 border-b border-[#eee] pb-[15px]"},pe=["onClick"],ye={key:0},fe={key:1},he={key:2},Me=Y({__name:"Salary",setup($){const o=V(),_=q(),s=v(o.query.tab||"intro"),y=[{key:"intro",name:"工资概况"},{key:"receive",name:"领取工资"},{key:"record",name:"工资日记录"}],d=i=>{s.value=i,_.push({query:{...o.query,tab:i}})};return(i,f)=>(r(),C(F,null,{default:p(()=>[a("div",_e,[a("div",ge,[(r(),m(D,null,N(y,g=>a("span",{key:g.key,class:M(["w-20 text-center text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 ",{"text-[#ff6600] border-b-[#ff6600]":s.value===g.key}]),onClick:u=>d(g.key)},c(g.name),11,pe)),64))]),s.value==="intro"?(r(),m("div",ye,[w(X)])):b("",!0),s.value==="receive"?(r(),m("div",fe,[w(me)])):b("",!0),s.value==="record"?(r(),m("div",he,[w(ae)])):b("",!0)])]),_:1}))}});export{Me as default};
