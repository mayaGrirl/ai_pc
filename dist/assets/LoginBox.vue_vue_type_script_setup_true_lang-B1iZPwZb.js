import{d as z,o as D,a as E,c,n as a,e as t,b as u,B as w,q as p,x as v,f as C,t as I,E as K,v as R,w as S,g as M,k as q,z as A,i as g,G as P,j as F,l as f,A as G}from"./index-CDbJeEsl.js";import{u as H,S as J,n as O,o as Q}from"./MainLayout-1608CcOq.js";import{h as W}from"./common-CW5iCQXJ.js";import{S as X}from"./sodium-jzn3nznW.js";import{L as Y,S as Z}from"./shield-check-BGCXRqLQ.js";const _={class:"space-y-2"},ee={class:"relative group"},te={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},oe={key:0,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},se={class:"relative group"},re={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ae={key:1,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},ne={class:"relative group flex gap-3"},le={class:"relative flex-1"},ie={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},de=["disabled"],ce={class:"flex items-center gap-2 cursor-pointer group"},ue={class:"w-2.5 h-2.5 bg-white rounded-[1px]"},pe=["disabled"],fe={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},me={key:1},ve=z({__name:"LoginBox",props:{redirect:{type:String,default:"/"},compact:{type:Boolean,default:!1}},emits:["success"],setup(r,{emit:V}){const B=r,T=V,j=q(),U=A(),h=H(),n=G(),l=g("password"),m=g(!1),x=g(""),d=g(0);let y=null;const o=P({mobile:"",password:"",code:"",rememberMe:!0}),k=async()=>{try{const{data:s,code:e}=await W();e===200&&s&&(x.value=s.key)}catch(s){console.error("Failed to get public key:",s)}};D(()=>{k()}),E(()=>{y&&clearInterval(y)});const L=()=>{d.value=60,y=setInterval(()=>{d.value--,d.value<=0&&clearInterval(y)},1e3)},N=async()=>{if(!o.mobile){n.error("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(o.mobile)){n.error("请输入正确的手机号");return}try{const{code:s,message:e}=await O(o.mobile);s===200?(n.success("验证码已发送"),L()):n.error(e||"发送失败")}catch(s){n.error(s.message||"发送失败")}},$=async()=>{if(!o.mobile){n.error("请输入手机号");return}if(l.value==="password"){if(!o.password){n.error("请输入密码");return}if(!x.value){n.error("系统初始化中，请稍后"),await k();return}}else if(!o.code){n.error("请输入验证码");return}m.value=!0;try{let s={mobile:o.mobile,type:l.value==="password"?1:2};l.value==="password"?s.password=await X.encrypt(o.password,x.value):s.code=o.code;const e=await Q(s);if(e.code===200&&e.data){h.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await h.fetchCurrentCustomer(),n.success("登录成功"),T("success");const b=U.query.redirect||B.redirect;j.push(b)}else n.error(e.message||"登录失败")}catch(s){n.error(s.message||"登录失败")}finally{m.value=!1}};return(s,e)=>{const b=F("router-link");return f(),c("div",{class:a(["w-full bg-white rounded-3xl animate-in fade-in zoom-in duration-500",[r.compact?"max-w-[340px]":"p-8 max-w-[420px] shadow-xl shadow-gray-200/50 border border-gray-100"]])},[t("div",{class:a(["flex items-center justify-center p-1 bg-gray-50 rounded-2xl",r.compact?"mb-1":"mb-8"])},[t("button",{onClick:e[0]||(e[0]=i=>l.value="password"),class:a(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="password"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",r.compact?"py-1.5":"py-3"]])}," 账号密码登录 ",2),t("button",{onClick:e[1]||(e[1]=i=>l.value="sms"),class:a(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="sms"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",r.compact?"py-1.5":"py-3"]])}," 短信动态登录 ",2)],2),t("div",{class:a(r.compact?"space-y-2":"space-y-5")},[t("div",_,[e[6]||(e[6]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"手机号码",-1)),t("div",ee,[t("div",te,[u(w(J),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.mobile=i),type:"text",maxlength:"11",placeholder:"请输入11位手机号",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.mobile]])])]),l.value==="password"?(f(),c("div",oe,[e[7]||(e[7]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"登录密码",-1)),t("div",se,[t("div",re,[u(w(Y),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>o.password=i),type:"password",placeholder:"请输入您的登录密码",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.password]])])])):C("",!0),l.value==="sms"?(f(),c("div",ae,[e[8]||(e[8]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"动态验证码",-1)),t("div",ne,[t("div",le,[t("div",ie,[u(w(Z),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.code=i),type:"text",maxlength:"6",placeholder:"6位验证码",class:a([r.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[v,o.code]])]),t("button",{onClick:N,disabled:d.value>0,class:a([r.compact?"px-4 py-1":"px-6 py-4","bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap min-w-[100px]"])},I(d.value>0?`${d.value}s`:"获取验证码"),11,de)])])):C("",!0),t("div",{class:a(["flex items-center justify-between px-1",r.compact?"":"pt-2"])},[t("label",ce,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=i=>o.rememberMe=i),class:"hidden"},null,512),[[K,o.rememberMe]]),t("div",{class:a(["w-5 h-5 rounded-md border-2 flex items-center justify-center transition-all",o.rememberMe?"bg-[#ff4757] border-[#ff4757]":"border-gray-200 group-hover:border-gray-300"])},[p(t("div",ue,null,512),[[R,o.rememberMe]])],2),e[9]||(e[9]=t("span",{class:"text-sm text-gray-500 font-medium"},"记住登录状态",-1))]),u(b,{to:"/forgot-password",class:"text-sm text-gray-400 hover:text-[#ff4757] transition-colors font-medium"},{default:S(()=>[...e[10]||(e[10]=[M(" 忘记密码? ",-1)])]),_:1})],2),t("button",{onClick:$,disabled:m.value,class:a([r.compact?"py-1 mt-2":"py-4 mt-4","w-full bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:translate-y-0"])},[m.value?(f(),c("span",fe)):(f(),c("span",me,"立即登录"))],10,pe),t("div",{class:a(["text-center",r.compact?"pt-1":"pt-6 pb-2"])},[e[12]||(e[12]=t("span",{class:"text-gray-400 text-sm font-medium"},"还没有账号?",-1)),u(b,{to:"/register",class:"ml-2 text-[#ff4757] text-sm font-black hover:underline underline-offset-4"},{default:S(()=>[...e[11]||(e[11]=[M(" 免费注册 ",-1)])]),_:1})],2)],2)],2)}}});export{ve as _};
