import{h as $,J as C,K as T,o as B,M as z,C as f,N as G,O as X,P as Z,d as F,u as ee,L as te,c as k,F as Y,f as r,b as S,k as L,w as E,t as M,B as H,p as b,r as R,y as oe,e as O,E as I,j as U,A as se,g as ae,v as ne,i as re}from"./index-CI_7SEUj.js";import{U as le}from"./UserLayout-Co7IRdW4.js";import{u as ie}from"./MainLayout-CDHSMaoa.js";import{b as ce,_ as ue,S as de}from"./constants-C-nFgff_.js";import{o as fe,s as N,u as pe,a as P,E as A,t as me}from"./vee-validate-zod-kjpPv33Y.js";import{f as ve}from"./customer-1SQV3JEG.js";import{_ as ye}from"./coin-BjeO1Yvx.js";import{a as ge,i as Q,c as xe,w as _e,t as he,b as be,d as D,u as we,D as ke}from"./DataTable-CFY0I4H4.js";import{d as Se}from"./dayjs.min-BAJkae7J.js";import"./createLucideIcon-CFUWjPo4.js";const Ce=Q?window:void 0,q=Q?window.navigator:void 0;function Me(s){var t;const p=C(s);return(t=p==null?void 0:p.$el)!=null?t:p}function J(...s){const t=[],p=()=>{t.forEach(n=>n()),t.length=0},u=(n,c,l,d)=>(n.addEventListener(c,l,d),()=>n.removeEventListener(c,l,d)),v=$(()=>{const n=D(C(s[0])).filter(c=>c!=null);return n.every(c=>typeof c!="string")?n:void 0}),y=_e(()=>{var n,c;return[(c=(n=v.value)==null?void 0:n.map(l=>Me(l)))!=null?c:[Ce].filter(l=>l!=null),D(C(v.value?s[1]:s[0])),D(f(v.value?s[2]:s[1])),C(v.value?s[3]:s[2])]},([n,c,l,d])=>{if(p(),!(n!=null&&n.length)||!(c!=null&&c.length)||!(l!=null&&l.length))return;const g=be(d)?{...d}:d;t.push(...n.flatMap(h=>c.flatMap(w=>l.map(a=>u(h,w,a,g)))))},{flush:"post"}),_=()=>{y(),p()};return he(p),_}function Te(){const s=T(!1),t=z();return t&&B(()=>{s.value=!0},t),s}function K(s){const t=Te();return $(()=>(t.value,!!s()))}function j(s,t={}){const{controls:p=!1,navigator:u=q}=t,v=K(()=>u&&"permissions"in u),y=T(),_=typeof s=="string"?{name:s}:s,n=T(),c=()=>{var d,g;n.value=(g=(d=y.value)==null?void 0:d.state)!=null?g:"prompt"};J(y,"change",c,{passive:!0});const l=xe(async()=>{if(v.value){if(!y.value)try{y.value=await u.permissions.query(_)}catch{y.value=void 0}finally{c()}if(p)return G(y.value)}});return l(),p?{state:n,isSupported:v,query:l}:n}function Ve(s={}){const{navigator:t=q,read:p=!1,source:u,copiedDuring:v=1500,legacy:y=!1}=s,_=K(()=>t&&"clipboard"in t),n=j("clipboard-read"),c=j("clipboard-write"),l=$(()=>_.value||y),d=T(""),g=T(!1),h=ge(()=>g.value=!1,v,{immediate:!1});async function w(){let e=!(_.value&&m(n.value));if(!e)try{d.value=await t.clipboard.readText()}catch{e=!0}e&&(d.value=x())}l.value&&p&&J(["copy","cut"],w,{passive:!0});async function a(e=C(u)){if(l.value&&e!=null){let i=!(_.value&&m(c.value));if(!i)try{await t.clipboard.writeText(e)}catch{i=!0}i&&o(e),d.value=e,g.value=!0,h.start()}}function o(e){const i=document.createElement("textarea");i.value=e??"",i.style.position="absolute",i.style.opacity="0",document.body.appendChild(i),i.select(),document.execCommand("copy"),i.remove()}function x(){var e,i,V;return(V=(i=(e=document==null?void 0:document.getSelection)==null?void 0:e.call(document))==null?void 0:i.toString())!=null?V:""}function m(e){return e==="granted"||e==="prompt"}return{isSupported:l,text:d,copied:g,copy:a}}const Ee=X();Ee.use(Z);function $e(s,t=300){const p={token:s,expire:Date.now()+t*1e3};localStorage.setItem("secure_verify_token",JSON.stringify(p))}function W(){const s=localStorage.getItem("secure_verify_token");if(!s)return null;const t=JSON.parse(s);return Date.now()>t.expire?(localStorage.removeItem("secure_verify_token"),null):t.token}const Ie={class:"text-orange-600 font-bold"},Ne={class:"text-xs"},Pe={class:"text-gray-400 text-xs"},Ae=["onClick"],De=F({__name:"PropsRecord",setup(s){const{locale:t}=ee(),p=te[t.value]??"USD",u=H(),{copy:v,isSupported:y}=Ve(),{loading:_,dataSource:n,hasMore:c,pagination:l,loadData:d,changePage:g,query:h,reload:w}=we(ce,{defaultSize:10,initQuery:{t:W()}}),a=[{key:"no",title:"卡号",width:"20%",align:"center"},{key:"pwd",title:"卡密",width:"25%",align:"center"},{key:"points",title:"金豆",width:"15%",align:"center"},{key:"addtime",title:"获得时间",width:"20%",align:"center"},{key:"operation",title:"操作",width:"15%",align:"center"}],o=async()=>{if(!n.value.length){u.warning("暂无数据可复制");return}const m=n.value.filter(e=>e.state===0).map(e=>`${e.no} ${e.pwd}`).join(`
`);if(!m){u.warning("没有待使用的卡密可复制");return}y.value?(await v(m),u.success("已复制所有可用卡密")):u.error("您的浏览器不支持自动复制")},x=async(m,e)=>{const i=`${m} ${e}`;y.value?(await v(i),u.success("已复制")):u.error("您的浏览器不支持自动复制")};return d(),(m,e)=>(b(),k(Y,null,[r("div",{class:"flex justify-between items-center mb-4 px-1"},[e[1]||(e[1]=r("h3",{class:"text-lg font-bold text-gray-800"},"兑换记录",-1)),r("div",{class:"flex items-center gap-2"},[r("button",{onClick:o,class:"text-sm font-medium text-orange-600 hover:text-orange-700 hover:bg-orange-50 px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1"},[...e[0]||(e[0]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})],-1),L(" 复制可用卡密 ",-1)])])])]),S(ke,{columns:a,data:f(n),loading:f(_),pagination:f(l),onChange:f(g),hasMore:f(c)},{"column-points":E(({row:i})=>[r("div",Ie,[L(M(m.$n(i.points))+" ",1),e[2]||(e[2]=r("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:ye},null,-1))]),r("div",Ne,M(m.$n((i.points||0)/1e3,{style:"currency",currency:f(p)})),1)]),"column-addtime":E(({row:i})=>[r("span",Pe,M(f(Se).unix(i.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),"column-operation":E(({row:i})=>[r("span",{class:"cursor-pointer text-orange-600 hover:text-orange-700 hover:bg-orange-50",onClick:V=>x(i.no,i.pwd)},"复制",8,Ae)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),Le={class:"flex flex-col gap-5"},Re={key:0,class:"flex gap-[1px] flex-col"},Oe={class:"relative flex items-center gap-1"},Ue={key:1},je={class:"flex gap-[1px] flex-col"},Be={class:"relative flex items-center gap-1"},Fe=["value"],Ye={class:"flex gap-[1px] flex-col"},He={class:"relative flex items-center gap-1"},Qe=["disabled"],qe={key:1},st=F({__name:"Props",setup(s){const t=H(),p=ie(),u=$(()=>p.currentCustomer),v=R(!1),y=R(1),_=fe({safe_ask:N().optional(),answer:N().optional(),verify_code:N().optional()}).superRefine((a,o)=>{var x,m;((x=u.value)==null?void 0:x.selectcardVerifyType)=="safeQuestion"&&((!a.safe_ask||a.safe_ask.length<1)&&o.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!a.answer||a.answer.length<1)&&o.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),a.answer&&a.answer.length>50&&o.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((m=u==null?void 0:u.value)==null?void 0:m.selectcardVerifyType)=="smsVerify"&&(!a.verify_code||a.verify_code.length<1)&&o.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),n=me(_),{handleSubmit:c,isSubmitting:l}=pe({validationSchema:n,initialValues:{safe_ask:""}}),{value:d}=P("safe_ask"),{value:g}=P("answer"),{value:h}=P("verify_code"),w=c(async(a,{setErrors:o})=>{l.value=!0;try{const{code:x,message:m,data:e}=await ve({safe_ask:a==null?void 0:a.safe_ask,answer:a==null?void 0:a.answer,verify_code:a==null?void 0:a.verify_code});x!==200?t.error(m):(t.success("验证成功"),v.value=!0,$e(e.key,480))}catch(x){t.error(x.message||"提交失败")}finally{l.value=!1}});return B(()=>{(async()=>{try{v.value=!!W()}catch{v.value=!1}})()}),(a,o)=>(b(),oe(le,null,{default:E(()=>{var x,m;return[r("div",Le,[o[8]||(o[8]=r("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[r("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"我的道具")],-1)),v.value?(b(),k("div",qe,[S(De)])):(b(),k("form",{onSubmit:o[3]||(o[3]=re((...e)=>f(w)&&f(w)(...e),["prevent"])),class:"flex flex-col gap-6",key:y.value},[((x=u.value)==null?void 0:x.selectcardVerifyType)=="smsVerify"?(b(),k("div",Re,[o[4]||(o[4]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),r("div",Oe,[S(ue,{scene:"exchange_card",modelValue:f(h),"onUpdate:modelValue":o[0]||(o[0]=e=>I(h)?h.value=e:null)},null,8,["modelValue"])]),S(f(A),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):O("",!0),((m=u.value)==null?void 0:m.selectcardVerifyType)=="safeQuestion"?(b(),k("div",Ue,[r("div",je,[o[6]||(o[6]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),r("div",Be,[U(r("select",{id:"safe_ask","onUpdate:modelValue":o[1]||(o[1]=e=>I(d)?d.value=e:null),class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[o[5]||(o[5]=r("option",{key:"option-default",value:""},"请选择问题",-1)),(b(!0),k(Y,null,ae(f(de),e=>(b(),k("option",{key:`option-${e.value}`,value:String(e.value)},M(a.$t(e.i18nKey)),9,Fe))),128))],512),[[se,f(d)]])]),S(f(A),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),r("div",Ye,[o[7]||(o[7]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),r("div",He,[U(r("input",{id:"answer",type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>I(g)?g.value=e:null),placeholder:"请输入答案",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[ne,f(g)]])]),S(f(A),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):O("",!0),r("button",{type:"submit",disabled:f(l),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},M(f(l)?"提交中...":"提交"),9,Qe)],32))])]}),_:1}))}});export{st as default};
