import{d as Z,o as ee,x as te,w as se,e as t,t as i,C as d,c as a,h as f,v as g,E as b,i as S,g as le,f as oe,B as re,k as c,j as ae,p as r}from"./index-Cu650ddO.js";import{_ as ne}from"./coin-BjeO1Yvx.js";import{U as ie}from"./UserLayout-BJth2za9.js";import{u as de}from"./MainLayout-jx_4kQtN.js";import{A as ue,B as fe,C as ge,D as ce}from"./customer-Csfvyssn.js";import{o as pe,s as y,u as me,a as v,t as xe}from"./vee-validate-zod-wmdbUCix.js";import{i as be,m as ye}from"./utils-KYcPjVjn.js";import{D as ve}from"./decimal-CaUHonIL.js";const we={class:"flex flex-col gap-5"},he={class:"flex gap-6 items-start"},ke={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm"},_e={class:"grid grid-cols-2 gap-4 mb-6 bg-gray-50 p-4 rounded-lg"},qe={class:"flex flex-col gap-1"},Ce={class:"text-sm font-bold text-gray-800 font-mono"},Ee={class:"flex flex-col gap-1"},Ve={class:"text-sm font-bold text-gray-800"},Be={class:"grid grid-cols-1 gap-5"},Ne={class:"flex flex-col gap-2"},Ue={class:"relative"},Se={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},je={class:"flex flex-col gap-2"},De={class:"relative"},Me={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},Qe={class:"flex flex-col gap-2"},Fe={class:"relative"},Te={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},$e={class:"flex flex-col gap-2"},ze={class:"relative"},Ie={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},Re={class:"flex flex-col gap-2"},Ae={class:"relative"},He=["title"],Le={class:"flex flex-col gap-2"},Pe=["disabled"],Ge={class:"w-[320px] shrink-0"},Ke={class:"bg-white rounded-xl border border-gray-100 p-6 shadow-sm sticky top-5"},Je={class:"flex flex-col items-center text-center"},Oe={class:"text-lg font-bold text-gray-800 mb-1"},We={class:"text-xs text-gray-400 mb-6 font-mono"},Xe={class:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100"},Ye={key:0,class:"flex flex-col gap-3"},Ze={key:1,class:"flex flex-col gap-3"},et={class:"flex gap-2"},tt={key:0,class:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100 mt-4"},st={key:0,class:"flex flex-col gap-3"},lt={key:1,class:"flex flex-col gap-3"},ot={class:"flex gap-2"},pt=Z({__name:"Profile",setup(rt){const n=re(),M=de(),j=ae(()=>M.currentCustomer),h=c(!1),p=c(""),L=()=>{var s;p.value=((s=l.value)==null?void 0:s.nickname)||"",h.value=!0},P=async()=>{var s,e,u;if(!p.value){n.error("昵称不能为空");return}try{const{code:x,message:U}=await ge({nickname:p.value});if(x===200){l.value&&(l.value.nickname=p.value),h.value=!1,n.success("昵称修改成功");let w=(s=j.value)==null?void 0:s.points;(e=j.value)!=null&&e.points&&(w=new ve((u=j.value)==null?void 0:u.points).sub(200).toNumber()),M.setCurrentCustomer({nickname:p.value,points:w})}else n.error(U||"修改失败")}catch(x){n.error(x.message||"修改失败")}},k=c(!1),m=c(""),D=c(!1),G=()=>{var s;m.value=((s=l.value)==null?void 0:s.email)||"",k.value=!0},K=async()=>{if(!m.value){n.error("邮箱不能为空");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value)){n.error("请输入有效的邮箱地址");return}try{const{code:e,message:u}=await ce({email:m.value});e===200?(l.value&&(l.value.email=m.value),k.value=!1,D.value=!1,n.success("邮箱绑定成功")):n.error(u||"绑定失败")}catch(e){n.error(e.message||"绑定失败")}},J=c(1),O=pe({realname:y().trim().refine(s=>s===""||s.length<=50,{message:"真实姓名不能超过50字符"}),qq:y().trim().refine(s=>s===""||/^\d{5,12}$/.test(s),{message:"QQ号格式不正确"}),alipay:y().trim().refine(s=>s===""||s.length<=50,{message:"支付宝账号不能超过50字符"}),wchat:y().trim().refine(s=>s===""||s.length<=50,{message:"微信账号不能超过50字符"}),address:y().trim().refine(s=>s===""||s.length<=150,{message:"地址不能超过150字符"}),signature:y().trim().refine(s=>s===""||s.length<=200,{message:"签名不能超过200字符"})}),W=xe(O),{handleSubmit:X,isSubmitting:_,resetForm:Y}=me({validationSchema:W}),{value:q}=v("realname"),{value:C}=v("qq"),{value:E}=v("alipay"),{value:V}=v("wchat"),{value:B}=v("address"),{value:N}=v("signature"),Q=X(async s=>{_.value=!0;try{const{code:e,message:u,data:x}=await ue({qq:s.qq,wchat:s.wchat,alipay:s.alipay,realname:s.realname,address:s.address,signature:s.signature});e!==200?n.error(u):(n.success("充值成功"),Y(),T())}catch(e){n.error(e.message||"提交失败")}finally{_.value=!1}}),F=c(!1),l=c(),T=async()=>{F.value=!0;try{const{data:s,code:e}=await fe();e===200&&(l.value=s,q.value=s.realname||"",C.value=s.qq||"",E.value=s.alipay||"",V.value=s.wchat||"",B.value=s.address||"",N.value=s.signature||"",be(s.email)&&(D.value=!0))}catch(s){console.error("Get member field error:",s)}finally{F.value=!1}};return ee(()=>{T()}),(s,e)=>(r(),te(ie,null,{default:se(()=>{var u,x,U,w,$,z,I,R,A,H;return[t("div",we,[e[27]||(e[27]=t("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[t("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"修改资料")],-1)),t("div",he,[t("div",ke,[e[21]||(e[21]=t("div",{class:"mb-6 pb-4 border-b border-gray-100"},[t("h3",{class:"text-lg font-bold text-gray-800"},"基本资料"),t("p",{class:"text-sm text-gray-500 mt-1"},"完善您的个人信息，以便更好地为您服务")],-1)),t("div",_e,[t("div",qe,[e[11]||(e[11]=t("span",{class:"text-xs text-gray-500"},"手机号码",-1)),t("span",Ce,i(d(ye)(((u=l.value)==null?void 0:u.mobile)||"",3,4)),1)]),t("div",Ee,[e[12]||(e[12]=t("span",{class:"text-xs text-gray-500"},"邮箱地址",-1)),t("span",Ve,i(((x=l.value)==null?void 0:x.email)||"未绑定"),1)])]),(r(),a("form",{onSubmit:e[6]||(e[6]=le((...o)=>d(Q)&&d(Q)(...o),["prevent"])),class:"flex flex-col gap-5",key:J.value},[t("div",Be,[t("div",Ne,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-gray-700",for:"qq"},"QQ号码",-1)),t("div",Ue,[(U=l.value)!=null&&U.qq?(r(),a("div",Se,i(l.value.qq),1)):f((r(),a("input",{key:0,id:"qq",type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>b(C)?C.value=o:null),placeholder:"请输入QQ号码",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[g,d(C)]])])]),t("div",je,[e[14]||(e[14]=t("label",{class:"text-sm font-medium text-gray-700",for:"wechat"},"微信号",-1)),t("div",De,[(w=l.value)!=null&&w.wchat?(r(),a("div",Me,i(l.value.wchat),1)):f((r(),a("input",{key:0,id:"wechat",type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>b(V)?V.value=o:null),placeholder:"请输入微信号码",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[g,d(V)]])])]),t("div",Qe,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-gray-700",for:"alipay"},"支付宝账号",-1)),t("div",Fe,[($=l.value)!=null&&$.alipay?(r(),a("div",Te,i(l.value.alipay),1)):f((r(),a("input",{key:0,id:"alipay",type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>b(E)?E.value=o:null),placeholder:"请输入支付宝账号",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[g,d(E)]])])]),t("div",$e,[e[17]||(e[17]=t("label",{class:"text-sm font-medium text-gray-700",for:"realName"},"真实姓名",-1)),t("div",ze,[(z=l.value)!=null&&z.realname?(r(),a("div",Ie,[S(i(l.value.realname)+" ",1),e[16]||(e[16]=t("span",{class:"ml-2 text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100"},"已实名",-1))])):f((r(),a("input",{key:0,id:"realName",type:"text","onUpdate:modelValue":e[3]||(e[3]=o=>b(q)?q.value=o:null),placeholder:"请输入真实姓名",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[g,d(q)]])])]),t("div",Re,[e[18]||(e[18]=t("label",{class:"text-sm font-medium text-gray-700",for:"address"},"收货地址",-1)),t("div",Ae,[(I=l.value)!=null&&I.address?(r(),a("div",{key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none truncate",title:l.value.address},i(l.value.address),9,He)):f((r(),a("input",{key:0,id:"address",type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>b(B)?B.value=o:null),placeholder:"请填写真实收货地址",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[g,d(B)]])])]),t("div",Le,[e[19]||(e[19]=t("label",{class:"text-sm font-medium text-gray-700",for:"signature"},"个人签名",-1)),f(t("textarea",{id:"signature","onUpdate:modelValue":e[5]||(e[5]=o=>b(N)?N.value=o:null),rows:"3",placeholder:"写一句话介绍自己...",class:"w-full p-3 border border-gray-300 rounded-lg text-sm leading-relaxed focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400 resize-none"},null,512),[[g,d(N)]])])]),e[20]||(e[20]=t("div",{class:"flex items-start gap-2 bg-orange-50 p-3 rounded-lg border border-orange-100"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#ff6600","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]),t("span",{class:"text-xs text-orange-700 leading-tight"},"温馨提示：部分资料保存后不可再次修改，请务必填写真实有效的信息。如有填写错误，请联系在线客服处理。")],-1)),t("button",{type:"submit",disabled:d(_),class:"w-full py-3 bg-gradient-to-r from-[#ff6b6b] to-[#ee5a6f] text-white rounded-lg text-sm font-bold shadow-lg shadow-orange-500/30 hover:shadow-orange-500/40 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200"},i(d(_)?"保存中...":"保存资料"),9,Pe)],32))]),t("div",Ge,[t("div",Ke,[t("div",Je,[t("h3",Oe,i(((R=l.value)==null?void 0:R.nickname)||"未设置昵称"),1),t("p",We,"ID: "+i(((A=l.value)==null?void 0:A.aid)||"-"),1),t("div",Xe,[e[24]||(e[24]=t("div",{class:"text-xs font-bold text-gray-500 mb-3 text-left uppercase tracking-wider"},"修改昵称",-1)),h.value?(r(),a("div",Ze,[f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>p.value=o),type:"text",placeholder:"请输入新昵称",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm outline-none focus:border-[#ff6600]",maxlength:"12"},null,512),[[g,p.value]]),e[23]||(e[23]=t("span",{class:"text-xs text-orange-700 leading-tight text-left"},[S(" 修改昵称需要花费 200 "),t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:ne})],-1)),t("div",et,[t("button",{onClick:e[8]||(e[8]=o=>h.value=!1),class:"flex-1 py-1.5 bg-gray-200 text-gray-600 rounded text-xs hover:bg-gray-300 transition-colors"}," 取消 "),t("button",{onClick:P,class:"flex-1 py-1.5 bg-[#ff6b6b] text-white rounded text-xs hover:bg-[#ff6b6b] transition-colors"}," 确认 ")])])):(r(),a("div",Ye,[t("button",{onClick:L,class:"w-full py-2 bg-white border border-gray-200 text-gray-700 rounded-md text-sm hover:border-[#ff6600] hover:text-[#ff6600] transition-colors flex items-center justify-center gap-2"},[...e[22]||(e[22]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1),S(" 点击修改 ",-1)])])]))]),D.value?(r(),a("div",tt,[e[26]||(e[26]=t("div",{class:"text-xs font-bold text-gray-500 mb-3 text-left uppercase tracking-wider"},"绑定邮箱",-1)),k.value?(r(),a("div",lt,[f(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>m.value=o),type:"email",placeholder:"请输入您的邮箱",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm outline-none focus:border-[#ff6600]"},null,512),[[g,m.value]]),t("div",ot,[t("button",{onClick:e[10]||(e[10]=o=>k.value=!1),class:"flex-1 py-1.5 bg-gray-200 text-gray-600 rounded text-xs hover:bg-gray-300 transition-colors"}," 取消 "),t("button",{onClick:K,class:"flex-1 py-1.5 from-[#ff6b6b] to-[#ee5a6f] text-white rounded text-xs hover:bg-[#ff6b6b] transition-colors"}," 确认 ")])])):(r(),a("div",st,[t("button",{onClick:G,class:"w-full py-2 bg-white border border-gray-200 text-gray-700 rounded-md text-sm hover:border-[#ff6b6b] hover:text-[#ff6b6b] transition-colors flex items-center justify-center gap-2"},[e[25]||(e[25]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),t("polyline",{points:"22,6 12,13 2,6"})],-1)),S(" "+i((H=l.value)!=null&&H.email?"修改邮箱":"点击绑定"),1)])]))])):oe("",!0)])])])])])]}),_:1}))}});export{pt as default};
