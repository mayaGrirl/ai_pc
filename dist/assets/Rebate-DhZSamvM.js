import{U as T}from"./UserLayout-CFmo2CmG.js";import{u as M,D as R}from"./DataTable-DRY8DrKE.js";import{u as q,x as E,y as L,z as N}from"./customer-DIYUO1RJ.js";import{d as D}from"./dayjs.min-BAJkae7J.js";import{d as k,o as Y,x as b,C as c,w as i,c as p,t as n,e as o,n as $,k as w,p as d,B,r as V,F,b as S,f as z,A as P,m as U,s as W}from"./index-hWKOlkWM.js";import"./MainLayout-DtU7OwZM.js";import"./createLucideIcon-DwOXvdPt.js";const j={class:"text-gray-400 text-xs"},A={class:"text-gray-400 text-xs"},I={class:"text-gray-400 text-xs"},G={class:"text-gray-400 text-xs"},H={key:0,class:"text-gray-400 text-xs"},J={key:1,class:"text-gray-400 text-xs"},K=["onClick"],O=k({__name:"RebateRecharge",setup(C){const l=B(),{loading:g,dataSource:r,hasMore:_,pagination:m,loadData:h,changePage:v}=M(q,{defaultSize:10}),u=[{key:"addtime",title:"日期",width:"20%",align:"center"},{key:"wpoints",title:"有效流水",width:"20%",align:"center"},{key:"cz",title:"充值",width:"20%",align:"center"},{key:"hdpoints",title:"返利",width:"20%",align:"center"},{key:"status",title:"状态",width:"20%",align:"center"}],s=w(new Set),f=async t=>{if(!s.value.has(t)){s.value=new Set(s.value).add(t);try{const{code:a,data:e,message:x}=await E(t);a===200?(l.success("领取成功"),r.value=r.value.map(y=>y.id===t?e:y)):l.error(x)}catch(a){console.error("rebate recharge in error:",a);const e=a instanceof Error?a.message:"领取失败，请稍后再试";l.error(e)}finally{const a=new Set(s.value);a.delete(t),s.value=a}}};return Y(()=>{h()}),(t,a)=>(d(),b(R,{columns:u,data:c(r),loading:c(g),pagination:c(m),onChange:c(v),hasMore:c(_)},{"column-addtime":i(({row:e})=>[o("span",j,n(c(D).unix(e.addtime||0).format("YYYY-MM-DD")),1)]),"column-wpoints":i(({row:e})=>[o("span",A,n(t.$n(e.wpoints)),1)]),"column-cz":i(({row:e})=>[o("span",I,n(t.$n(e.cz*1e3)),1)]),"column-hdpoints":i(({row:e})=>[o("span",G,n(t.$n(e.hdpoints)),1)]),"column-status":i(({row:e})=>[e.state!==0?(d(),p("span",H,n(e==null?void 0:e.state_label),1)):(d(),p("span",J,[o("button",{onClick:x=>f(e.id),class:$(["px-2 py-1 text-xs rounded",s.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},n(s.value.has(e.id||0)?"领取中...":"领取"),11,K)]))]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),Q={class:"text-gray-400 text-xs"},X={class:"text-gray-400 text-xs"},Z={class:"text-gray-400 text-xs"},ee={class:"text-gray-400 text-xs"},te={key:0,class:"text-gray-400 text-xs"},ae={key:1,class:"text-gray-400 text-xs"},se=["onClick"],ne=k({__name:"RebateLoss",setup(C){const l=B(),{loading:g,dataSource:r,hasMore:_,pagination:m,loadData:h,changePage:v}=M(L,{defaultSize:10}),u=[{key:"addtime",title:"日期",width:"20%",align:"center"},{key:"wpoints",title:"有效流水",width:"20%",align:"center"},{key:"cz",title:"充值",width:"20%",align:"center"},{key:"hdpoints",title:"返利",width:"20%",align:"center"},{key:"status",title:"状态",width:"20%",align:"center"}],s=w(new Set),f=async t=>{if(!s.value.has(t)){s.value=new Set(s.value).add(t);try{const{code:a,data:e,message:x}=await N(t);a===200?(l.success("领取成功"),r.value=r.value.map(y=>y.id===t?e:y)):l.error(x)}catch(a){console.error("rebate loss in error:",a);const e=a instanceof Error?a.message:"领取失败，请稍后再试";l.error(e)}finally{const a=new Set(s.value);a.delete(t),s.value=a}}};return Y(()=>{h()}),(t,a)=>(d(),b(R,{columns:u,data:c(r),loading:c(g),pagination:c(m),onChange:c(v),hasMore:c(_)},{"column-addtime":i(({row:e})=>[o("span",Q,n(c(D).unix(e.addtime||0).format("YYYY-MM-DD")),1)]),"column-wpoints":i(({row:e})=>[o("span",X,n(t.$n(e.wpoints)),1)]),"column-cz":i(({row:e})=>[o("span",Z,n(t.$n(e.cz)),1)]),"column-hdpoints":i(({row:e})=>[o("span",ee,n(t.$n(e.hdpoints)),1)]),"column-status":i(({row:e})=>[e.state!==0?(d(),p("span",te,n(e==null?void 0:e.state_label),1)):(d(),p("span",ae,[o("button",{onClick:x=>f(e.id),class:$(["px-2 py-1 text-xs rounded",s.value.has(e.id||0)?"bg-gray-400 cursor-not-allowed":"bg-red-500 text-white cursor-pointer"])},n(s.value.has(e.id||0)?"领取中...":"领取"),11,se)]))]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),oe={class:"flex flex-col gap-5"},re={class:"flex gap-5 border-b border-[#eee] pb-[15px]"},ce=["onClick"],ie={key:0},le={key:1},de=k({__name:"Rebate",setup(C){const l=P(),g=U(),r=w(l.query.tab||"recharge"),_=[{key:"recharge",name:"充值返利"},{key:"loss",name:"亏损返利"}],m=h=>{r.value=h,g.push({query:{...l.query,tab:h}})};return(h,v)=>(d(),b(T,null,{default:i(()=>[o("div",oe,[o("div",re,[(d(),p(F,null,V(_,u=>o("span",{key:u.key,class:$(["w-20 text-center text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 ",{"text-[#ff6600] border-b-[#ff6600]":r.value===u.key}]),onClick:s=>m(u.key)},n(u.name),11,ce)),64))]),r.value=="recharge"?(d(),p("div",ie,[S(O)])):z("",!0),r.value=="loss"?(d(),p("div",le,[S(ne)])):z("",!0)])]),_:1}))}}),ye=W(de,[["__scopeId","data-v-c4ce2f9a"]]);export{ye as default};
