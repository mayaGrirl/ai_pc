import{d as N,o as z,a as K,c as u,n as r,e as t,b as v,g as p,s as m,y as S,E as P,q as M,G as R,f as h,t as q,H as A,v as F,w as V,h as B,l as G,A as H,j as f,I as O,k as J,m as d,B as Q}from"./index-BrVULTij.js";import{u as W,S as X,n as Y,o as Z}from"./MainLayout-CqP2lYmd.js";import{h as _}from"./common-CJwfPX1w.js";import{L as ee,E as te,a as se,S as oe,b as ae}from"./sodium-BGf6Sbxf.js";const re={class:"space-y-2"},ne={class:"relative group"},le={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ie={key:0,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},de={class:"relative group"},ce={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},ue=["type"],pe={key:1,class:"space-y-2 animate-in slide-in-from-top-2 duration-300"},me={class:"relative group flex gap-3"},fe={class:"relative flex-1"},ye={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},be=["disabled"],ge={class:"flex items-center gap-2 cursor-pointer group"},xe=["disabled"],ve={key:0,class:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"},we={key:1},Me=N({__name:"LoginBox",props:{redirect:{type:String,default:"/"},compact:{type:Boolean,default:!1}},emits:["success"],setup(o,{emit:E}){const T=o,j=E,D=G(),U=H(),k=W(),n=Q(),l=f("password"),y=f(!1),b=f(!1),w=f(""),c=f(0);let g=null;const s=O({mobile:"",password:"",code:"",rememberMe:!0}),C=async()=>{try{const{data:a,code:e}=await _();e===200&&a&&(w.value=a.key)}catch(a){console.error("Failed to get public key:",a)}};z(()=>{C()}),K(()=>{g&&clearInterval(g)});const $=()=>{c.value=60,g=setInterval(()=>{c.value--,c.value<=0&&clearInterval(g)},1e3)},I=async()=>{if(!s.mobile){n.error("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(s.mobile)){n.error("请输入正确的手机号");return}try{const{code:a,message:e}=await Y(s.mobile);a===200?(n.success("验证码已发送"),$()):n.error(e||"发送失败")}catch(a){n.error(a.message||"发送失败")}},L=async()=>{if(!s.mobile){n.error("请输入手机号");return}if(l.value==="password"){if(!s.password){n.error("请输入密码");return}if(!w.value){n.error("系统初始化中，请稍后"),await C();return}}else if(!s.code){n.error("请输入验证码");return}b.value=!0;try{let a={mobile:s.mobile,type:l.value==="password"?1:2};l.value==="password"?a.password=await ae.encrypt(s.password,w.value):a.code=s.code;const e=await Z(a);if(e.code===200&&e.data){k.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await k.fetchCurrentCustomer(),n.success("登录成功"),j("success");const x=U.query.redirect||T.redirect;D.push(x)}else n.error(e.message||"登录失败")}catch(a){n.error(a.message||"登录失败")}finally{b.value=!1}};return(a,e)=>{const x=J("router-link");return d(),u("div",{class:r(["w-full bg-white rounded-3xl animate-in fade-in zoom-in duration-500",[o.compact?"max-w-[340px]":"p-8 max-w-[420px] shadow-xl shadow-gray-200/50 border border-gray-100"]])},[t("div",{class:r(["flex items-center justify-center p-1 bg-gray-50 rounded-2xl",o.compact?"mb-1":"mb-8"])},[t("button",{onClick:e[0]||(e[0]=i=>l.value="password"),class:r(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="password"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",o.compact?"py-1.5":"py-3"]])}," 账号密码登录 ",2),t("button",{onClick:e[1]||(e[1]=i=>l.value="sms"),class:r(["flex-1 text-sm font-bold rounded-xl transition-all",[l.value==="sms"?"bg-white text-[#ff4757] shadow-sm":"text-gray-400 hover:text-gray-600",o.compact?"py-1.5":"py-3"]])}," 短信动态登录 ",2)],2),t("div",{class:r(o.compact?"space-y-2":"space-y-5")},[t("div",re,[e[7]||(e[7]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"手机号码",-1)),t("div",ne,[t("div",le,[v(p(X),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.mobile=i),type:"text",maxlength:"11",placeholder:"请输入11位手机号",class:r([o.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[S,s.mobile]])])]),l.value==="password"?(d(),u("div",ie,[e[8]||(e[8]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"登录密码",-1)),t("div",de,[t("div",ce,[v(p(ee),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>s.password=i),type:y.value?"text":"password",placeholder:"请输入您的登录密码",class:r([o.compact?"py-1":"py-4","w-full pl-12 pr-12 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,10,ue),[[P,s.password]]),t("button",{type:"button",onClick:e[4]||(e[4]=i=>y.value=!y.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(d(),M(R(y.value?p(te):p(se)),{class:"w-5 h-5"}))])])])):h("",!0),l.value==="sms"?(d(),u("div",pe,[e[9]||(e[9]=t("label",{class:"text-[12px] font-bold text-gray-400 uppercase tracking-wider ml-1"},"动态验证码",-1)),t("div",me,[t("div",fe,[t("div",ye,[v(p(oe),{class:"w-5 h-5 text-gray-300 group-focus-within:text-[#ff4757] transition-colors"})]),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>s.code=i),type:"text",maxlength:"6",placeholder:"6位验证码",class:r([o.compact?"py-1":"py-4","w-full pl-12 pr-4 bg-gray-50 border-transparent focus:bg-white focus:border-[#ff4757] focus:ring-4 focus:ring-red-50 rounded-2xl text-gray-700 font-medium transition-all outline-none border-2"])},null,2),[[S,s.code]])]),t("button",{onClick:I,disabled:c.value>0,class:r([o.compact?"px-4 py-1":"px-6 py-4","bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap min-w-[100px]"])},q(c.value>0?`${c.value}s`:"获取验证码"),11,be)])])):h("",!0),t("div",{class:r(["flex items-center justify-between px-1",o.compact?"":"pt-2"])},[t("label",ge,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=i=>s.rememberMe=i),class:"hidden"},null,512),[[A,s.rememberMe]]),t("div",{class:r(["rounded-md border-2 flex items-center justify-center transition-all",[s.rememberMe?"bg-[#ff4757] border-[#ff4757]":"border-gray-200 group-hover:border-gray-300",o.compact?"w-4 h-4":"w-5 h-5"]])},[m(t("div",{class:r(["bg-white rounded-[1px]",o.compact?"w-2 h-2":"w-2.5 h-2.5"])},null,2),[[F,s.rememberMe]])],2),e[10]||(e[10]=t("span",{class:"text-sm text-gray-500 font-medium"},"记住登录状态",-1))]),l.value==="password"?(d(),M(x,{key:0,to:"/forgot-password",class:"text-sm text-gray-400 hover:text-[#ff4757] transition-colors font-medium"},{default:V(()=>[...e[11]||(e[11]=[B(" 忘记密码? ",-1)])]),_:1})):h("",!0)],2),t("button",{onClick:L,disabled:b.value,class:r([o.compact?"py-1 mt-2":"py-4 mt-4","w-full bg-gradient-to-r from-[#ff4757] to-[#ee5a6f] text-white font-black rounded-2xl shadow-lg shadow-red-100 hover:shadow-red-200 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:translate-y-0"])},[b.value?(d(),u("span",ve)):(d(),u("span",we,"立即登录"))],10,xe),t("div",{class:r(["text-center z-[101]",o.compact?"pt-1":"pt-6 pb-2"])},[e[13]||(e[13]=t("span",{class:"text-gray-400 text-sm font-medium"},"还没有账号?",-1)),v(x,{to:"/register",class:"ml-2 text-[#ff4757] text-sm font-black hover:underline underline-offset-4"},{default:V(()=>[...e[12]||(e[12]=[B(" 免费注册 ",-1)])]),_:1})],2)],2)],2)}}});export{Me as _};
