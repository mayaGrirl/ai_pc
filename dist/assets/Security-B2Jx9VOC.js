import{d as le,C as ne,o as ie,p as w,w as de,e,n as i,b as n,B as r,c as m,f as R,t as y,q as I,E as A,D as F,G as $,s as ue,y as ce,F as G,r as L,x as pe,k as fe,A as me,i as b,h as M,l as u,_ as ve}from"./index-BIIhTWEd.js";import{U as ye}from"./UserLayout-NZy5gp0_.js";import{f as Z,u as be,Z as ge,$ as xe,a0 as he,a1 as we,a2 as _e}from"./MainLayout-CIsb3co4.js";import"./index-yKjzY0Tb.js";import{S as Ce}from"./constants-BNhaYc6M.js";import{i as ke}from"./utils-KYcPjVjn.js";import{o as Ve,s as U,u as Ie,a as Y,E as W,t as Pe}from"./vee-validate-zod-S4LredG8.js";import{b as Q,L as q,S as z,a as P,E as B}from"./sodium-DBauwbEv.js";import{h as Ee}from"./common-DsvmAzIP.js";import{_ as Se}from"./receive-sms.vue_vue_type_script_setup_true_lang-DnM-t1UL.js";import{C as _}from"./chevron-right-CX5JUZ27.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=Z("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=Z("GiftIcon",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Te={class:"flex flex-col gap-5"},De={class:"flex gap-6 items-start"},Re={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm min-h-[600px]"},Fe={class:"mb-6"},Ge={class:"space-y-3"},Le={class:"flex items-center gap-3"},Ue={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ye={class:"mb-6"},We={class:"space-y-3"},Ne={class:"flex items-center gap-3"},je={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Oe={class:"flex items-center gap-3"},Ae={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},$e={class:"mb-6"},Me={class:"space-y-3"},Qe={class:"flex items-center gap-3"},qe={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},ze={class:"flex items-center gap-3"},Be={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},He={class:"w-[420px] shrink-0"},Ke={class:"bg-white rounded-xl border border-gray-100 p-8 shadow-md sticky top-5 min-h-[400px]"},Ze={class:"flex items-center gap-3 mb-2"},Je={class:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center"},Xe={class:"text-base font-bold text-gray-800"},es={class:"space-y-4"},ss={class:"space-y-1.5"},ts={class:"relative"},rs=["type"],os={class:"space-y-1.5"},as={class:"relative"},ls=["type"],ns={class:"space-y-1.5"},is={class:"flex items-center gap-2"},ds=["disabled"],us={key:1,class:"space-y-6"},cs={class:"flex items-center gap-3 mb-2"},ps={class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"},fs={class:"space-y-4"},ms={class:"space-y-1.5"},vs=["value"],ys={class:"space-y-1.5"},bs=["disabled"],gs={key:2,class:"space-y-6"},xs={class:"flex items-center gap-3 mb-2"},hs={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},ws={class:"space-y-3 pt-2"},_s=["onClick"],Cs={class:"text-sm text-gray-700 font-medium"},ks={key:3,class:"space-y-6"},Vs={class:"flex items-center gap-3 mb-2"},Is={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},Ps={class:"space-y-3 pt-2"},Es=["onClick"],Ss={class:"text-sm text-gray-700 font-medium"},Ts=le({__name:"Security",setup(Ds){const J=fe(),d=me(),g=be(),v=M(()=>g.currentCustomer),o=b("LOGIN_PWD"),c=b(!1),C=b(!1),k=b(!1),N=M(()=>v.value?ke(v.value.securitypass):!1),p=b({question:"",answer:""}),X=async()=>{if(!c.value){if(!p.value.question||!p.value.answer){d.error("请填写完整密保信息");return}c.value=!0;try{const{code:a,message:s}=await he({safe_ask:p.value.question,answer:p.value.answer});a===200?(d.success("密保设置成功"),p.value={question:"",answer:""},o.value="LOGIN_PWD",g.setCurrentCustomer({securitypass:"1"})):d.error(s)}catch(a){const s=a instanceof Error?a.message:"保存失败，刷新页面请重试";d.error(s)}finally{c.value=!1}}},ee=async a=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await we({prize_verify_type:a});s===200?(d.success("兑奖验证方式已更新"),g.setCurrentCustomer({prizeVerifyType:a})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},se=async a=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await _e({select_card_verify_type:a});s===200?(d.success("查看卡密验证方式已更新"),g.setCurrentCustomer({selectcardVerifyType:a})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},E=b(""),te=Ve({verify_code:U().min(1,"请输入验证码"),password:U().min(8,"请输入密码"),confirm_password:U()}).refine(a=>a.password===a.confirm_password,{path:["confirm_password"],message:"两次输入的密码不一致"}),re=Pe(te),{handleSubmit:oe,isSubmitting:V,resetForm:j}=Ie({validationSchema:re,initialValues:{password:"",confirm_password:"",verify_code:""}}),{value:S}=Y("password"),{value:T}=Y("confirm_password"),{value:D}=Y("verify_code"),O=oe(async a=>{console.log("submitExchange",a),V.value=!0;const s=await Q.encrypt(a.password,E.value),t=await Q.encrypt(a.confirm_password,E.value);try{if(o.value==="LOGIN_PWD"){const{code:l,message:f}=await ge({verify_code:a.verify_code,password:s,confirm_password:t});l!==200?d.error(f):(d.success("更新成功"),j(),g.logout(),await J.push("/login"))}else{const{code:l,message:f}=await xe({verify_code:a.verify_code,password:s,confirm_password:t});l!==200?d.error(f):d.success("更新成功")}}catch(l){d.error(l.message||"提交失败")}finally{V.value=!1}});return ne(o,a=>{(a==="LOGIN_PWD"||a==="PAY_PWD")&&j()}),ie(()=>{Ee().then(({data:a,code:s})=>{s==200&&(E.value=a.key)})}),(a,s)=>(u(),w(ye,null,{default:de(()=>[e("div",Te,[s[31]||(s[31]=e("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[e("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"安全中心")],-1)),e("div",De,[e("div",Re,[s[21]||(s[21]=e("div",{class:"mb-6 pb-4 border-b border-gray-100"},[e("h3",{class:"text-lg font-bold text-gray-800"},"安全设置"),e("p",{class:"text-sm text-gray-500 mt-1"},"定期更新您的设置，以便保护账号安全")],-1)),e("section",Fe,[s[14]||(s[14]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-[#ff6600] pl-3"}," 账户安全 ",-1)),e("div",Ge,[e("div",{onClick:s[0]||(s[0]=t=>o.value="LOGIN_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",o.value==="LOGIN_PWD"?"bg-orange-50 border-orange-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Le,[e("div",Ue,[n(r(q),{class:"w-4 h-4 text-orange-500"})]),s[13]||(s[13]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"登录密码"),e("div",{class:"text-[11px] text-gray-400"},"用于登录账户，建议定期更换")],-1))]),n(r(_),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",o.value==="LOGIN_PWD"?"text-orange-500":"text-gray-300"])},null,8,["class"])],2)])]),e("section",Ye,[s[17]||(s[17]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-blue-500 pl-3"}," 支付安全 ",-1)),e("div",We,[e("div",{onClick:s[1]||(s[1]=t=>o.value="PAY_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",o.value==="PAY_PWD"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ne,[e("div",je,[n(r(z),{class:"w-4 h-4 text-blue-500"})]),s[15]||(s[15]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"二级密码"),e("div",{class:"text-[11px] text-gray-400"},"用于资金变动、兑换等高危操作验证")],-1))]),n(r(_),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",o.value==="PAY_PWD"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2),N.value?(u(),m("div",{key:0,onClick:s[2]||(s[2]=t=>o.value="SECURITY_QUEST"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",o.value==="SECURITY_QUEST"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Oe,[e("div",Ae,[n(r(H),{class:"w-4 h-4 text-blue-500"})]),s[16]||(s[16]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"密保设置"),e("div",{class:"text-[11px] text-gray-400"},"找回密码、修改重要信息的最后一道防线")],-1))]),n(r(_),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",o.value==="SECURITY_QUEST"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2)):R("",!0)])]),e("section",$e,[s[20]||(s[20]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-purple-500 pl-3"}," 其他权限验证 ",-1)),e("div",Me,[e("div",{onClick:s[3]||(s[3]=t=>o.value="GIFT_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",o.value==="GIFT_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Qe,[e("div",qe,[n(r(K),{class:"w-4 h-4 text-purple-500"})]),s[18]||(s[18]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"兑奖验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置兑换红包或奖品时的二次验证")],-1))]),n(r(_),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",o.value==="GIFT_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2),e("div",{onClick:s[4]||(s[4]=t=>o.value="CARD_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",o.value==="CARD_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",ze,[e("div",Be,[n(r(P),{class:"w-4 h-4 text-purple-500"})]),s[19]||(s[19]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"查看卡密验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置查看已购卡密时的验证方式")],-1))]),n(r(_),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",o.value==="CARD_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2)])])]),e("div",He,[e("div",Ke,[o.value==="LOGIN_PWD"||o.value==="PAY_PWD"?(u(),m("form",{onSubmit:s[10]||(s[10]=ue((...t)=>r(O)&&r(O)(...t),["prevent"])),key:"login-password",class:"space-y-6"},[e("div",Ze,[e("div",Je,[o.value==="LOGIN_PWD"?(u(),w(r(q),{key:0,class:"w-5 h-5 text-orange-500"})):o.value==="PAY_PWD"?(u(),w(r(z),{key:1,class:"w-4 h-4 text-blue-500"})):R("",!0)]),e("h4",Xe,y(o.value==="LOGIN_PWD"?"修改登录密码":"修改二级密码"),1)]),e("div",es,[e("div",ss,[s[22]||(s[22]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"password"},"新密码",-1)),e("div",ts,[I(e("input",{id:"password","onUpdate:modelValue":s[5]||(s[5]=t=>F(S)?S.value=t:null),type:C.value?"text":"password",placeholder:"请输入新密码",class:"security-input",autocomplete:"off",spellcheck:"false"},null,8,rs),[[A,r(S)]]),e("button",{type:"button",onClick:s[6]||(s[6]=t=>C.value=!C.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(u(),w($(C.value?r(B):r(P)),{class:"w-4 h-4"}))])])]),n(r(W),{name:"password",class:"text-[#ff4d4f] text-sm"}),e("div",os,[s[23]||(s[23]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"confirm_password"},"确认新密码",-1)),e("div",as,[I(e("input",{id:"confirm_password","onUpdate:modelValue":s[7]||(s[7]=t=>F(T)?T.value=t:null),type:k.value?"text":"password",placeholder:"请再次输入新密码",autocomplete:"off",spellcheck:"false",class:"security-input"},null,8,ls),[[A,r(T)]]),e("button",{type:"button",onClick:s[8]||(s[8]=t=>k.value=!k.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(u(),w($(k.value?r(B):r(P)),{class:"w-4 h-4"}))])])]),n(r(W),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"}),e("div",ns,[s[24]||(s[24]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"verify_code"},"验证码",-1)),e("div",is,[n(Se,{scene:o.value==="LOGIN_PWD"?"update_password":"update_pay_password",modelValue:r(D),"onUpdate:modelValue":s[9]||(s[9]=t=>F(D)?D.value=t:null)},null,8,["scene","modelValue"])])]),n(r(W),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})]),e("button",{type:"submit",disabled:r(V),class:"security-btn bg-[#ff6b6b]"},y(r(V)?"提交中...":"提交修改"),9,ds)],32)):o.value==="SECURITY_QUEST"&&N.value?(u(),m("div",us,[e("div",cs,[e("div",ps,[n(r(H),{class:"w-5 h-5 text-blue-500"})]),s[25]||(s[25]=e("h4",{class:"text-base font-bold text-gray-800"},"设置密保问题",-1))]),e("div",fs,[e("div",ms,[s[27]||(s[27]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保问题",-1)),I(e("select",{"onUpdate:modelValue":s[11]||(s[11]=t=>p.value.question=t),class:"security-input appearance-none"},[s[26]||(s[26]=e("option",{value:"",disabled:""},"选择您的密保问题",-1)),(u(!0),m(G,null,L(r(Ce),t=>(u(),m("option",{key:`option-${t.value}`,value:String(t.value)},y(a.$t(t.i18nKey)),9,vs))),128))],512),[[ce,p.value.question]])]),e("div",ys,[s[28]||(s[28]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保答案",-1)),I(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>p.value.answer=t),type:"text",placeholder:"请输入答案",class:"security-input"},null,512),[[pe,p.value.answer]])]),e("button",{onClick:X,disabled:c.value,class:"security-btn bg-blue-500"},y(c.value?"提交中...":"提交设置"),9,bs)])])):o.value==="GIFT_VERIFY"?(u(),m("div",gs,[e("div",xs,[e("div",hs,[n(r(K),{class:"w-5 h-5 text-purple-500"})]),s[29]||(s[29]=e("h4",{class:"text-base font-bold text-gray-800"},"兑奖验证方式",-1))]),e("div",ws,[(u(),m(G,null,L({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,x,h;return e("div",{key:l,onClick:ae=>ee(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=v.value)==null?void 0:f.prizeVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",Cs,y(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((x=v.value)==null?void 0:x.prizeVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((h=v.value)==null?void 0:h.prizeVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,_s)}),64))])])):o.value==="CARD_VERIFY"?(u(),m("div",ks,[e("div",Vs,[e("div",Is,[n(r(P),{class:"w-5 h-5 text-purple-500"})]),s[30]||(s[30]=e("h4",{class:"text-base font-bold text-gray-800"},"查看卡密验证方式",-1))]),e("div",Ps,[(u(),m(G,null,L({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,x,h;return e("div",{key:l,onClick:ae=>se(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=v.value)==null?void 0:f.selectcardVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",Ss,y(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((x=v.value)==null?void 0:x.selectcardVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((h=v.value)==null?void 0:h.selectcardVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,Es)}),64))])])):R("",!0)])])])])]),_:1}))}}),$s=ve(Ts,[["__scopeId","data-v-470d83eb"]]);export{$s as default};
