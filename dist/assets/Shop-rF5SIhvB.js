import{d as ee,u as te,L as se,o as oe,x as z,w as ae,e as t,C as o,b as r,t as d,i as ne,c as u,h as M,v as j,E as v,f as A,z as le,F as ie,r as re,g as de,B as xe,m as pe,k as m,j as V,p as x}from"./index-BRm43S8G.js";import{_ as g}from"./coin-BjeO1Yvx.js";import{M as ue}from"./MainLayout-CW8OZvWa.js";import{T as me}from"./TextSkeleton-BQcgvVWA.js";import{c as ce,_ as fe,S as _e,a as ve}from"./constants-DtJkf4qJ.js";import{o as ge,s as E,n as O,u as be,a as b,E as h,t as he}from"./vee-validate-zod-CTPqK7gX.js";import{D as ye}from"./decimal-CaUHonIL.js";import{c as we}from"./createLucideIcon-t3KM-RZb.js";import"./customer-CiX-YbPn.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=we("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ke={class:"min-h-[calc(100vh-120px)] px-5 py-10"},Se={class:"max-w-[1400px] mx-auto grid grid-cols-[1fr_500px] gap-[30px] items-start max-[1200px]:grid-cols-1 max-[1200px]:max-w-[600px]"},Ce={class:"flex flex-col gap-6"},Me={class:"grid grid-cols-2 gap-4 max-md:grid-cols-1"},Ve={class:"text-[24px] text-[#667eea] not-italic"},Ee={class:"text-[24px] text-[#667eea] not-italic"},Ie={class:"grid grid-cols-2 gap-4 max-md:grid-cols-1"},Te={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Ne={class:"flex items-center gap-1.5 mb-1"},$e={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},De={href:"/user/bank",class:"mt-1 text-[13px] text-[#667eea] no-underline hover:underline flex items-center"},Le={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Re={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},Be={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},Fe={class:"flex items-center gap-1.5 mb-1"},Ue={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},ze={class:"bg-white rounded-xl p-5 transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]"},je={class:"flex items-center gap-1.5 mb-1"},Ae={class:"text-2xl text-[28px] font-bold text-[#ff4757]"},Oe={class:"bg-white rounded-xl p-6 shadow-[0_2px_8px_rgba(0,0,0,0.1)]"},Pe=["innerHTML"],Qe={class:"sticky top-10 max-[1200px]:static"},He={class:"bg-white rounded-2xl p-10 shadow-[0_8px_24px_rgba(0,0,0,0.12)] max-md:p-6"},Ke={class:"flex gap-[1px] flex-col"},qe={class:"relative flex items-center"},Ye={class:"flex gap-[1px] flex-col"},Ge={class:"flex items-center gap-2 px-4 py-[14px] bg-gray-50 rounded-lg border-2 border-gray-200"},Je={class:"text-lg font-bold text-[#333]"},We={class:"flex gap-[1px] flex-col"},Xe={class:"relative flex items-center gap-2 px-4 py-[14px] bg-gray-50 rounded-lg border-2 border-gray-200"},Ze={class:"text-lg font-bold text-[#333]"},et={key:0,class:"flex gap-[1px] flex-col"},tt={class:"relative flex items-center gap-1"},st={key:1},ot={class:"flex gap-[1px] flex-col"},at={class:"relative flex items-center gap-1"},nt=["value"],lt={class:"flex gap-[1px] flex-col"},it={class:"relative flex items-center gap-1"},rt=["disabled"],P=1e3,ht=ee({__name:"Shop",setup(dt){const y=xe(),{locale:Q}=te(),T=pe(),H=se[Q.value]??"USD",K=m(1),w=m(!1),N=m(!1),$=m(0),l=m(),D=m(""),L=async s=>{w.value=!0;const{data:e,code:n}=await ve();if(n==200){s&&(D.value=(e==null?void 0:e.block_content)||""),l.value=e,$.value=e.exempt_commission_bank_points||0;const i=e.bank_points||0;e.is_allowed_exchange&&i>=100&&(N.value=!1)}w.value=!1},q=ge({amount:O({message:"请输入金额"}).int("必须是整数").positive("金额必须大于 0").refine(s=>s%100===0,{message:"请输入100的整数倍"}),commission:O().optional(),safe_ask:E().optional(),answer:E().optional(),verify_code:E().optional()}).superRefine((s,e)=>{var i,f,_;const n=(i=l.value)==null?void 0:i.bank_points;n!==void 0&&s.amount>n&&e.addIssue({path:["amount"],message:"兑换金额不能超过银行余额",code:"custom"}),((f=l.value)==null?void 0:f.prize_verify_type)=="safeQuestion"&&((!s.safe_ask||s.safe_ask.length<1)&&e.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!s.answer||s.answer.length<1)&&e.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),s.answer&&s.answer.length>50&&e.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((_=l.value)==null?void 0:_.prize_verify_type)=="smsVerify"&&(!s.verify_code||s.verify_code.length<1)&&e.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),Y=he(q),{handleSubmit:G,isSubmitting:c,resetForm:J}=be({validationSchema:Y,initialValues:{safe_ask:""}}),{value:p,errorMessage:xt,meta:W}=b("amount"),{value:k}=b("safe_ask"),{value:S}=b("answer"),{value:C}=b("verify_code"),R=V(()=>Math.floor((p.value||0)*P)),X=V(()=>{if(p.value>0){const s=p.value*P,e=Math.max(0,s-$.value);return new ye(e).mul(.02).div(1e3).ceil().toNumber()}return 0}),B=G(async(s,{setErrors:e})=>{c.value=!0;try{const{code:n,message:i}=await ce({amount:R.value,commission:0,safe_ask:s.safe_ask,answer:s.answer,verify_code:s.verify_code});n!==200?y.error(i):(y.success("兑换成功"),await L(!1),J())}catch(n){y.error(n.message||"提交失败")}finally{c.value=!1}}),Z=V(()=>W.valid&&!!p.value&&!c.value);return oe(()=>{L(!0)}),(s,e)=>(x(),z(ue,null,{default:ae(()=>{var n,i,f,_,F,U;return[t("div",ke,[t("div",Se,[t("div",Ce,[t("div",Me,[t("button",{class:"bg-white rounded-xl px-6 py-[18px] flex justify-between items-center text-base font-medium text-[#333] transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]",onClick:e[0]||(e[0]=a=>o(T).push("/user/exchange"))},[e[7]||(e[7]=t("span",null,"兑换记录",-1)),t("i",Ve,[r(o(I),{class:"h-4 w-4"})])]),t("button",{class:"bg-white rounded-xl px-6 py-[18px] flex justify-between items-center text-base font-medium text-[#333] transition-all duration-300 shadow-[0_2px_8px_rgba(0,0,0,0.1)] hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]",onClick:e[1]||(e[1]=a=>o(T).push("/user/props"))},[e[8]||(e[8]=t("span",null,"我的卡密",-1)),t("i",Ee,[r(o(I),{class:"h-4 w-4"})])])]),t("div",Ie,[t("div",Te,[e[11]||(e[11]=t("div",{class:"text-sm text-gray-600 mb-2"},"银行余额",-1)),t("div",Ne,[t("span",$e,d(s.$n(((n=l.value)==null?void 0:n.bank_points)||0)),1),e[9]||(e[9]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))]),t("a",De,[e[10]||(e[10]=ne(" 去存入 ",-1)),r(o(I),{class:"h-4 w-4"})])]),t("div",Le,[e[12]||(e[12]=t("div",{class:"text-sm text-gray-600 mb-2"},"折合",-1)),t("div",Re,d(s.$n(((i=l.value)==null?void 0:i.bank_points_convert)||0,{style:"currency",currency:o(H)})),1)]),t("div",Be,[e[14]||(e[14]=t("div",{class:"text-sm text-gray-600 mb-2"},"我的金豆",-1)),t("div",Fe,[t("span",Ue,d(s.$n(((f=l.value)==null?void 0:f.points)||0)),1),e[13]||(e[13]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])]),t("div",ze,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-600 mb-2"},"近7日流水",-1)),t("div",je,[t("span",Ae,d(s.$n(Number(((_=l.value)==null?void 0:_.week_water)||0))),1),e[15]||(e[15]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])])]),t("div",Oe,[e[17]||(e[17]=t("div",{class:"text-base font-bold text-[#ff4757] mb-4 pl-3 border-l-4 border-[#ff4757]"},"温馨提示",-1)),w.value?(x(),z(me,{key:0,lines:5,height:"14px",animation:"wave"})):(x(),u("div",{key:1,class:"list-none p-0 m-0",innerHTML:D.value},null,8,Pe))])]),t("div",Qe,[t("div",He,[e[28]||(e[28]=t("h2",{class:"text-[28px] font-bold text-[#333] mb-8 text-center max-md:text-2xl"},"金豆兑换",-1)),(x(),u("form",{onSubmit:e[6]||(e[6]=de((...a)=>o(B)&&o(B)(...a),["prevent"])),class:"flex flex-col gap-6",key:K.value},[t("div",Ke,[e[19]||(e[19]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"amount"},"兑换金额",-1)),t("div",qe,[M(t("input",{type:"number",id:"amount",inputmode:"numeric",pattern:"[0-9]*",step:"100",min:"0","onUpdate:modelValue":e[2]||(e[2]=a=>v(p)?p.value=a:null),placeholder:"请输入100的整数倍",class:"px-4 py-[14px] pr-20 border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[j,o(p),void 0,{number:!0}]]),e[18]||(e[18]=t("span",{class:"absolute right-4 text-[#666] text-[15px]"},"元",-1))]),r(o(h),{name:"amount",class:"text-[#ff4d4f] text-sm"})]),t("div",Ye,[e[21]||(e[21]=t("label",{class:"text-[15px] font-medium text-[#333333]"},"折合金豆",-1)),t("div",Ge,[t("span",Je,d(R.value),1),e[20]||(e[20]=t("span",{class:"text-lg"},[t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:g})],-1))])]),t("div",We,[e[23]||(e[23]=t("label",{class:"text-[15px] font-medium text-[#333333]"},"手续费",-1)),t("div",Xe,[t("span",Ze,d(X.value),1),e[22]||(e[22]=t("span",{class:"absolute right-4 text-[#666] text-[15px]"},"元",-1))])]),((F=l.value)==null?void 0:F.prize_verify_type)=="smsVerify"?(x(),u("div",et,[e[24]||(e[24]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),t("div",tt,[r(fe,{scene:"exchange_card",modelValue:o(C),"onUpdate:modelValue":e[3]||(e[3]=a=>v(C)?C.value=a:null),disabled:!Z.value},null,8,["modelValue","disabled"])]),r(o(h),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):A("",!0),((U=l.value)==null?void 0:U.prize_verify_type)=="safeQuestion"?(x(),u("div",st,[t("div",ot,[e[26]||(e[26]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),t("div",at,[M(t("select",{id:"safe_ask","onUpdate:modelValue":e[4]||(e[4]=a=>v(k)?k.value=a:null),class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[e[25]||(e[25]=t("option",{key:"option-default",value:""},"请选择问题",-1)),(x(!0),u(ie,null,re(o(_e),a=>(x(),u("option",{key:`option-${a.value}`,value:String(a.value)},d(s.$t(a.i18nKey)),9,nt))),128))],512),[[le,o(k)]])]),r(o(h),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),t("div",lt,[e[27]||(e[27]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),t("div",it,[M(t("input",{id:"answer",type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>v(S)?S.value=a:null),placeholder:"请输入答案",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[j,o(S)]])]),r(o(h),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):A("",!0),t("button",{type:"submit",disabled:o(c)||N.value,class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},d(o(c)?"提交中...":"提交"),9,rt)],32))])])])])]}),_:1}))}});export{ht as default};
