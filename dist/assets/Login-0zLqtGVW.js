import{d as x,u as C,o as M,r as m,x as V,w as b,g as c,f as o,c as g,e as L,t as i,p as _,v as h,C as S,A as r,b as B,D as E,q as N,i as P,s as R,h as T}from"./index-CpMdb0R9.js";import{u as D,M as F,l as U}from"./MainLayout-rB-7dyln.js";import{h as q,S as A}from"./sodium-zgNEJugr.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"login-page"},j={class:"login-container"},z={class:"login-form"},G={key:0,class:"error-message"},H={class:"form-group"},J={class:"input-wrapper"},O=["placeholder"],Q={class:"form-group"},W={class:"input-wrapper"},X=["placeholder"],Y={class:"form-options"},Z={class:"checkbox-label"},$={class:"button-group"},ee=["disabled"],oe={key:0,class:"loading-spinner"},se={key:1},te=x({__name:"Login",setup(ne){const{t:s}=C(),f=T(),y=R(),v=D(),d=m(!1),a=m(""),u=m(""),t=S({mobile:"",password:"",rememberMe:!1});M(()=>{q().then(({data:n,code:e})=>{e===200&&n&&(u.value=n.key,console.log("Public key loaded:",n.key))}).catch(n=>{console.error("Failed to get public key:",n)})});const w=async()=>{if(a.value="",!t.mobile){a.value=s("login.inputMobile");return}if(!t.password){a.value=s("login.inputPassword");return}if(t.password.length<6){a.value=s("login.passwordError");return}if(!u.value){a.value="ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åŽé‡è¯•";return}d.value=!0;try{const n=await A.encrypt(t.password,u.value);console.log("Encrypted password:",n);const e=await U({mobile:t.mobile,password:n,type:1});if(e.code===200&&e.data){v.setToken(e.data.access_token,e.data.token_type,e.data.expires_at),await v.fetchCurrentCustomer();const p=y.query.redirect||"/";f.push(p)}else a.value=e.message||s("login.loginFailed")}catch(n){console.error("Login error:",n),a.value=s("login.loginFailed")}finally{d.value=!1}},k=()=>{f.push("/register")};return(n,e)=>{const p=P("router-link");return c(),V(F,null,{default:b(()=>[o("div",K,[o("div",j,[e[5]||(e[5]=o("h1",{class:"page-title"},"ç™» å½•",-1)),o("div",z,[a.value?(c(),g("div",G,i(a.value),1)):L("",!0),o("div",H,[o("div",J,[e[3]||(e[3]=o("span",{class:"input-icon"},"ðŸ“±",-1)),_(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.mobile=l),type:"text",placeholder:r(s)("login.mobile"),maxlength:"11"},null,8,O),[[h,t.mobile]])])]),o("div",Q,[o("div",W,[e[4]||(e[4]=o("span",{class:"input-icon"},"ðŸ”’",-1)),_(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.password=l),type:"password",placeholder:r(s)("login.password")},null,8,X),[[h,t.password]])])]),o("div",Y,[o("label",Z,[_(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.rememberMe=l),type:"checkbox"},null,512),[[E,t.rememberMe]]),o("span",null,i(r(s)("login.rememberMe"))+"ï¼ˆä¸æ˜¯è‡ªå·±çš„ç”µè„‘ä¸è¦å‹¾é€‰ï¼‰",1)]),B(p,{to:"/forgot-password",class:"forgot-link"},{default:b(()=>[N(i(r(s)("login.forgotPassword"))+"? ",1)]),_:1})]),o("div",$,[o("button",{type:"button",class:"btn-submit",disabled:d.value,onClick:w},[d.value?(c(),g("span",oe)):(c(),g("span",se,i(r(s)("common.login")),1))],8,ee),o("button",{type:"button",class:"btn-register",onClick:k},i(r(s)("common.register")),1)])])])])]),_:1})}}}),de=I(te,[["__scopeId","data-v-59b71a76"]]);export{de as default};
