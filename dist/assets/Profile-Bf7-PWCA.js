import{d as ee,o as te,x as se,w as le,e as t,t as i,C as d,c as a,h as g,v as c,E as v,i as M,g as oe,f as re,B as ae,k as p,j as ne,p as r,s as ie}from"./index-B3amumuV.js";import{_ as de}from"./coin-BjeO1Yvx.js";import{U as ue}from"./UserLayout-BfXv4yVh.js";import{u as fe}from"./MainLayout-Cp4yWRnA.js";import{B as ge,C as ce,D as pe,E as xe}from"./customer-QUF3XMsB.js";import{o as me,s as b,u as ye,a as w,t as ve}from"./vee-validate-zod-C1u-QrAl.js";import{D as be}from"./decimal-CaUHonIL.js";function we(u){return u==null||typeof u=="string"&&u.trim()===""}function he(u,n=2,h=2,k="**"){return u.length<=n+h?u:`${u.slice(0,n)}${k}${u.slice(-h)}`}const ke={class:"flex flex-col gap-5"},_e={class:"flex gap-6 items-start"},qe={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm"},Ce={class:"grid grid-cols-2 gap-4 mb-6 bg-gray-50 p-4 rounded-lg"},Ee={class:"flex flex-col gap-1"},Ve={class:"text-sm font-bold text-gray-800 font-mono"},Be={class:"flex flex-col gap-1"},Ne={class:"text-sm font-bold text-gray-800"},Ue={class:"grid grid-cols-1 gap-5"},Se={class:"flex flex-col gap-2"},je={class:"relative"},De={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},Me={class:"flex flex-col gap-2"},$e={class:"relative"},Qe={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},Fe={class:"flex flex-col gap-2"},Ie={class:"relative"},Te={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},ze={class:"flex flex-col gap-2"},Pe={class:"relative"},Re={key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none"},He={class:"flex flex-col gap-2"},Le={class:"relative"},Ae=["title"],Ge={class:"flex flex-col gap-2"},Ke=["disabled"],Je={class:"w-[320px] shrink-0"},Oe={class:"bg-white rounded-xl border border-gray-100 p-6 shadow-sm sticky top-5"},We={class:"flex flex-col items-center text-center"},Xe={class:"text-lg font-bold text-gray-800 mb-1"},Ye={class:"text-xs text-gray-400 mb-6 font-mono"},Ze={class:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100"},et={key:0,class:"flex flex-col gap-3"},tt={key:1,class:"flex flex-col gap-3"},st={class:"flex gap-2"},lt={key:0,class:"w-full bg-gray-50 rounded-lg p-4 border border-gray-100 mt-4"},ot={key:0,class:"flex flex-col gap-3"},rt={key:1,class:"flex flex-col gap-3"},at={class:"flex gap-2"},nt=ee({__name:"Profile",setup(u){const n=ae(),h=fe(),k=ne(()=>h.currentCustomer),q=p(!1),x=p(""),A=()=>{var s;x.value=((s=l.value)==null?void 0:s.nickname)||"",q.value=!0},G=async()=>{var s,e,f;if(!x.value){n.error("昵称不能为空");return}try{const{code:y,message:D}=await pe({nickname:x.value});if(y===200){l.value&&(l.value.nickname=x.value),q.value=!1,n.success("昵称修改成功");let _=(s=k.value)==null?void 0:s.points;(e=k.value)!=null&&e.points&&(_=new be((f=k.value)==null?void 0:f.points).sub(200).toNumber()),h.setCurrentCustomer({nickname:x.value,points:_})}else n.error(D||"修改失败")}catch(y){n.error(y.message||"修改失败")}},C=p(!1),m=p(""),$=p(!1),K=()=>{var s;m.value=((s=l.value)==null?void 0:s.email)||"",C.value=!0},J=async()=>{if(!m.value){n.error("邮箱不能为空");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value)){n.error("请输入有效的邮箱地址");return}try{const{code:e,message:f}=await xe({email:m.value});e===200?(l.value&&(l.value.email=m.value),C.value=!1,$.value=!1,n.success("邮箱绑定成功")):n.error(f||"绑定失败")}catch(e){n.error(e.message||"绑定失败")}},O=p(1),W=me({realname:b().trim().refine(s=>s===""||s.length<=50,{message:"真实姓名不能超过50字符"}),qq:b().trim().refine(s=>s===""||/^\d{5,12}$/.test(s),{message:"QQ号格式不正确"}),alipay:b().trim().refine(s=>s===""||s.length<=50,{message:"支付宝账号不能超过50字符"}),wchat:b().trim().refine(s=>s===""||s.length<=50,{message:"微信账号不能超过50字符"}),address:b().trim().refine(s=>s===""||s.length<=150,{message:"地址不能超过150字符"}),signature:b().trim().refine(s=>s===""||s.length<=200,{message:"签名不能超过200字符"})}),X=ve(W),{handleSubmit:Y,isSubmitting:E,resetForm:Z}=ye({validationSchema:X}),{value:V}=w("realname"),{value:B}=w("qq"),{value:N}=w("alipay"),{value:U}=w("wchat"),{value:S}=w("address"),{value:j}=w("signature"),Q=Y(async s=>{E.value=!0;try{const{code:e,message:f,data:y}=await ge({qq:s.qq,wchat:s.wchat,alipay:s.alipay,realname:s.realname,address:s.address,signature:s.signature});e!==200?n.error(f):(n.success("充值成功"),Z(),I())}catch(e){n.error(e.message||"提交失败")}finally{E.value=!1}}),F=p(!1),l=p(),I=async()=>{F.value=!0;try{const{data:s,code:e}=await ce();e===200&&(l.value=s,V.value=s.realname||"",B.value=s.qq||"",N.value=s.alipay||"",U.value=s.wchat||"",S.value=s.address||"",j.value=s.signature||"",we(s.email)&&($.value=!0))}catch(s){console.error("Get member field error:",s)}finally{F.value=!1}};return te(()=>{I()}),(s,e)=>(r(),se(ue,null,{default:le(()=>{var f,y,D,_,T,z,P,R,H,L;return[t("div",ke,[e[27]||(e[27]=t("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[t("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"修改资料")],-1)),t("div",_e,[t("div",qe,[e[21]||(e[21]=t("div",{class:"mb-6 pb-4 border-b border-gray-100"},[t("h3",{class:"text-lg font-bold text-gray-800"},"基本资料"),t("p",{class:"text-sm text-gray-500 mt-1"},"完善您的个人信息，以便更好地为您服务")],-1)),t("div",Ce,[t("div",Ee,[e[11]||(e[11]=t("span",{class:"text-xs text-gray-500"},"手机号码",-1)),t("span",Ve,i(d(he)(((f=l.value)==null?void 0:f.mobile)||"",3,4)),1)]),t("div",Be,[e[12]||(e[12]=t("span",{class:"text-xs text-gray-500"},"邮箱地址",-1)),t("span",Ne,i(((y=l.value)==null?void 0:y.email)||"未绑定"),1)])]),(r(),a("form",{onSubmit:e[6]||(e[6]=oe((...o)=>d(Q)&&d(Q)(...o),["prevent"])),class:"flex flex-col gap-5",key:O.value},[t("div",Ue,[t("div",Se,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-gray-700",for:"qq"},"QQ号码",-1)),t("div",je,[(D=l.value)!=null&&D.qq?(r(),a("div",De,i(l.value.qq),1)):g((r(),a("input",{key:0,id:"qq",type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>v(B)?B.value=o:null),placeholder:"请输入QQ号码",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[c,d(B)]])])]),t("div",Me,[e[14]||(e[14]=t("label",{class:"text-sm font-medium text-gray-700",for:"wechat"},"微信号",-1)),t("div",$e,[(_=l.value)!=null&&_.wchat?(r(),a("div",Qe,i(l.value.wchat),1)):g((r(),a("input",{key:0,id:"wechat",type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>v(U)?U.value=o:null),placeholder:"请输入微信号码",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[c,d(U)]])])]),t("div",Fe,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-gray-700",for:"alipay"},"支付宝账号",-1)),t("div",Ie,[(T=l.value)!=null&&T.alipay?(r(),a("div",Te,i(l.value.alipay),1)):g((r(),a("input",{key:0,id:"alipay",type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>v(N)?N.value=o:null),placeholder:"请输入支付宝账号",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[c,d(N)]])])]),t("div",ze,[e[17]||(e[17]=t("label",{class:"text-sm font-medium text-gray-700",for:"realName"},"真实姓名",-1)),t("div",Pe,[(z=l.value)!=null&&z.realname?(r(),a("div",Re,[M(i(l.value.realname)+" ",1),e[16]||(e[16]=t("span",{class:"ml-2 text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100"},"已实名",-1))])):g((r(),a("input",{key:0,id:"realName",type:"text","onUpdate:modelValue":e[3]||(e[3]=o=>v(V)?V.value=o:null),placeholder:"请输入真实姓名",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[c,d(V)]])])]),t("div",He,[e[18]||(e[18]=t("label",{class:"text-sm font-medium text-gray-700",for:"address"},"收货地址",-1)),t("div",Le,[(P=l.value)!=null&&P.address?(r(),a("div",{key:1,class:"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed select-none truncate",title:l.value.address},i(l.value.address),9,Ae)):g((r(),a("input",{key:0,id:"address",type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>v(S)?S.value=o:null),placeholder:"请填写真实收货地址",class:"w-full pl-3 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400"},null,512)),[[c,d(S)]])])]),t("div",Ge,[e[19]||(e[19]=t("label",{class:"text-sm font-medium text-gray-700",for:"signature"},"个人签名",-1)),g(t("textarea",{id:"signature","onUpdate:modelValue":e[5]||(e[5]=o=>v(j)?j.value=o:null),rows:"3",placeholder:"写一句话介绍自己...",class:"w-full p-3 border border-gray-300 rounded-lg text-sm leading-relaxed focus:ring-2 focus:ring-[#ff6600]/20 focus:border-[#ff6600] outline-none transition-all placeholder-gray-400 resize-none"},null,512),[[c,d(j)]])])]),e[20]||(e[20]=t("div",{class:"flex items-start gap-2 bg-orange-50 p-3 rounded-lg border border-orange-100"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#ff6600","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]),t("span",{class:"text-xs text-orange-700 leading-tight"},"温馨提示：部分资料保存后不可再次修改，请务必填写真实有效的信息。如有填写错误，请联系在线客服处理。")],-1)),t("button",{type:"submit",disabled:d(E),class:"w-full py-3 bg-gradient-to-r from-[#ff6600] to-[#ff8533] text-white rounded-lg text-sm font-bold shadow-lg shadow-orange-500/30 hover:shadow-orange-500/40 hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200"},i(d(E)?"保存中...":"保存资料"),9,Ke)],32))]),t("div",Je,[t("div",Oe,[t("div",We,[t("h3",Xe,i(((R=l.value)==null?void 0:R.nickname)||"未设置昵称"),1),t("p",Ye,"ID: "+i(((H=l.value)==null?void 0:H.aid)||"-"),1),t("div",Ze,[e[24]||(e[24]=t("div",{class:"text-xs font-bold text-gray-500 mb-3 text-left uppercase tracking-wider"},"修改昵称",-1)),q.value?(r(),a("div",tt,[g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>x.value=o),type:"text",placeholder:"请输入新昵称",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm outline-none focus:border-[#ff6600]",maxlength:"12"},null,512),[[c,x.value]]),e[23]||(e[23]=t("span",{class:"text-xs text-orange-700 leading-tight text-left"},[M(" 修改昵称需要花费 200 "),t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:de})],-1)),t("div",st,[t("button",{onClick:e[8]||(e[8]=o=>q.value=!1),class:"flex-1 py-1.5 bg-gray-200 text-gray-600 rounded text-xs hover:bg-gray-300 transition-colors"}," 取消 "),t("button",{onClick:G,class:"flex-1 py-1.5 bg-[#ff6600] text-white rounded text-xs hover:bg-[#ff5500] transition-colors"}," 确认 ")])])):(r(),a("div",et,[t("button",{onClick:A,class:"w-full py-2 bg-white border border-gray-200 text-gray-700 rounded-md text-sm hover:border-[#ff6600] hover:text-[#ff6600] transition-colors flex items-center justify-center gap-2"},[...e[22]||(e[22]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1),M(" 点击修改 ",-1)])])]))]),$.value?(r(),a("div",lt,[e[26]||(e[26]=t("div",{class:"text-xs font-bold text-gray-500 mb-3 text-left uppercase tracking-wider"},"绑定邮箱",-1)),C.value?(r(),a("div",rt,[g(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>m.value=o),type:"email",placeholder:"请输入您的邮箱",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm outline-none focus:border-[#ff6600]"},null,512),[[c,m.value]]),t("div",at,[t("button",{onClick:e[10]||(e[10]=o=>C.value=!1),class:"flex-1 py-1.5 bg-gray-200 text-gray-600 rounded text-xs hover:bg-gray-300 transition-colors"}," 取消 "),t("button",{onClick:J,class:"flex-1 py-1.5 bg-[#ff6600] text-white rounded text-xs hover:bg-[#ff5500] transition-colors"}," 确认 ")])])):(r(),a("div",ot,[t("button",{onClick:K,class:"w-full py-2 bg-white border border-gray-200 text-gray-700 rounded-md text-sm hover:border-[#ff6600] hover:text-[#ff6600] transition-colors flex items-center justify-center gap-2"},[e[25]||(e[25]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),t("polyline",{points:"22,6 12,13 2,6"})],-1)),M(" "+i((L=l.value)!=null&&L.email?"修改邮箱":"点击绑定"),1)])]))])):re("",!0)])])])])])]}),_:1}))}}),xt=ie(nt,[["__scopeId","data-v-384c8350"]]);export{xt as default};
