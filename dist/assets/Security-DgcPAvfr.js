import{d as le,b as y,C as ne,o as ie,q as h,w as de,a as e,n as i,h as n,j as o,c as m,i as R,t as b,s as V,E as q,D as F,G as Q,x as ue,z as ce,F as Y,r as G,y as pe,m as fe,B as me,e as M,A as ve,f as u,_ as ye}from"./index-BHIK7C10.js";import{U as be}from"./UserLayout-B8sRqGKV.js";import{c as ge,u as xe,$ as _e,a0 as he,a1 as we,a2 as Ce,a3 as Ie}from"./MainLayout-B5rIQJ09.js";import"./index-xJH53vjr.js";import{S as ke}from"./constants-BNhaYc6M.js";import{i as Ve}from"./utils-KYcPjVjn.js";import{o as Ee,s as U,u as Pe,a as L,E as W,t as Te}from"./vee-validate-zod-B1YiNOmC.js";import{b as z,L as B,S as K,a as E,E as H}from"./sodium-Bc0TsoPz.js";import{h as Se}from"./common-YT7QVq-F.js";import{_ as De}from"./receive-sms.vue_vue_type_script_setup_true_lang-C9yA8i0k.js";import{C as w}from"./chevron-right-CiNP_Xun.js";import{C as J}from"./circle-help-oc4LiMWP.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=ge("GiftIcon",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Re={class:"flex flex-col gap-5"},Fe={class:"flex gap-6 items-start"},Ye={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm min-h-[600px]"},Ge={class:"mb-6"},Ue={class:"space-y-3"},Le={class:"flex items-center gap-3"},We={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ne={class:"mb-6"},je={class:"space-y-3"},Ae={class:"flex items-center gap-3"},Oe={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},$e={class:"flex items-center gap-3"},qe={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Qe={class:"mb-6"},Me={class:"space-y-3"},ze={class:"flex items-center gap-3"},Be={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ke={class:"flex items-center gap-3"},He={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Je={class:"w-[420px] shrink-0"},Xe={class:"bg-white rounded-xl border border-gray-100 p-8 shadow-md sticky top-5 min-h-[400px]"},Ze={class:"flex items-center gap-3 mb-2"},es={class:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center"},ss={class:"text-base font-bold text-gray-800"},ts={class:"space-y-4"},rs={class:"space-y-1.5"},os={class:"relative"},as=["type"],ls={class:"space-y-1.5"},ns={class:"relative"},is=["type"],ds={class:"space-y-1.5"},us={class:"flex items-center gap-2"},cs=["disabled"],ps={key:1,class:"space-y-6"},fs={class:"flex items-center gap-3 mb-2"},ms={class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"},vs={class:"space-y-4"},ys={class:"space-y-1.5"},bs=["value"],gs={class:"space-y-1.5"},xs=["disabled"],_s={key:2,class:"space-y-6"},hs={class:"flex items-center gap-3 mb-2"},ws={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},Cs={class:"space-y-3 pt-2"},Is=["onClick"],ks={class:"text-sm text-gray-700 font-medium"},Vs={key:3,class:"space-y-6"},Es={class:"flex items-center gap-3 mb-2"},Ps={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},Ts={class:"space-y-3 pt-2"},Ss=["onClick"],Ds={class:"text-sm text-gray-700 font-medium"},Rs=le({__name:"Security",setup(Fs){const N=fe(),j=ve(),d=me(),g=xe(),v=M(()=>g.currentCustomer),a=y((()=>{const r=j.query.tab;return r&&["LOGIN_PWD","PAY_PWD","SECURITY_QUEST","GIFT_VERIFY","CARD_VERIFY"].includes(r)?r:"LOGIN_PWD"})()),c=y(!1),C=y(!1),I=y(!1),A=M(()=>v.value?Ve(v.value.securitypass):!1),p=y({question:"",answer:""}),Z=async()=>{if(!c.value){if(!p.value.question||!p.value.answer){d.error("请填写完整密保信息");return}c.value=!0;try{const{code:r,message:s}=await we({safe_ask:p.value.question,answer:p.value.answer});r===200?(d.success("密保设置成功"),p.value={question:"",answer:""},a.value="LOGIN_PWD",g.setCurrentCustomer({securitypass:"1"})):d.error(s)}catch(r){const s=r instanceof Error?r.message:"保存失败，刷新页面请重试";d.error(s)}finally{c.value=!1}}},ee=async r=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await Ce({prize_verify_type:r});s===200?(d.success("兑奖验证方式已更新"),g.setCurrentCustomer({prizeVerifyType:r})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},se=async r=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await Ie({select_card_verify_type:r});s===200?(d.success("查看卡密验证方式已更新"),g.setCurrentCustomer({selectcardVerifyType:r})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},P=y(""),te=Ee({verify_code:U().min(1,"请输入验证码"),password:U().min(8,"请输入密码"),confirm_password:U()}).refine(r=>r.password===r.confirm_password,{path:["confirm_password"],message:"两次输入的密码不一致"}),re=Te(te),{handleSubmit:oe,isSubmitting:k,resetForm:O}=Pe({validationSchema:re,initialValues:{password:"",confirm_password:"",verify_code:""}}),{value:T}=L("password"),{value:S}=L("confirm_password"),{value:D}=L("verify_code"),$=oe(async r=>{console.log("submitExchange",r),k.value=!0;const s=await z.encrypt(r.password,P.value),t=await z.encrypt(r.confirm_password,P.value);try{if(a.value==="LOGIN_PWD"){const{code:l,message:f}=await _e({verify_code:r.verify_code,password:s,confirm_password:t});l!==200?d.error(f):(d.success("更新成功"),O(),g.logout(),await N.push("/login"))}else{const{code:l,message:f}=await he({verify_code:r.verify_code,password:s,confirm_password:t});l!==200?d.error(f):d.success("更新成功")}}catch(l){d.error(l.message||"提交失败")}finally{k.value=!1}});return ne(a,r=>{N.replace({query:{...j.query,tab:r}}),(r==="LOGIN_PWD"||r==="PAY_PWD")&&O()}),ie(()=>{Se().then(({data:r,code:s})=>{s==200&&(P.value=r.key)})}),(r,s)=>(u(),h(be,null,{default:de(()=>[e("div",Re,[s[31]||(s[31]=e("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[e("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"安全中心")],-1)),e("div",Fe,[e("div",Ye,[s[21]||(s[21]=e("div",{class:"mb-6 pb-4 border-b border-gray-100"},[e("h3",{class:"text-lg font-bold text-gray-800"},"安全设置"),e("p",{class:"text-sm text-gray-500 mt-1"},"定期更新您的设置，以便保护账号安全")],-1)),e("section",Ge,[s[14]||(s[14]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-[#ff6600] pl-3"}," 账户安全 ",-1)),e("div",Ue,[e("div",{onClick:s[0]||(s[0]=t=>a.value="LOGIN_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",a.value==="LOGIN_PWD"?"bg-orange-50 border-orange-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Le,[e("div",We,[n(o(B),{class:"w-4 h-4 text-orange-500"})]),s[13]||(s[13]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"登录密码"),e("div",{class:"text-[11px] text-gray-400"},"用于登录账户，建议定期更换")],-1))]),n(o(w),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",a.value==="LOGIN_PWD"?"text-orange-500":"text-gray-300"])},null,8,["class"])],2)])]),e("section",Ne,[s[17]||(s[17]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-blue-500 pl-3"}," 支付安全 ",-1)),e("div",je,[e("div",{onClick:s[1]||(s[1]=t=>a.value="PAY_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",a.value==="PAY_PWD"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ae,[e("div",Oe,[n(o(K),{class:"w-4 h-4 text-blue-500"})]),s[15]||(s[15]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"二级密码"),e("div",{class:"text-[11px] text-gray-400"},"用于资金变动、兑换等高危操作验证")],-1))]),n(o(w),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",a.value==="PAY_PWD"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2),A.value?(u(),m("div",{key:0,onClick:s[2]||(s[2]=t=>a.value="SECURITY_QUEST"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",a.value==="SECURITY_QUEST"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",$e,[e("div",qe,[n(o(J),{class:"w-4 h-4 text-blue-500"})]),s[16]||(s[16]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"密保设置"),e("div",{class:"text-[11px] text-gray-400"},"找回密码、修改重要信息的最后一道防线")],-1))]),n(o(w),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",a.value==="SECURITY_QUEST"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2)):R("",!0)])]),e("section",Qe,[s[20]||(s[20]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-purple-500 pl-3"}," 其他权限验证 ",-1)),e("div",Me,[e("div",{onClick:s[3]||(s[3]=t=>a.value="GIFT_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",a.value==="GIFT_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",ze,[e("div",Be,[n(o(X),{class:"w-4 h-4 text-purple-500"})]),s[18]||(s[18]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"兑奖验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置兑换红包或奖品时的二次验证")],-1))]),n(o(w),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",a.value==="GIFT_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2),e("div",{onClick:s[4]||(s[4]=t=>a.value="CARD_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",a.value==="CARD_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ke,[e("div",He,[n(o(E),{class:"w-4 h-4 text-purple-500"})]),s[19]||(s[19]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"查看卡密验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置查看已购卡密时的验证方式")],-1))]),n(o(w),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",a.value==="CARD_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2)])])]),e("div",Je,[e("div",Xe,[a.value==="LOGIN_PWD"||a.value==="PAY_PWD"?(u(),m("form",{onSubmit:s[10]||(s[10]=ue((...t)=>o($)&&o($)(...t),["prevent"])),key:"login-password",class:"space-y-6"},[e("div",Ze,[e("div",es,[a.value==="LOGIN_PWD"?(u(),h(o(B),{key:0,class:"w-5 h-5 text-orange-500"})):a.value==="PAY_PWD"?(u(),h(o(K),{key:1,class:"w-4 h-4 text-blue-500"})):R("",!0)]),e("h4",ss,b(a.value==="LOGIN_PWD"?"修改登录密码":"修改二级密码"),1)]),e("div",ts,[e("div",rs,[s[22]||(s[22]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"password"},"新密码",-1)),e("div",os,[V(e("input",{id:"password","onUpdate:modelValue":s[5]||(s[5]=t=>F(T)?T.value=t:null),type:C.value?"text":"password",placeholder:"请输入新密码",class:"security-input",autocomplete:"off",spellcheck:"false"},null,8,as),[[q,o(T)]]),e("button",{type:"button",onClick:s[6]||(s[6]=t=>C.value=!C.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(u(),h(Q(C.value?o(H):o(E)),{class:"w-4 h-4"}))])])]),n(o(W),{name:"password",class:"text-[#ff4d4f] text-sm"}),e("div",ls,[s[23]||(s[23]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"confirm_password"},"确认新密码",-1)),e("div",ns,[V(e("input",{id:"confirm_password","onUpdate:modelValue":s[7]||(s[7]=t=>F(S)?S.value=t:null),type:I.value?"text":"password",placeholder:"请再次输入新密码",autocomplete:"off",spellcheck:"false",class:"security-input"},null,8,is),[[q,o(S)]]),e("button",{type:"button",onClick:s[8]||(s[8]=t=>I.value=!I.value),class:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[(u(),h(Q(I.value?o(H):o(E)),{class:"w-4 h-4"}))])])]),n(o(W),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"}),e("div",ds,[s[24]||(s[24]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"verify_code"},"验证码",-1)),e("div",us,[n(De,{scene:a.value==="LOGIN_PWD"?"update_password":"update_pay_password",modelValue:o(D),"onUpdate:modelValue":s[9]||(s[9]=t=>F(D)?D.value=t:null)},null,8,["scene","modelValue"])])]),n(o(W),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})]),e("button",{type:"submit",disabled:o(k),class:"security-btn bg-[#ff6b6b]"},b(o(k)?"提交中...":"提交修改"),9,cs)],32)):a.value==="SECURITY_QUEST"&&A.value?(u(),m("div",ps,[e("div",fs,[e("div",ms,[n(o(J),{class:"w-5 h-5 text-blue-500"})]),s[25]||(s[25]=e("h4",{class:"text-base font-bold text-gray-800"},"设置密保问题",-1))]),e("div",vs,[e("div",ys,[s[27]||(s[27]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保问题",-1)),V(e("select",{"onUpdate:modelValue":s[11]||(s[11]=t=>p.value.question=t),class:"security-input appearance-none"},[s[26]||(s[26]=e("option",{value:"",disabled:""},"选择您的密保问题",-1)),(u(!0),m(Y,null,G(o(ke),t=>(u(),m("option",{key:`option-${t.value}`,value:String(t.value)},b(r.$t(t.i18nKey)),9,bs))),128))],512),[[ce,p.value.question]])]),e("div",gs,[s[28]||(s[28]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保答案",-1)),V(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>p.value.answer=t),type:"text",placeholder:"请输入答案",class:"security-input"},null,512),[[pe,p.value.answer]])]),e("button",{onClick:Z,disabled:c.value,class:"security-btn bg-blue-500"},b(c.value?"提交中...":"提交设置"),9,xs)])])):a.value==="GIFT_VERIFY"?(u(),m("div",_s,[e("div",hs,[e("div",ws,[n(o(X),{class:"w-5 h-5 text-purple-500"})]),s[29]||(s[29]=e("h4",{class:"text-base font-bold text-gray-800"},"兑奖验证方式",-1))]),e("div",Cs,[(u(),m(Y,null,G({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,x,_;return e("div",{key:l,onClick:ae=>ee(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=v.value)==null?void 0:f.prizeVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",ks,b(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((x=v.value)==null?void 0:x.prizeVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((_=v.value)==null?void 0:_.prizeVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,Is)}),64))])])):a.value==="CARD_VERIFY"?(u(),m("div",Vs,[e("div",Es,[e("div",Ps,[n(o(E),{class:"w-5 h-5 text-purple-500"})]),s[30]||(s[30]=e("h4",{class:"text-base font-bold text-gray-800"},"查看卡密验证方式",-1))]),e("div",Ts,[(u(),m(Y,null,G({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,x,_;return e("div",{key:l,onClick:ae=>se(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=v.value)==null?void 0:f.selectcardVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",Ds,b(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((x=v.value)==null?void 0:x.selectcardVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((_=v.value)==null?void 0:_.selectcardVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,Ss)}),64))])])):R("",!0)])])])])]),_:1}))}}),zs=ye(Rs,[["__scopeId","data-v-94824600"]]);export{zs as default};
