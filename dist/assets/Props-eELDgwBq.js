import{h as E,J as C,K as T,o as B,M as z,C as p,N as G,O as X,P as Z,d as F,u as ee,L as te,c as k,F as Y,f as r,b as S,k as L,w as V,t as M,B as H,p as w,r as R,y as oe,e as O,E as I,j as U,A as se,g as ae,v as ne,i as re}from"./index-B3GHTeri.js";import{U as le}from"./UserLayout-BBBzWj5n.js";import{u as ie}from"./MainLayout-CypWfAxo.js";import{_ as ce,S as ue}from"./constants-Bj55xr1Z.js";import{o as de,s as N,u as fe,a as P,E as A,t as pe}from"./vee-validate-zod-CzWL5cR0.js";import{f as me}from"./customer-sLMFGXI3.js";import{_ as ve}from"./coin-BjeO1Yvx.js";import{a as ge,i as Q,c as ye,w as xe,t as _e,b as he,e as D,u as be,D as we,d as ke}from"./DataTable-DOJGqLs2.js";import{b as Se}from"./shop-BVMZVUOB.js";import"./createLucideIcon-48VT0qdL.js";const Ce=Q?window:void 0,J=Q?window.navigator:void 0;function Me(s){var o;const m=C(s);return(o=m==null?void 0:m.$el)!=null?o:m}function K(...s){const o=[],m=()=>{o.forEach(n=>n()),o.length=0},u=(n,c,i,d)=>(n.addEventListener(c,i,d),()=>n.removeEventListener(c,i,d)),v=E(()=>{const n=D(C(s[0])).filter(c=>c!=null);return n.every(c=>typeof c!="string")?n:void 0}),g=xe(()=>{var n,c;return[(c=(n=v.value)==null?void 0:n.map(i=>Me(i)))!=null?c:[Ce].filter(i=>i!=null),D(C(v.value?s[1]:s[0])),D(p(v.value?s[2]:s[1])),C(v.value?s[3]:s[2])]},([n,c,i,d])=>{if(m(),!(n!=null&&n.length)||!(c!=null&&c.length)||!(i!=null&&i.length))return;const y=he(d)?{...d}:d;o.push(...n.flatMap(h=>c.flatMap(b=>i.map(a=>u(h,b,a,y)))))},{flush:"post"}),_=()=>{g(),m()};return _e(m),_}function Te(){const s=T(!1),o=z();return o&&B(()=>{s.value=!0},o),s}function W(s){const o=Te();return E(()=>(o.value,!!s()))}function j(s,o={}){const{controls:m=!1,navigator:u=J}=o,v=W(()=>u&&"permissions"in u),g=T(),_=typeof s=="string"?{name:s}:s,n=T(),c=()=>{var d,y;n.value=(y=(d=g.value)==null?void 0:d.state)!=null?y:"prompt"};K(g,"change",c,{passive:!0});const i=ye(async()=>{if(v.value){if(!g.value)try{g.value=await u.permissions.query(_)}catch{g.value=void 0}finally{c()}if(m)return G(g.value)}});return i(),m?{state:n,isSupported:v,query:i}:n}function Ve(s={}){const{navigator:o=J,read:m=!1,source:u,copiedDuring:v=1500,legacy:g=!1}=s,_=W(()=>o&&"clipboard"in o),n=j("clipboard-read"),c=j("clipboard-write"),i=E(()=>_.value||g),d=T(""),y=T(!1),h=ge(()=>y.value=!1,v,{immediate:!1});async function b(){let t=!(_.value&&f(n.value));if(!t)try{d.value=await o.clipboard.readText()}catch{t=!0}t&&(d.value=l())}i.value&&m&&K(["copy","cut"],b,{passive:!0});async function a(t=C(u)){if(i.value&&t!=null){let x=!(_.value&&f(c.value));if(!x)try{await o.clipboard.writeText(t)}catch{x=!0}x&&e(t),d.value=t,y.value=!0,h.start()}}function e(t){const x=document.createElement("textarea");x.value=t??"",x.style.position="absolute",x.style.opacity="0",document.body.appendChild(x),x.select(),document.execCommand("copy"),x.remove()}function l(){var t,x,$;return($=(x=(t=document==null?void 0:document.getSelection)==null?void 0:t.call(document))==null?void 0:x.toString())!=null?$:""}function f(t){return t==="granted"||t==="prompt"}return{isSupported:i,text:d,copied:y,copy:a}}const Ee=X();Ee.use(Z);function $e(s,o=300){const m={token:s,expire:Date.now()+o*1e3};localStorage.setItem("secure_verify_token",JSON.stringify(m))}function q(){const s=localStorage.getItem("secure_verify_token");if(!s)return null;const o=JSON.parse(s);return Date.now()>o.expire?(localStorage.removeItem("secure_verify_token"),null):o.token}const Ie={class:"text-orange-600 font-bold"},Ne={class:"text-xs"},Pe={class:"text-gray-400 text-xs"},Ae=["onClick"],De=F({__name:"PropsRecord",setup(s){const{locale:o}=ee(),m=te[o.value]??"USD",u=H(),{copy:v,isSupported:g}=Ve(),{loading:_,dataSource:n,hasMore:c,pagination:i,loadData:d,changePage:y}=be(Se,{defaultSize:10,initQuery:{t:q()}}),h=[{key:"no",title:"卡号",width:"20%",align:"center"},{key:"pwd",title:"卡密",width:"25%",align:"center"},{key:"points",title:"金豆",width:"15%",align:"center"},{key:"addtime",title:"获得时间",width:"20%",align:"center"},{key:"operation",title:"操作",width:"15%",align:"center"}],b=async()=>{if(!n.value.length){u.warning("暂无数据可复制");return}const e=n.value.filter(l=>l.state===0).map(l=>`${l.no} ${l.pwd}`).join(`
`);if(!e){u.warning("没有待使用的卡密可复制");return}g.value?(await v(e),u.success("已复制所有可用卡密")):u.error("您的浏览器不支持自动复制")},a=async(e,l)=>{const f=`${e} ${l}`;g.value?(await v(f),u.success("已复制")):u.error("您的浏览器不支持自动复制")};return d(),(e,l)=>(w(),k(Y,null,[r("div",{class:"flex justify-between items-center mb-4 px-1"},[l[1]||(l[1]=r("h3",{class:"text-lg font-bold text-gray-800"},"兑换记录",-1)),r("div",{class:"flex items-center gap-2"},[r("button",{onClick:b,class:"text-sm font-medium text-orange-600 hover:text-orange-700 hover:bg-orange-50 px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1"},[...l[0]||(l[0]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})],-1),L(" 复制可用卡密 ",-1)])])])]),S(we,{columns:h,data:p(n),loading:p(_),pagination:p(i),onChange:p(y),hasMore:p(c)},{"column-points":V(({row:f})=>[r("div",Ie,[L(M(e.$n(f.points))+" ",1),l[2]||(l[2]=r("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:ve},null,-1))]),r("div",Ne,M(e.$n((f.points||0)/1e3,{style:"currency",currency:p(m)})),1)]),"column-addtime":V(({row:f})=>[r("span",Pe,M(p(ke).unix(f.addtime||0).format("YYYY-MM-DD HH:mm")),1)]),"column-operation":V(({row:f})=>[r("span",{class:"cursor-pointer text-orange-600 hover:text-orange-700 hover:bg-orange-50",onClick:t=>a(f.no,f.pwd)},"复制",8,Ae)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),Le={class:"flex flex-col gap-5"},Re={key:0,class:"flex gap-[1px] flex-col"},Oe={class:"relative flex items-center gap-1"},Ue={key:1},je={class:"flex gap-[1px] flex-col"},Be={class:"relative flex items-center gap-1"},Fe=["value"],Ye={class:"flex gap-[1px] flex-col"},He={class:"relative flex items-center gap-1"},Qe=["disabled"],Je={key:1},st=F({__name:"Props",setup(s){const o=H(),m=ie(),u=E(()=>m.currentCustomer),v=R(!1),g=R(1),_=de({safe_ask:N().optional(),answer:N().optional(),verify_code:N().optional()}).superRefine((a,e)=>{var l,f;((l=u.value)==null?void 0:l.selectcardVerifyType)=="safeQuestion"&&((!a.safe_ask||a.safe_ask.length<1)&&e.addIssue({path:["safe_ask"],message:"请选择密保问题",code:"custom"}),(!a.answer||a.answer.length<1)&&e.addIssue({path:["answer"],message:"请输入答案",code:"custom"}),a.answer&&a.answer.length>50&&e.addIssue({path:["answer"],message:"答案不能超过50字符",code:"custom"})),((f=u==null?void 0:u.value)==null?void 0:f.selectcardVerifyType)=="smsVerify"&&(!a.verify_code||a.verify_code.length<1)&&e.addIssue({path:["verify_code"],message:"请输入验证码",code:"custom"})}),n=pe(_),{handleSubmit:c,isSubmitting:i}=fe({validationSchema:n,initialValues:{safe_ask:""}}),{value:d}=P("safe_ask"),{value:y}=P("answer"),{value:h}=P("verify_code"),b=c(async(a,{setErrors:e})=>{i.value=!0;try{const{code:l,message:f,data:t}=await me({safe_ask:a==null?void 0:a.safe_ask,answer:a==null?void 0:a.answer,verify_code:a==null?void 0:a.verify_code});l!==200?o.error(f):(o.success("验证成功"),v.value=!0,$e(t.key,480))}catch(l){o.error(l.message||"提交失败")}finally{i.value=!1}});return B(()=>{(async()=>{try{v.value=!!q()}catch{v.value=!1}})()}),(a,e)=>(w(),oe(le,null,{default:V(()=>{var l,f;return[r("div",Le,[e[8]||(e[8]=r("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[r("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"我的道具")],-1)),v.value?(w(),k("div",Je,[S(De)])):(w(),k("form",{onSubmit:e[3]||(e[3]=re((...t)=>p(b)&&p(b)(...t),["prevent"])),class:"flex flex-col gap-6",key:g.value},[((l=u.value)==null?void 0:l.selectcardVerifyType)=="smsVerify"?(w(),k("div",Re,[e[4]||(e[4]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"verify_code"},"验证码",-1)),r("div",Oe,[S(ce,{scene:"exchange_card",modelValue:p(h),"onUpdate:modelValue":e[0]||(e[0]=t=>I(h)?h.value=t:null)},null,8,["modelValue"])]),S(p(A),{name:"verify_code",class:"text-[#ff4d4f] text-sm"})])):O("",!0),((f=u.value)==null?void 0:f.selectcardVerifyType)=="safeQuestion"?(w(),k("div",Ue,[r("div",je,[e[6]||(e[6]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"safe_ask"},"验证码",-1)),r("div",Be,[U(r("select",{id:"safe_ask","onUpdate:modelValue":e[1]||(e[1]=t=>I(d)?d.value=t:null),class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[e[5]||(e[5]=r("option",{key:"option-default",value:""},"请选择问题",-1)),(w(!0),k(Y,null,ae(p(ue),t=>(w(),k("option",{key:`option-${t.value}`,value:String(t.value)},M(a.$t(t.i18nKey)),9,Fe))),128))],512),[[se,p(d)]])]),S(p(A),{name:"safe_ask",class:"text-[#ff4d4f] text-sm"})]),r("div",Ye,[e[7]||(e[7]=r("label",{class:"text-[15px] font-medium text-[#333333]",for:"answer"},"答案",-1)),r("div",He,[U(r("input",{id:"answer",type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>I(y)?y.value=t:null),placeholder:"请输入答案",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[ne,p(y)]])]),S(p(A),{name:"answer",class:"text-[#ff4d4f] text-sm"})])])):O("",!0),r("button",{type:"submit",disabled:p(i),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},M(p(i)?"提交中...":"提交"),9,Qe)],32))])]}),_:1}))}});export{st as default};
