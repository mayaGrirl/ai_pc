import{d as P,o as j,q as L,w as N,a as o,c as m,s as g,y as R,j as a,D as y,h as _,z as q,F as z,r as A,t as h,x as I,B as K,b as u,f as d}from"./index-BHIK7C10.js";import{U as O}from"./UserLayout-B8sRqGKV.js";import{o as $,u as G,a as w,E as k,n as S,t as H}from"./vee-validate-zod-B1YiNOmC.js";import{e as J,b as Q,f as W}from"./agent-D8TjDVp4.js";import"./index-xJH53vjr.js";import{u as X}from"./MainLayout-B5rIQJ09.js";const Y={class:"flex flex-col gap-5"},Z={class:"flex gap-[1px] flex-col"},ee={class:"relative flex items-center gap-1"},te={class:"flex gap-[1px] flex-col"},oe={class:"relative flex items-center gap-1"},ae=["value"],se=["disabled"],fe=P({__name:"conversion",setup(ne){const r=K(),B=X(),x=u(!1),p=u(),b=u([]),E=async()=>{x.value=!0;const{code:s,data:e}=await Q();s===200&&(p.value=e);const t=await W();t.code===200&&(b.value=t.data),x.value=!1},F=u(1),M=$({uid:S({message:"请选择转换代理"}),amount:S({message:"请输入转换金额"})}).superRefine((s,e)=>{var n;const t=((n=p.value)==null?void 0:n.bankpoints)||0,i=s.amount*1e3;t!==void 0&&i>t&&e.addIssue({path:["amount"],message:"金额不足，不能转换",code:"custom"})}),V=H(M),{handleSubmit:C,isSubmitting:l,resetForm:D}=G({validationSchema:V,initialValues:{uid:0}}),{value:f}=w("uid"),{value:c}=w("amount"),v=C(async(s,{setErrors:e})=>{var i;if((((i=p.value)==null?void 0:i.bankpoints)||0)<1){r.info("金额不足，不能转换");return}l.value=!0;try{const{code:n,message:T,data:U}=await J({amount:s.amount,uid:s.uid});n!==200?r.error(T):(r.success("转换成功"),B.setCurrentCustomer({bankpoints:U.bankpoints}),D())}catch(n){r.error(n.message||"提交失败")}finally{l.value=!1}});return j(()=>{E()}),(s,e)=>(d(),L(O,null,{default:N(()=>[o("div",Y,[e[7]||(e[7]=o("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[o("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"额度转换")],-1)),(d(),m("form",{onSubmit:e[2]||(e[2]=I((...t)=>a(v)&&a(v)(...t),["prevent"])),class:"flex flex-col gap-6",key:F.value},[o("div",null,[o("div",Z,[e[4]||(e[4]=o("label",{class:"text-[15px] font-medium text-[#333333]",for:"amount"},"转换金额",-1)),o("div",ee,[g(o("input",{type:"number",id:"amount",inputmode:"numeric",pattern:"[0-9]*","onUpdate:modelValue":e[0]||(e[0]=t=>y(c)?c.value=t:null),placeholder:"请输入转换金额",class:"px-4 py-[14px] pr-20 border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[R,a(c),void 0,{number:!0}]]),e[3]||(e[3]=o("span",{class:"absolute right-4 text-[#666] text-[15px]"},"元",-1))]),_(a(k),{name:"amount",class:"text-[#ff4d4f] text-sm"})]),o("div",te,[e[6]||(e[6]=o("label",{class:"text-[15px] font-medium text-[#333333]",for:"uid"},"转换代理",-1)),o("div",oe,[g(o("select",{id:"uid","onUpdate:modelValue":e[1]||(e[1]=t=>y(f)?f.value=t:null),class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none"},[e[5]||(e[5]=o("option",{key:"option-default",value:"0"},"请选择代理",-1)),(d(!0),m(z,null,A(b.value,t=>(d(),m("option",{key:`option-${t.uid}`,value:t.uid},h(t.name),9,ae))),128))],512),[[q,a(f)]])]),_(a(k),{name:"uid",class:"text-[#ff4d4f] text-sm"})])]),o("button",{type:"submit",disabled:a(l),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},h(a(l)?"提交中...":"提交"),9,se)],32))])]),_:1}))}});export{fe as default};
