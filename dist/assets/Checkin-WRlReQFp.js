import{U as et}from"./UserLayout-svFC9TDn.js";import{n as st,o as nt,e as J,q as at,t as ot}from"./customer-Cl1Slv0Y.js";import{u as P,D as N}from"./DataTable-B-yXMtsd.js";import{T as it}from"./TextSkeleton-kseV3jGF.js";import{g as rt,a as lt}from"./common-Ce80qKUY.js";import{d as Y,o as R,c as k,F as L,e as t,C as o,x as j,b as F,w,t as r,k as D,p as g,i as y,D as ct,r as K,n as q,f as Q,A as dt,j as I,m as ut,B as pt,s as ft}from"./index-D14D9v6l.js";import{d as W}from"./dayjs.min-BAJkae7J.js";import"./MainLayout-BLBr75Xh.js";import"./createLucideIcon-V69TOBcX.js";const gt={class:"bg-white p-1"},xt=["innerHTML"],_t={class:"flex justify-center items-center gap-1"},vt=["src"],mt=Y({__name:"SignIntro",setup(B){const m=D(""),b=async()=>{u.value=!0;const{data:d,code:n}=await rt("customer_sign_in_tips");n==200&&(m.value=(d==null?void 0:d.content)||""),u.value=!1},{loading:u,dataSource:a,hasMore:i,pagination:l,loadData:c,changePage:x}=P(lt),h=[{key:"level",title:"生态值等级",width:"20%",align:"center"},{key:"remark",title:"签到奖励",width:"25%",align:"center"}];return R(()=>{b(),c()}),(d,n)=>(g(),k(L,null,[t("div",gt,[o(u)?(g(),j(it,{key:0,lines:5,height:"14px",animation:"wave"})):(g(),k("div",{key:1,class:"list-none p-0 m-0",innerHTML:m.value},null,8,xt))]),F(N,{columns:h,data:o(a),loading:o(u),pagination:o(l),onChange:o(x),showPagination:!1,hasMore:o(i)},{"column-level":w(({row:_})=>[t("div",_t,[t("img",{alt:"coin",class:"inline-block w-[20px] h-[20px]",src:`/level/${_.level}.png`},null,8,vt)])]),"column-remark":w(({row:_})=>[t("div",null,"签到可获得。开箱积分: "+r(_.sign_in_blessing)+" * 连续签到天数。金豆: "+r(_.sign_in_points)+" * 连续签到天数",1)]),_:1},8,["data","loading","pagination","onChange","hasMore"])],64))}}),ht=Y({__name:"SignMember",setup(B){const m=h=>{const d=W(),n=W(h);if(d.diff(n,"second")<60)return"刚刚";const C=d.diff(n,"minute");if(C<60)return C+"分钟前";const M=d.diff(n,"hour");if(M<24)return M+"小时前";const S=d.diff(n,"day");return S<30?S+"天前":d.diff(n,"month")+"个月前"},{loading:b,dataSource:u,hasMore:a,pagination:i,loadData:l,changePage:c}=P(st),x=[{key:"nickname",title:"用户",width:"25%",align:"center"},{key:"reward_points",title:"金豆",width:"25%",align:"center"},{key:"reward_base_coin",title:"积分",width:"25%",align:"center"},{key:"sign_date",title:"签到日期",width:"25%",align:"center"}];return R(()=>{l()}),(h,d)=>(g(),j(N,{columns:x,data:o(u),loading:o(b),pagination:o(i),onChange:o(c),showPagination:!1,hasMore:o(a)},{"column-nickname":w(({row:n})=>{var _;return[t("div",null,r(((_=n==null?void 0:n.member_field)==null?void 0:_.nickname)||(n==null?void 0:n.member_id)),1)]}),"column-sign_date":w(({row:n})=>[t("div",null,r(m(n.created_at)),1)]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),bt=Y({__name:"SignRecord",setup(B){const{loading:m,dataSource:b,hasMore:u,pagination:a,loadData:i,changePage:l}=P(nt,{defaultSize:10}),c=[{key:"reward_points",title:"金豆",width:"25%",align:"center"},{key:"reward_base_coin",title:"积分",width:"25%",align:"center"},{key:"sign_date",title:"签到日期",width:"25%",align:"center"}];return i(),(x,h)=>(g(),j(N,{columns:c,data:o(b),loading:o(m),pagination:o(a),onChange:o(l),hasMore:o(u)},{default:w(()=>[...h[0]||(h[0]=[y(" // 自定义列 ",-1)])]),_:1},8,["data","loading","pagination","onChange","hasMore"]))}}),yt={class:"flex flex-col gap-5"},kt={class:"flex gap-5 border-b border-[#eee] pb-[15px]"},wt=["onClick"],Dt={key:0},Ct={class:"flex justify-around items-center gap-[30px]"},Mt={class:"text-center text-[13px] text-[#666]"},St={class:"font-bold text-[#ff6600]"},Tt={class:"font-bold text-[#ff6600]"},$t={class:"flex"},Ft={class:"flex items-center gap-2.5"},Yt={class:"text-base font-bold text-[#ff6600]"},jt={class:"flex items-center gap-2.5"},Bt={class:"text-base font-bold text-[#ff6600]"},qt={class:"text-base font-bold text-[#ff6600]"},It={class:"flex justify-between"},Lt={class:"w-5/12"},Pt={class:"mb-[15px] flex items-center justify-center gap-1"},Nt={class:"text-[16px] font-bold text-[#333]"},Rt={class:"grid grid-cols-7 gap-1"},Vt={class:"my-5 text-center"},Ht=["disabled"],Ut={class:"w-6/12"},zt={class:"bg-white"},At={key:1},Et=Y({__name:"Checkin",setup(B){const m=dt(),b=ut(),u=pt(),a=D(),i=D(new Date),l=I(()=>i.value.getMonth()+1),c=I(()=>i.value.getFullYear()),x=D([]),h=new Date().getDate(),d=I(()=>{const e=[],s=new Date(c.value,l.value-1,1).getDay(),v=new Date(c.value,l.value,0).getDate();for(let p=0;p<s;p++)e.push(null);for(let p=1;p<=v;p++)e.push(p);return e}),n=()=>{i.value=new Date(c.value,l.value-2,1)},_=()=>{i.value=new Date(c.value,l.value,1)},C=()=>{const e=new Date(i.value);e.setFullYear(e.getFullYear()-1),i.value=e},M=()=>{const e=new Date(i.value);e.setFullYear(e.getFullYear()+1),i.value=e},S=async()=>{try{const e=await at();if(e.code===200){x.value.push(h),u.success("签到成功");const{data:s,code:v}=await J();v===200&&s&&(a.value=s)}else u.error(e.message)}catch(e){const s=e instanceof Error?e.message:"签到失败";console.error("Sign in error:",e),u.error(s)}},V=e=>e?x.value.includes(e):!1,X=e=>{if(!e)return!1;const s=new Date;return e===s.getDate()&&l.value===s.getMonth()+1&&c.value===s.getFullYear()},H=async()=>{const e=c.value,s=l.value.toString().padStart(2,"0");try{const{code:v,data:p}=await ot(`${e}-${s}`);v===200&&p?x.value=p.map($=>new Date($).getDate()):x.value=[]}catch(v){console.error("Fetch signed dates error:",v),x.value=[]}};ct(i,()=>{H()}),R(async()=>{try{const{data:e,code:s}=await J();s===200&&e&&(a.value=e),await H()}catch(e){console.error("Failed to load sign stats:",e)}});const T=D(m.query.tab||"sign"),Z=[{key:"sign",name:"签到"},{key:"record",name:"签到记录"}],tt=e=>{T.value=e,b.push({query:{...m.query,tab:e}})};return(e,s)=>(g(),j(et,null,{default:w(()=>{var v,p,$,U,z,A,E,O;return[t("div",yt,[t("div",kt,[(g(),k(L,null,K(Z,f=>t("span",{key:f.key,class:q(["w-20 text-center text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 ",{"text-[#ff6600] border-b-[#ff6600]":T.value===f.key}]),onClick:G=>tt(f.key)},r(f.name),11,wt)),64))]),T.value==="sign"?(g(),k("div",Dt,[t("div",Ct,[t("div",Mt,[s[0]||(s[0]=y(" 连续签到 ",-1)),t("span",St,r(((v=a.value)==null?void 0:v.continue_days)||0),1),s[1]||(s[1]=y(" 天，累计签到 ",-1)),t("span",Tt,r(((p=a.value)==null?void 0:p.total_days)||0),1),s[2]||(s[2]=y(" 天 ",-1))]),t("div",$t,[t("div",Ft,[s[3]||(s[3]=t("span",{class:"text-[15px] font-medium text-[#333333]"},"今日签到:",-1)),t("span",Yt,r(($=a.value)==null?void 0:$.total_people),1),s[4]||(s[4]=y(" 人 ",-1))]),t("div",jt,[s[5]||(s[5]=t("span",{class:"text-[15px] font-medium text-[#333333]"},"累计送出:",-1)),t("span",Bt,r((U=a.value)==null?void 0:U.total_points),1),s[6]||(s[6]=y(" 金豆 ",-1)),t("span",qt,r((z=a.value)==null?void 0:z.total_base_coin),1),s[7]||(s[7]=y(" 积分 ",-1))])])]),t("div",It,[t("div",Lt,[t("div",Pt,[t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:C},"<<"),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:n},"<"),t("span",Nt,r(c.value)+"年 "+r(l.value)+"月 ",1),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:_},">"),t("button",{class:"cursor-pointer bg-transparent px-1 py-2 text-[16px] text-[#666] hover:text-[#ff6600]",onClick:M},">>")]),s[8]||(s[8]=t("div",{class:"mb-[10px] grid grid-cols-7 text-center"},[t("span",{class:"p-2 text-[13px] text-[#999]"},"日"),t("span",{class:"p-2 text-[13px] text-[#999]"},"一"),t("span",{class:"p-2 text-[13px] text-[#999]"},"二"),t("span",{class:"p-2 text-[13px] text-[#999]"},"三"),t("span",{class:"p-2 text-[13px] text-[#999]"},"四"),t("span",{class:"p-2 text-[13px] text-[#999]"},"五"),t("span",{class:"p-2 text-[13px] text-[#999]"},"六")],-1)),t("div",Rt,[(g(!0),k(L,null,K(d.value,(f,G)=>(g(),k("span",{key:G,class:q(["aspect-square flex items-center justify-center rounded text-[14px] text-[#333]",[f?"cursor-pointer":"cursor-default",f&&V(f)?"bg-[#ff6600] text-white":"",f&&X(f)?"border-2 border-[#ff6600]":""]])},r(f||""),3))),128))]),t("div",Vt,[t("button",{disabled:(A=a.value)==null?void 0:A.is_sign,class:q(["cursor-pointer rounded bg-gradient-to-br px-[50px] py-3 text-[16px] text-white hover:opacity-90",[(E=a.value)!=null&&E.is_sign?"from-[#cccccc] to-[#cccccc]":"from-[#ff6600] to-[#ff8533]"]]),onClick:S},r((O=a.value)!=null&&O.is_sign?"已签到":"立即签到"),11,Ht)])]),t("div",Ut,[s[9]||(s[9]=t("div",{class:"text-center text-[16px] font-bold text-[#333] mb-[15px] py-2"},"近期签到用户",-1)),F(ht)])]),t("div",zt,[F(mt)])])):Q("",!0),T.value==="record"?(g(),k("div",At,[F(bt)])):Q("",!0)])]}),_:1}))}}),ee=ft(Et,[["__scopeId","data-v-fecc2ca5"]]);export{ee as default};
