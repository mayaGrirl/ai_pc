import{d as te,D as re,o as oe,x as P,w as ae,e,n as i,b as n,C as a,c as m,f as T,t as v,h as k,v as D,E as R,g as le,z as ne,F,r as U,m as ie,B as de,k as C,j as O,p as u,s as ue}from"./index-5CuYqb8n.js";import{U as ce}from"./UserLayout-Boo2xIrf.js";import{f as w,u as pe,U as fe,V as me,W as ye,X as ve,Y as be}from"./MainLayout-DqBK_RG1.js";import"./index-DcOdcbrb.js";import{S as ge}from"./constants-BNhaYc6M.js";import{i as xe}from"./utils-KYcPjVjn.js";import{o as he,s as Y,u as we,a as G,E as L,t as _e}from"./vee-validate-zod-AB0BRsKy.js";import{S as A}from"./sodium-jzn3nznW.js";import{h as ke}from"./common-Ch9gD02D.js";import{_ as Ce}from"./receive-sms.vue_vue_type_script_setup_true_lang-BNRR_VIl.js";import{C as h}from"./chevron-right-CkTJlobq.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=w("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=w("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("GiftIcon",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=w("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=w("ShieldCheckIcon",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ve={class:"flex flex-col gap-5"},Ie={class:"flex gap-6 items-start"},Se={class:"flex-1 bg-white rounded-xl border border-gray-100 p-6 shadow-sm min-h-[600px]"},Ee={class:"mb-6"},Pe={class:"space-y-3"},Te={class:"flex items-center gap-3"},De={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Re={class:"mb-6"},Fe={class:"space-y-3"},Ue={class:"flex items-center gap-3"},Ye={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ge={class:"flex items-center gap-3"},Le={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},We={class:"mb-6"},je={class:"space-y-3"},Ne={class:"flex items-center gap-3"},Oe={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},Ae={class:"flex items-center gap-3"},Me={class:"p-2 rounded-lg bg-white shadow-sm group-hover:scale-110 transition-transform"},ze={class:"w-[420px] shrink-0"},$e={class:"bg-white rounded-xl border border-gray-100 p-8 shadow-md sticky top-5 min-h-[400px]"},Qe={class:"flex items-center gap-3 mb-2"},qe={class:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center"},Be={class:"text-base font-bold text-gray-800"},He={class:"space-y-4"},Ke={class:"space-y-1.5"},Xe={class:"space-y-1.5"},Je={class:"space-y-1.5"},Ze={class:"flex items-center gap-2"},es=["disabled"],ss={key:1,class:"space-y-6"},ts={class:"flex items-center gap-3 mb-2"},rs={class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"},os={class:"space-y-4"},as={class:"space-y-1.5"},ls=["value"],ns={class:"space-y-1.5"},is=["disabled"],ds={key:2,class:"space-y-6"},us={class:"flex items-center gap-3 mb-2"},cs={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},ps={class:"space-y-3 pt-2"},fs=["onClick"],ms={class:"text-sm text-gray-700 font-medium"},ys={key:3,class:"space-y-6"},vs={class:"flex items-center gap-3 mb-2"},bs={class:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"},gs={class:"space-y-3 pt-2"},xs=["onClick"],hs={class:"text-sm text-gray-700 font-medium"},ws=te({__name:"Security",setup(_s){const B=ie(),d=de(),b=pe(),y=O(()=>b.currentCustomer),r=C("LOGIN_PWD"),c=C(!1),W=O(()=>y.value?xe(y.value.securitypass):!1),p=C({question:"",answer:""}),H=async()=>{if(!c.value){if(!p.value.question||!p.value.answer){d.error("请填写完整密保信息");return}c.value=!0;try{const{code:o,message:s}=await ye({safe_ask:p.value.question,answer:p.value.answer});o===200?(d.success("密保设置成功"),p.value={question:"",answer:""},r.value="LOGIN_PWD",b.setCurrentCustomer({securitypass:"1"})):d.error(s)}catch(o){const s=o instanceof Error?o.message:"保存失败，刷新页面请重试";d.error(s)}finally{c.value=!1}}},K=async o=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await ve({prize_verify_type:o});s===200?(d.success("兑奖验证方式已更新"),b.setCurrentCustomer({prizeVerifyType:o})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},X=async o=>{if(!c.value){c.value=!0;try{const{code:s,message:t}=await be({select_card_verify_type:o});s===200?(d.success("查看卡密验证方式已更新"),b.setCurrentCustomer({selectcardVerifyType:o})):d.error(t||"更新失败")}catch(s){const t=s instanceof Error?s.message:"保存失败，刷新页面请重试";d.error(t)}finally{c.value=!1}}},V=C(""),J=he({verify_code:Y().min(1,"请输入验证码"),password:Y().min(8,"请输入密码"),confirm_password:Y()}).refine(o=>o.password===o.confirm_password,{path:["confirm_password"],message:"两次输入的密码不一致"}),Z=_e(J),{handleSubmit:ee,isSubmitting:_,resetForm:j}=we({validationSchema:Z,initialValues:{password:"",confirm_password:"",verify_code:""}}),{value:I}=G("password"),{value:S}=G("confirm_password"),{value:E}=G("verify_code"),N=ee(async o=>{console.log("submitExchange",o),_.value=!0;const s=await A.encrypt(o.password,V.value),t=await A.encrypt(o.confirm_password,V.value);try{if(r.value==="LOGIN_PWD"){const{code:l,message:f}=await fe({verify_code:o.verify_code,password:s,confirm_password:t});l!==200?d.error(f):(d.success("更新成功"),j(),b.logout(),await B.push("/login"))}else{const{code:l,message:f}=await me({verify_code:o.verify_code,password:s,confirm_password:t});l!==200?d.error(f):d.success("更新成功")}}catch(l){d.error(l.message||"提交失败")}finally{_.value=!1}});return re(r,o=>{(o==="LOGIN_PWD"||o==="PAY_PWD")&&j()}),oe(()=>{ke().then(({data:o,code:s})=>{s==200&&(V.value=o.key)})}),(o,s)=>(u(),P(ce,null,{default:ae(()=>[e("div",Ve,[s[29]||(s[29]=e("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[e("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"安全中心")],-1)),e("div",Ie,[e("div",Se,[s[19]||(s[19]=e("div",{class:"mb-6 pb-4 border-b border-gray-100"},[e("h3",{class:"text-lg font-bold text-gray-800"},"安全设置"),e("p",{class:"text-sm text-gray-500 mt-1"},"定期更新您的设置，以便保护账号安全")],-1)),e("section",Ee,[s[12]||(s[12]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-[#ff6600] pl-3"}," 账户安全 ",-1)),e("div",Pe,[e("div",{onClick:s[0]||(s[0]=t=>r.value="LOGIN_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="LOGIN_PWD"?"bg-orange-50 border-orange-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Te,[e("div",De,[n(a(Q),{class:"w-4 h-4 text-orange-500"})]),s[11]||(s[11]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"登录密码"),e("div",{class:"text-[11px] text-gray-400"},"用于登录账户，建议定期更换")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="LOGIN_PWD"?"text-orange-500":"text-gray-300"])},null,8,["class"])],2)])]),e("section",Re,[s[15]||(s[15]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-blue-500 pl-3"}," 支付安全 ",-1)),e("div",Fe,[e("div",{onClick:s[1]||(s[1]=t=>r.value="PAY_PWD"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="PAY_PWD"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ue,[e("div",Ye,[n(a(q),{class:"w-4 h-4 text-blue-500"})]),s[13]||(s[13]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"二级密码"),e("div",{class:"text-[11px] text-gray-400"},"用于资金变动、兑换等高危操作验证")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="PAY_PWD"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2),W.value?(u(),m("div",{key:0,onClick:s[2]||(s[2]=t=>r.value="SECURITY_QUEST"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="SECURITY_QUEST"?"bg-blue-50 border-blue-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ge,[e("div",Le,[n(a(M),{class:"w-4 h-4 text-blue-500"})]),s[14]||(s[14]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"密保设置"),e("div",{class:"text-[11px] text-gray-400"},"找回密码、修改重要信息的最后一道防线")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="SECURITY_QUEST"?"text-blue-500":"text-gray-300"])},null,8,["class"])],2)):T("",!0)])]),e("section",We,[s[18]||(s[18]=e("div",{class:"flex items-center text-sm text-gray-600 mb-4 font-bold border-l-4 border-purple-500 pl-3"}," 其他权限验证 ",-1)),e("div",je,[e("div",{onClick:s[3]||(s[3]=t=>r.value="GIFT_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="GIFT_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ne,[e("div",Oe,[n(a($),{class:"w-4 h-4 text-purple-500"})]),s[16]||(s[16]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"兑奖验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置兑换红包或奖品时的二次验证")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="GIFT_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2),e("div",{onClick:s[4]||(s[4]=t=>r.value="CARD_VERIFY"),class:i(["flex items-center justify-between rounded-xl px-4 py-4 transition-all cursor-pointer border group",r.value==="CARD_VERIFY"?"bg-purple-50 border-purple-200 shadow-sm":"bg-gray-50 border-transparent hover:bg-gray-100"])},[e("div",Ae,[e("div",Me,[n(a(z),{class:"w-4 h-4 text-purple-500"})]),s[17]||(s[17]=e("div",null,[e("div",{class:"text-gray-800 text-sm font-medium"},"查看卡密验证方式"),e("div",{class:"text-[11px] text-gray-400"},"设置查看已购卡密时的验证方式")],-1))]),n(a(h),{class:i(["w-4 h-4 transition-transform group-hover:translate-x-1",r.value==="CARD_VERIFY"?"text-purple-500":"text-gray-300"])},null,8,["class"])],2)])])]),e("div",ze,[e("div",$e,[r.value==="LOGIN_PWD"||r.value==="PAY_PWD"?(u(),m("form",{onSubmit:s[8]||(s[8]=le((...t)=>a(N)&&a(N)(...t),["prevent"])),key:"login-password",class:"space-y-6"},[e("div",Qe,[e("div",qe,[r.value==="LOGIN_PWD"?(u(),P(a(Q),{key:0,class:"w-5 h-5 text-orange-500"})):r.value==="PAY_PWD"?(u(),P(a(q),{key:1,class:"w-4 h-4 text-blue-500"})):T("",!0)]),e("h4",Be,v(r.value==="LOGIN_PWD"?"修改登录密码":"修改二级密码"),1)]),e("div",He,[e("div",Ke,[s[20]||(s[20]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"password"},"新密码",-1)),k(e("input",{id:"password","onUpdate:modelValue":s[5]||(s[5]=t=>R(I)?I.value=t:null),type:"password",placeholder:"请输入新密码",class:"security-input",autocomplete:"off",spellcheck:"false"},null,512),[[D,a(I)]])]),n(a(L),{name:"password",class:"text-[#ff4d4f] text-sm"}),e("div",Xe,[s[21]||(s[21]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"confirm_password"},"确认新密码",-1)),k(e("input",{id:"confirm_password","onUpdate:modelValue":s[6]||(s[6]=t=>R(S)?S.value=t:null),type:"password",placeholder:"请再次输入新密码",autocomplete:"off",spellcheck:"false",class:"security-input"},null,512),[[D,a(S)]])]),n(a(L),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"}),e("div",Je,[s[22]||(s[22]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase",for:"verify_code"},"验证码",-1)),e("div",Ze,[n(Ce,{scene:r.value==="LOGIN_PWD"?"update_password":"update_pay_password",modelValue:a(E),"onUpdate:modelValue":s[7]||(s[7]=t=>R(E)?E.value=t:null)},null,8,["scene","modelValue"])])]),n(a(L),{name:"confirm_password",class:"text-[#ff4d4f] text-sm"})]),e("button",{type:"submit",disabled:a(_),class:"security-btn bg-[#ff6b6b]"},v(a(_)?"提交中...":"提交修改"),9,es)],32)):r.value==="SECURITY_QUEST"&&W.value?(u(),m("div",ss,[e("div",ts,[e("div",rs,[n(a(M),{class:"w-5 h-5 text-blue-500"})]),s[23]||(s[23]=e("h4",{class:"text-base font-bold text-gray-800"},"设置密保问题",-1))]),e("div",os,[e("div",as,[s[25]||(s[25]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保问题",-1)),k(e("select",{"onUpdate:modelValue":s[9]||(s[9]=t=>p.value.question=t),class:"security-input appearance-none"},[s[24]||(s[24]=e("option",{value:"",disabled:""},"选择您的密保问题",-1)),(u(!0),m(F,null,U(a(ge),t=>(u(),m("option",{key:`option-${t.value}`,value:String(t.value)},v(o.$t(t.i18nKey)),9,ls))),128))],512),[[ne,p.value.question]])]),e("div",ns,[s[26]||(s[26]=e("label",{class:"text-xs font-bold text-gray-500 ml-1 uppercase"},"密保答案",-1)),k(e("input",{"onUpdate:modelValue":s[10]||(s[10]=t=>p.value.answer=t),type:"text",placeholder:"请输入答案",class:"security-input"},null,512),[[D,p.value.answer]])]),e("button",{onClick:H,disabled:c.value,class:"security-btn bg-blue-500"},v(c.value?"提交中...":"提交设置"),9,is)])])):r.value==="GIFT_VERIFY"?(u(),m("div",ds,[e("div",us,[e("div",cs,[n(a($),{class:"w-5 h-5 text-purple-500"})]),s[27]||(s[27]=e("h4",{class:"text-base font-bold text-gray-800"},"兑奖验证方式",-1))]),e("div",ps,[(u(),m(F,null,U({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,g,x;return e("div",{key:l,onClick:se=>K(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=y.value)==null?void 0:f.prizeVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",ms,v(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((g=y.value)==null?void 0:g.prizeVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((x=y.value)==null?void 0:x.prizeVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,fs)}),64))])])):r.value==="CARD_VERIFY"?(u(),m("div",ys,[e("div",vs,[e("div",bs,[n(a(z),{class:"w-5 h-5 text-purple-500"})]),s[28]||(s[28]=e("h4",{class:"text-base font-bold text-gray-800"},"查看卡密验证方式",-1))]),e("div",gs,[(u(),m(F,null,U({smsVerify:"短信验证",safeQuestion:"密保验证"},(t,l)=>{var f,g,x;return e("div",{key:l,onClick:se=>X(l),class:i(["flex items-center justify-between p-4 rounded-lg bg-gray-50 transition-all cursor-pointer group border-2",((f=y.value)==null?void 0:f.selectcardVerifyType)===l?"bg-white border-purple-500 shadow-md":"border-transparent hover:bg-white hover:shadow-md hover:border-purple-200"])},[e("span",hs,v(t),1),e("div",{class:i(["w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors",((g=y.value)==null?void 0:g.selectcardVerifyType)===l?"border-purple-500":"border-gray-200 group-hover:border-purple-500"])},[e("div",{class:i(["w-2.5 h-2.5 rounded-full bg-purple-500 transition-transform",((x=y.value)==null?void 0:x.selectcardVerifyType)===l?"scale-100":"scale-0 group-hover:scale-100"])},null,2)],2)],10,xs)}),64))])])):T("",!0)])])])])]),_:1}))}}),Us=ue(ws,[["__scopeId","data-v-2d2c786e"]]);export{Us as default};
