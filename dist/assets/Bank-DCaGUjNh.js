import{d as $,o as j,x as A,w as K,e as t,i as h,t as c,c as k,h as d,I as C,C as o,E as u,v as V,b as S,f as L,g as q,B as z,k as b,p as y}from"./index-DtQG6u8I.js";import{_ as B}from"./coin-BjeO1Yvx.js";import{U as G}from"./UserLayout-Dj6X6rU-.js";import{u as H}from"./MainLayout-CJWB77O5.js";import{m as J,g as O}from"./customer-B0MyuAI_.js";import{o as P,s as E,n as Q,u as W,a as v,E as M,t as X}from"./vee-validate-zod-DYP1nO7y.js";const Y={class:"flex flex-col gap-5"},Z={class:"flex gap-[30px] py-[15px]"},ee={class:"flex items-center gap-2.5"},te={class:"text-base font-bold text-[#ff6600]"},se={class:"flex items-center gap-2.5"},ae={class:"text-base font-bold text-[#ff6600]"},oe={class:"flex gap-[1px] flex-col"},le={class:"flex gap-[30px] py-[15px]"},ne={class:"flex items-center gap-[6px] cursor-pointer text-[14px] text-[#333]"},re={class:"flex items-center gap-[6px] cursor-pointer text-[14px] text-[#333]"},pe={class:"flex gap-[1px] flex-col"},ie={class:"relative flex items-center"},de={key:0,class:"flex gap-[1px] flex-col"},ue={class:"relative flex items-center gap-1"},me=["disabled"],_e=$({__name:"Bank",setup(fe){const m=z(),T=H(),U=b(1),g=b(!1),r=b(),_=async a=>{g.value=!0;const{data:e,code:l}=await O();l==200&&(r.value=e),g.value=!1},N=P({type:E(),amount:Q("请输入正整数").int("必须是整数").positive("金额必须大于 0"),pay_password:E().optional()}).superRefine((a,e)=>{a.type==="out"&&!a.pay_password&&e.addIssue({path:["pay_password"],message:"取款时必须输入二级密码",code:"custom"})}).superRefine((a,e)=>{var n,s;const l=a.type==="out"?(n=r.value)==null?void 0:n.bankpoints:(s=r.value)==null?void 0:s.points;l!==void 0&&a.amount>l&&e.addIssue({path:["amount"],message:"金额超出限制",code:"custom"})}),R=X(N),{handleSubmit:D,isSubmitting:i,resetForm:F}=W({validationSchema:R,initialValues:{type:"in"}}),{value:p}=v("type"),{value:f}=v("amount"),{value:x}=v("pay_password"),w=D(async(a,{setErrors:e})=>{var l,n;i.value=!0;try{const{code:s,message:I}=await J({type:a.type,amount:a.amount,pay_password:a.pay_password});s!==200?m.error(I):(m.success("兑换成功"),await _(!1),T.setCurrentCustomer({points:(l=r.value)==null?void 0:l.points,bankpoints:(n=r.value)==null?void 0:n.bankpoints}),F())}catch(s){m.error(s.message||"提交失败")}finally{i.value=!1}});return j(()=>{_()}),(a,e)=>(y(),A(G,null,{default:K(()=>{var l,n;return[t("div",Y,[e[13]||(e[13]=t("div",{class:"flex gap-5 border-b border-[#eee] pb-[15px]"},[t("span",{class:"text-sm cursor-pointer pb-3 border-b-2 border-transparent -mb-4 text-[#ff6600] border-b-[#ff6600]"},"银行服务")],-1)),t("div",Z,[t("div",ee,[e[6]||(e[6]=t("span",{class:"text-sm text-[#666]"},"流动资金:",-1)),t("span",te,[h(c(a.$n(((l=r.value)==null?void 0:l.points)||0))+" ",1),e[5]||(e[5]=t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:B},null,-1))])]),t("div",se,[e[8]||(e[8]=t("span",{class:"text-sm text-[#666]"},"银行存款:",-1)),t("span",ae,[h(c(a.$n(((n=r.value)==null?void 0:n.bankpoints)||0))+" ",1),e[7]||(e[7]=t("img",{alt:"coin",class:"inline-block w-[13px] h-[13px]",src:B},null,-1))])])]),(y(),k("form",{onSubmit:e[4]||(e[4]=q((...s)=>o(w)&&o(w)(...s),["prevent"])),class:"flex flex-col gap-6",key:U.value},[t("div",oe,[t("div",le,[t("label",ne,[d(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>u(p)?p.value=s:null),value:"in",class:"accent-[#ee5a6f]"},null,512),[[C,o(p)]]),e[9]||(e[9]=t("span",null,"存款",-1))]),t("label",re,[d(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>u(p)?p.value=s:null),value:"out",class:"accent-[#ee5a6f]"},null,512),[[C,o(p)]]),e[10]||(e[10]=t("span",null,"取款",-1))])])]),t("div",pe,[e[11]||(e[11]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"amount"},"金额",-1)),t("div",ie,[d(t("input",{type:"number",id:"amount",inputmode:"numeric",pattern:"[0-9]*",step:"100",min:"0","onUpdate:modelValue":e[2]||(e[2]=s=>u(f)?f.value=s:null),placeholder:"请输入100的整数倍",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[V,o(f),void 0,{number:!0}]])]),S(o(M),{name:"amount",class:"text-[#ff4d4f] text-sm"})]),o(p)=="out"?(y(),k("div",de,[e[12]||(e[12]=t("label",{class:"text-[15px] font-medium text-[#333333]",for:"pay_password"},"二级密码",-1)),t("div",ue,[d(t("input",{id:"pay_password",type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>u(x)?x.value=s:null),placeholder:"请输入答案",class:"px-4 py-[14px] border-2 border-gray-200 rounded-lg text-[15px] transition-all duration-300 outline-none focus:border-[#667eea] focus:shadow-[0_0_0_3px_rgba(102,126,234,0.1)] flex-1 min-w-0 text-gray-600 placeholder-gray-400 focus:outline-none",autocomplete:"off",spellcheck:"false"},null,512),[[V,o(x)]])]),S(o(M),{name:"pay_password",class:"text-[#ff4d4f] text-sm"})])):L("",!0),t("button",{type:"submit",disabled:o(i),class:"mt-4 p-4 bg-gradient-to-br from-[#ff6b6b] to-[#ee5a6f] text-white rounded-xl text-[18px] font-bold cursor-pointer transition-all duration-300 shadow-[0_4px_12px_rgba(255,107,107,0.3)] hover:-translate-y-[2px] hover:shadow-[0_6px_16px_rgba(255,107,107,0.4)] active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"},c(o(i)?"提交中...":"提交"),9,me)],32))])]}),_:1}))}});export{_e as default};
